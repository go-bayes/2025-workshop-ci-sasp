<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.8.25">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Estimating ATE and CATE using Causal Forests – Beyond Correlation: Causal Inference Workshop</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
/* CSS for citations */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
  margin-bottom: 0em;
}
.hanging-indent div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}</style>


<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<script src="../site_libs/quarto-html/quarto.js" type="module"></script>
<script src="../site_libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="../site_libs/quarto-html/axe/axe-check.js" type="module"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting-29987c632d9c708eba81ba88d1291502.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-text-highlighting-styles">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting-dark-1df33b310b25e824b5acc70bcebddb02.css" rel="stylesheet" class="quarto-color-scheme quarto-color-alternate" id="quarto-text-highlighting-styles">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting-29987c632d9c708eba81ba88d1291502.css" rel="stylesheet" class="quarto-color-scheme-extra" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap-41eb41ebec47cde7d6e34488d139ad0a.min.css" rel="stylesheet" append-hash="true" class="quarto-color-scheme" id="quarto-bootstrap" data-mode="light">
<link href="../site_libs/bootstrap/bootstrap-dark-71e677b001e2b203ee4eca291d0f02e7.min.css" rel="stylesheet" append-hash="true" class="quarto-color-scheme quarto-color-alternate" id="quarto-bootstrap" data-mode="dark">
<link href="../site_libs/bootstrap/bootstrap-41eb41ebec47cde7d6e34488d139ad0a.min.css" rel="stylesheet" append-hash="true" class="quarto-color-scheme-extra" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<style>html{ scroll-behavior: smooth; }</style>

  <script>window.backupDefine = window.define; window.define = undefined;</script><script src="https://cdn.jsdelivr.net/npm/katex@latest/dist/katex.min.js"></script>
  <script>document.addEventListener("DOMContentLoaded", function () {
 var mathElements = document.getElementsByClassName("math");
 var macros = [];
 for (var i = 0; i < mathElements.length; i++) {
  var texText = mathElements[i].firstChild;
  if (mathElements[i].tagName == "SPAN") {
   katex.render(texText.data, mathElements[i], {
    displayMode: mathElements[i].classList.contains('display'),
    throwOnError: false,
    macros: macros,
    fleqn: false
   });
}}});
  </script>
  <script>window.define = window.backupDefine; window.backupDefine = undefined;</script><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@latest/dist/katex.min.css">

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN" && texText && texText.data) {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

</head>

<body class="nav-fixed quarto-light"><script id="quarto-html-before-body" type="application/javascript">
    const toggleBodyColorMode = (bsSheetEl) => {
      const mode = bsSheetEl.getAttribute("data-mode");
      const bodyEl = window.document.querySelector("body");
      if (mode === "dark") {
        bodyEl.classList.add("quarto-dark");
        bodyEl.classList.remove("quarto-light");
      } else {
        bodyEl.classList.add("quarto-light");
        bodyEl.classList.remove("quarto-dark");
      }
    }
    const toggleBodyColorPrimary = () => {
      const bsSheetEl = window.document.querySelector("link#quarto-bootstrap:not([rel=disabled-stylesheet])");
      if (bsSheetEl) {
        toggleBodyColorMode(bsSheetEl);
      }
    }
    const setColorSchemeToggle = (alternate) => {
      const toggles = window.document.querySelectorAll('.quarto-color-scheme-toggle');
      for (let i=0; i < toggles.length; i++) {
        const toggle = toggles[i];
        if (toggle) {
          if (alternate) {
            toggle.classList.add("alternate");
          } else {
            toggle.classList.remove("alternate");
          }
        }
      }
    };
    const toggleColorMode = (alternate) => {
      // Switch the stylesheets
      const primaryStylesheets = window.document.querySelectorAll('link.quarto-color-scheme:not(.quarto-color-alternate)');
      const alternateStylesheets = window.document.querySelectorAll('link.quarto-color-scheme.quarto-color-alternate');
      manageTransitions('#quarto-margin-sidebar .nav-link', false);
      if (alternate) {
        // note: dark is layered on light, we don't disable primary!
        enableStylesheet(alternateStylesheets);
        for (const sheetNode of alternateStylesheets) {
          if (sheetNode.id === "quarto-bootstrap") {
            toggleBodyColorMode(sheetNode);
          }
        }
      } else {
        disableStylesheet(alternateStylesheets);
        enableStylesheet(primaryStylesheets)
        toggleBodyColorPrimary();
      }
      manageTransitions('#quarto-margin-sidebar .nav-link', true);
      // Switch the toggles
      setColorSchemeToggle(alternate)
      // Hack to workaround the fact that safari doesn't
      // properly recolor the scrollbar when toggling (#1455)
      if (navigator.userAgent.indexOf('Safari') > 0 && navigator.userAgent.indexOf('Chrome') == -1) {
        manageTransitions("body", false);
        window.scrollTo(0, 1);
        setTimeout(() => {
          window.scrollTo(0, 0);
          manageTransitions("body", true);
        }, 40);
      }
    }
    const disableStylesheet = (stylesheets) => {
      for (let i=0; i < stylesheets.length; i++) {
        const stylesheet = stylesheets[i];
        stylesheet.rel = 'disabled-stylesheet';
      }
    }
    const enableStylesheet = (stylesheets) => {
      for (let i=0; i < stylesheets.length; i++) {
        const stylesheet = stylesheets[i];
        if(stylesheet.rel !== 'stylesheet') { // for Chrome, which will still FOUC without this check
          stylesheet.rel = 'stylesheet';
        }
      }
    }
    const manageTransitions = (selector, allowTransitions) => {
      const els = window.document.querySelectorAll(selector);
      for (let i=0; i < els.length; i++) {
        const el = els[i];
        if (allowTransitions) {
          el.classList.remove('notransition');
        } else {
          el.classList.add('notransition');
        }
      }
    }
    const isFileUrl = () => {
      return window.location.protocol === 'file:';
    }
    const hasAlternateSentinel = () => {
      let styleSentinel = getColorSchemeSentinel();
      if (styleSentinel !== null) {
        return styleSentinel === "alternate";
      } else {
        return false;
      }
    }
    const setStyleSentinel = (alternate) => {
      const value = alternate ? "alternate" : "default";
      if (!isFileUrl()) {
        window.localStorage.setItem("quarto-color-scheme", value);
      } else {
        localAlternateSentinel = value;
      }
    }
    const getColorSchemeSentinel = () => {
      if (!isFileUrl()) {
        const storageValue = window.localStorage.getItem("quarto-color-scheme");
        return storageValue != null ? storageValue : localAlternateSentinel;
      } else {
        return localAlternateSentinel;
      }
    }
    const toggleGiscusIfUsed = (isAlternate, darkModeDefault) => {
      const baseTheme = document.querySelector('#giscus-base-theme')?.value ?? 'light';
      const alternateTheme = document.querySelector('#giscus-alt-theme')?.value ?? 'dark';
      let newTheme = '';
      if(authorPrefersDark) {
        newTheme = isAlternate ? baseTheme : alternateTheme;
      } else {
        newTheme = isAlternate ? alternateTheme : baseTheme;
      }
      const changeGiscusTheme = () => {
        // From: https://github.com/giscus/giscus/issues/336
        const sendMessage = (message) => {
          const iframe = document.querySelector('iframe.giscus-frame');
          if (!iframe) return;
          iframe.contentWindow.postMessage({ giscus: message }, 'https://giscus.app');
        }
        sendMessage({
          setConfig: {
            theme: newTheme
          }
        });
      }
      const isGiscussLoaded = window.document.querySelector('iframe.giscus-frame') !== null;
      if (isGiscussLoaded) {
        changeGiscusTheme();
      }
    };
    const authorPrefersDark = false;
    const darkModeDefault = authorPrefersDark;
      document.querySelector('link#quarto-text-highlighting-styles.quarto-color-scheme-extra').rel = 'disabled-stylesheet';
      document.querySelector('link#quarto-bootstrap.quarto-color-scheme-extra').rel = 'disabled-stylesheet';
    let localAlternateSentinel = darkModeDefault ? 'alternate' : 'default';
    // Dark / light mode switch
    window.quartoToggleColorScheme = () => {
      // Read the current dark / light value
      let toAlternate = !hasAlternateSentinel();
      toggleColorMode(toAlternate);
      setStyleSentinel(toAlternate);
      toggleGiscusIfUsed(toAlternate, darkModeDefault);
      window.dispatchEvent(new Event('resize'));
    };
    // Switch to dark mode if need be
    if (hasAlternateSentinel()) {
      toggleColorMode(true);
    } else {
      toggleColorMode(false);
    }
  </script>

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a href="../index.html" class="navbar-brand navbar-brand-logo">
    </a>
    <a class="navbar-brand" href="../index.html">
    <span class="navbar-title">Beyond Correlation: Causal Inference Workshop</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="../index.html"> 
<span class="menu-text">Home</span></a>
  </li>  
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-workshop-content" role="link" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">Workshop Content</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-workshop-content">    
        <li>
    <a class="dropdown-item" href="../content/00-background.html">
 <span class="dropdown-text">1. What is Causality?</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../content/01-background.html">
 <span class="dropdown-text">2. Identification Using Causal DAGs</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../content/02-causal-workflow.html">
 <span class="dropdown-text">3. Causal Workflow</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../content/03-interaction.html">
 <span class="dropdown-text">4. Average and Conditional Average Treatment Effects</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../workshop-scripts/06-interpretation-2.html">
 <span class="dropdown-text">5. Code Review</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../simulations/01-simulation-population.html">
 <span class="dropdown-text">Simulations</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../content/ggdag-examples.html">
 <span class="dropdown-text">ggdag</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../pdfs/bulbulia-hand-outs/S2-glossary.pdf">
 <span class="dropdown-text">Glossary (PDF)</span></a>
  </li>  
        <li><hr class="dropdown-divider"></li>
        <li>
    <a class="dropdown-item" href="../quiz/sparcc_day_2_short_quiz.pdf">
 <span class="dropdown-text">Short Quiz</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../quiz/sparcc_day_2_short_quiz-answer-key.pdf">
 <span class="dropdown-text">Quiz Answer Key</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../quiz/2025-SPARCC-DAY-2-TEST.pdf">
 <span class="dropdown-text">Test</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item">
    <a class="nav-link" href="../glossary-and-dags.html"> 
<span class="menu-text">Glossary &amp; DAGs</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../reading.html"> 
<span class="menu-text">Reading</span></a>
  </li>  
</ul>
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item">
    <a class="nav-link" href="https://github.com/go-bayes"> <i class="bi bi-github" role="img">
</i> 
<span class="menu-text">Go-Bayes</span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
  <a href="" class="quarto-color-scheme-toggle quarto-navigation-tool  px-1" onclick="window.quartoToggleColorScheme(); return false;" title="Toggle dark mode"><i class="bi"></i></a>
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#introduction" id="toc-introduction" class="nav-link active" data-scroll-target="#introduction">Introduction</a></li>
  <li><a href="#method---example-report" id="toc-method---example-report" class="nav-link" data-scroll-target="#method---example-report">Method - Example Report</a></li>
  <li><a href="#results" id="toc-results" class="nav-link" data-scroll-target="#results">Results</a>
  <ul class="collapse">
  <li><a href="#average-treatment-effects" id="toc-average-treatment-effects" class="nav-link" data-scroll-target="#average-treatment-effects">Average Treatment Effects</a></li>
  <li><a href="#results-qini-curve" id="toc-results-qini-curve" class="nav-link" data-scroll-target="#results-qini-curve">Heterogeneous Treatment Effects</a></li>
  <li><a href="#evidence-for-heterogeneous-treatment-effects-policy-treat-best-responders-using-autoc" id="toc-evidence-for-heterogeneous-treatment-effects-policy-treat-best-responders-using-autoc" class="nav-link" data-scroll-target="#evidence-for-heterogeneous-treatment-effects-policy-treat-best-responders-using-autoc">Evidence for heterogeneous treatment effects (policy = treat best responders) using AUTOC</a></li>
  <li><a href="#decision-rules-who-is-most-sensitive-to-treatment" id="toc-decision-rules-who-is-most-sensitive-to-treatment" class="nav-link" data-scroll-target="#decision-rules-who-is-most-sensitive-to-treatment">Decision Rules (Who is Most Sensitive to Treatment?)</a></li>
  <li><a href="#policy-tree-interpretations-depth-1" id="toc-policy-tree-interpretations-depth-1" class="nav-link" data-scroll-target="#policy-tree-interpretations-depth-1">Policy Tree Interpretations (depth 1)</a></li>
  </ul></li>
  <li><a href="#discussion" id="toc-discussion" class="nav-link" data-scroll-target="#discussion">Discussion</a></li>
  <li><a href="#appendix-explain-grf" id="toc-appendix-explain-grf" class="nav-link" data-scroll-target="#appendix-explain-grf">S1: Estimating and Interpreting Heterogeneous Treatment Effects with GRF</a></li>
  <li><a href="#appendix-strengths" id="toc-appendix-strengths" class="nav-link" data-scroll-target="#appendix-strengths">S2: Strengths and Limitations of Causal Forests</a></li>
  <li><a href="#references" id="toc-references" class="nav-link" data-scroll-target="#references">References</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content page-columns page-full" id="quarto-document-content">


<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<div class="quarto-title-block"><div><h1 class="title">Estimating ATE and CATE using Causal Forests</h1><button type="button" class="btn code-tools-button" id="quarto-code-tools-source"><i class="bi"></i> Code</button></div></div>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<div style="page-break-after: always;"></div>
<section id="introduction" class="level2">
<h2 class="anchored" data-anchor-id="introduction">Introduction</h2>
<p>The following briefly walks through the results of ATE and CATE estimation and reporting.</p>
</section>
<section id="method---example-report" class="level2">
<h2 class="anchored" data-anchor-id="method---example-report">Method - Example Report</h2>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb1"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1"></a><span class="fu">cat</span>(<span class="fu">boilerplate_generate_text</span>(</span>
<span id="cb1-2"><a href="#cb1-2"></a>  <span class="at">category =</span> <span class="st">"template"</span>,</span>
<span id="cb1-3"><a href="#cb1-3"></a>  <span class="at">sections =</span> <span class="fu">c</span>(<span class="st">"grf.simple"</span>),</span>
<span id="cb1-4"><a href="#cb1-4"></a>  <span class="co"># global_vars = list(</span></span>
<span id="cb1-5"><a href="#cb1-5"></a>  <span class="co">#   name_outcomes_lower = name_outcomes_lower,</span></span>
<span id="cb1-6"><a href="#cb1-6"></a>  <span class="co">#   name_exposure_lower = name_exposure_lower,</span></span>
<span id="cb1-7"><a href="#cb1-7"></a>  <span class="co">#   name_exposure_capfirst = name_exposure_variable</span></span>
<span id="cb1-8"><a href="#cb1-8"></a>  <span class="co"># ),</span></span>
<span id="cb1-9"><a href="#cb1-9"></a>  <span class="at">db =</span> unified_db</span>
<span id="cb1-10"><a href="#cb1-10"></a>))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div style="page-break-after: always;"></div>
</section>
<section id="results" class="level2 page-columns page-full">
<h2 class="anchored" data-anchor-id="results">Results</h2>
<section id="average-treatment-effects" class="level3 page-columns page-full">
<h3 class="anchored" data-anchor-id="average-treatment-effects">Average Treatment Effects</h3>
<div class="page-columns page-full">
<div class="cell page-columns page-full">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb2"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1"></a>ate_results<span class="sc">$</span>plot</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stderr">
<pre><code>`height` was translated to `width`.</code></pre>
</div>
<div class="cell-output-display page-columns page-full">
<div id="fig-ate" class="quarto-float quarto-figure quarto-figure-center anchored page-columns page-full">
<figure class="quarto-float quarto-float-fig figure page-columns page-full">
<div aria-describedby="fig-ate-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca" class="page-columns page-full">
<img src="06-interpretation-2_files/figure-html/fig-ate-1.png" class="img-fluid figure-img column-screen" width="768">
</div>
<figcaption class="quarto-float-caption-margin quarto-float-caption quarto-float-fig" id="fig-ate-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;1: Average Treatment Effects on Multi-dimensional Wellbeing
</figcaption>
</figure>
</div>
</div>
</div>
</div>
<div style="page-break-after: always;"></div>
<div class="cell page-columns page-full">
<div id="tbl-outcomes" class="cell quarto-float quarto-figure quarto-figure-center anchored page-columns page-full">
<figure class="quarto-float quarto-float-tbl figure page-columns page-full">
<div aria-describedby="tbl-outcomes-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="cell-output-display">
<table class="do-not-create-environment cell table table-sm table-striped small">
<colgroup>
<col style="width: 29%">
<col style="width: 12%">
<col style="width: 12%">
<col style="width: 12%">
<col style="width: 12%">
<col style="width: 18%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">Outcome</th>
<th style="text-align: left;">ATE</th>
<th style="text-align: left;">2.5 %</th>
<th style="text-align: left;">97.5 %</th>
<th style="text-align: left;">E-Value</th>
<th style="text-align: left;">E-Value bound</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;"><strong>Volunteering Hours</strong></td>
<td style="text-align: left;"><strong>0.299</strong></td>
<td style="text-align: left;"><strong>0.27</strong></td>
<td style="text-align: left;"><strong>0.328</strong></td>
<td style="text-align: left;"><strong>1.953</strong></td>
<td style="text-align: left;"><strong>1.876</strong></td>
</tr>
<tr class="even">
<td style="text-align: left;"><strong>Charitable Giving</strong></td>
<td style="text-align: left;"><strong>0.182</strong></td>
<td style="text-align: left;"><strong>0.163</strong></td>
<td style="text-align: left;"><strong>0.201</strong></td>
<td style="text-align: left;"><strong>1.641</strong></td>
<td style="text-align: left;"><strong>1.589</strong></td>
</tr>
</tbody>
</table>
</div>
</div>
<figcaption class="quarto-float-caption-margin quarto-float-caption quarto-float-tbl margin-caption" id="tbl-outcomes-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Table&nbsp;1: Average Treatment Effects on Multi-dimensional Wellbeing
</figcaption>
</figure>
</div>
</div>
<p>Confidence intervals were adjusted for multiple comparisons using Bonferroni correction (<span class="math inline">\alpha</span> = 0.05). E‑values were also adjusted using Bonferroni correction (<span class="math inline">\alpha</span> = 0.05).</p>
<p>The following outcomes present reliable causal evidence for average treatment effects (E‑value lower bound &gt; 1.2):</p>
<ul>
<li>Volunteering Hours: 0.299(0.270,0.328); on the original scale, 0.388(0.350,0.426). E‑value bound = 1.88</li>
<li>Charitable Giving: 0.182(0.163,0.201); on the original scale, 0.228(0.204,0.252). E‑value bound = 1.59</li>
</ul>
<p>Interpretation is per the stated policy contrast; estimates reflect <span class="math inline">\mathbf{E}[Y(1)] - \mathbf{E}[Y(0)]</span> on standardized outcome units. For continuous outcomes, E-values use an OLS-to-RR approximation with exposure contrast <span class="math inline">\delta = 1</span> and outcome SD = 1.</p>
<div style="page-break-after: always;"></div>
</section>
<section id="results-qini-curve" class="level3 page-columns page-full">
<h3 class="anchored" data-anchor-id="results-qini-curve">Heterogeneous Treatment Effects</h3>
<p>We begin by examining the distribution of individual treatment effects ($) across our sample. <a href="#fig-tau-distribution" class="quarto-xref">Figure&nbsp;2</a> presents the estimated treatment effects for each individual, revealing substantial variability in how people respond to {name_exposure_lower}.</p>
<div class="page-columns page-full">
<div class="cell page-columns page-full">
<div class="cell-output cell-output-stderr">
<pre><code>ℹ detected models_binary structure, using $results</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>ℹ processing 2 models: "model_t2_charity_outcome_z" and "model_t2_volunteer_outcome_z"</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>ℹ Applied label mapping: model_t2_charity_outcome_z -&gt; Charitable Giving</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>ℹ Applied label mapping: model_t2_volunteer_outcome_z -&gt; Volunteering Hours</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>ℹ tau values range from -0.351 to 0.748</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>✔ created faceted plot for 2 models: "Charitable Giving" and "Volunteering Hours"</code></pre>
</div>
<div class="cell-output-display page-columns page-full">
<div id="fig-tau-distribution" class="quarto-float quarto-figure quarto-figure-center anchored page-columns page-full">
<figure class="quarto-float quarto-float-fig figure page-columns page-full">
<div aria-describedby="fig-tau-distribution-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca" class="page-columns page-full">
<img src="06-interpretation-2_files/figure-html/fig-tau-distribution-1.png" class="img-fluid figure-img column-screen" width="672">
</div>
<figcaption class="quarto-float-caption-margin quarto-float-caption quarto-float-fig" id="fig-tau-distribution-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;2: Distribution of Individual Treatment Effects (τᵢ) Across Outcomes
</figcaption>
</figure>
</div>
</div>
</div>
</div>
<p>The histograms above show considerable heterogeneity in treatment effects across individuals in the charitable giving condition. To determine whether this variability is systematic (i.e., predictable based on individual characteristics) rather than random noise, we employ two complementary approaches: Qini curves to assess the reliability of heterogeneous effects, and policy trees to identify subgroups with differential treatment responses.</p>
<pre><code>ℹ generating results text with 1 sections</code></pre>
<pre><code>ℹ using results from unified database</code></pre>
<pre><code>ℹ processing section: grf.interpretation_qini</code></pre>
<pre><code>ℹ applying template variables to grf.interpretation_qini</code></pre>
<pre><code>✔ successfully generated results text with 1 section(s)</code></pre>
<section id="qini-curves" class="level4">
<h4 class="anchored" data-anchor-id="qini-curves">Qini Curves</h4>
<p>The Qini curve shows the cumulative <strong>gain</strong> as we expand a targeting rule down the CATE ranking.</p>
<ul>
<li><strong>Beneficial exposure:</strong> we add individuals from the top positive CATEs downward; the baseline is ‘expose everyone.’</li>
<li><strong>Detrimental exposure:</strong> we first flip outcome direction (so higher values represent <strong>more harm</strong>; see ), then <em>add</em> the exposure starting with individuals whose CATEs show the <strong>greated harm</strong>, gradually including those predicted to be more resistant to harm; the baseline is ‘expose everyone.’ The curve therefore quantifies the harm by when those most suceptible to harm are exposed.</li>
</ul>
<p>If the Qini curve stays above its baseline, a targeted policy increases the outcome more than a one-size-fits-all alternative.</p>
<section id="rate-autoc-results" class="level5">
<h5 class="anchored" data-anchor-id="rate-autoc-results">RATE AUTOC RESULTS</h5>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb15"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1"></a><span class="co"># only show if there are autoc results</span></span>
<span id="cb15-2"><a href="#cb15-2"></a><span class="cf">if</span> (<span class="fu">length</span>(model_groups<span class="sc">$</span>autoc) <span class="sc">&gt;</span> <span class="dv">0</span>) {</span>
<span id="cb15-3"><a href="#cb15-3"></a>  <span class="fu">cat</span>(rate_interp<span class="sc">$</span>autoc_results)</span>
<span id="cb15-4"><a href="#cb15-4"></a>} <span class="cf">else</span> {</span>
<span id="cb15-5"><a href="#cb15-5"></a>  <span class="fu">cat</span>(<span class="st">"No significant RATE AUTOC results were found."</span>)</span>
<span id="cb15-6"><a href="#cb15-6"></a>}</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</section>
</section>
</section>
<section id="evidence-for-heterogeneous-treatment-effects-policy-treat-best-responders-using-autoc" class="level3 page-columns page-full">
<h3 class="anchored" data-anchor-id="evidence-for-heterogeneous-treatment-effects-policy-treat-best-responders-using-autoc">Evidence for heterogeneous treatment effects (policy = treat best responders) using AUTOC</h3>
<p>AUTOC uses logarithmic weighting to focus treatment on top responders.</p>
<p>Positive RATE estimates for: <strong>Charitable Giving</strong>.</p>
<p>Estimates (<strong>Charitable Giving</strong>: 0.259 (95% CI 0.245, 0.273)) show robust heterogeneity.</p>
<p>Negative RATE estimates for: Volunteering Hours.</p>
<p>Estimates (Volunteering Hours: -0.156 (95% CI -0.178, -0.134)) caution against CATE prioritisation.</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb16"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1"></a><span class="co"># only use if you have reliable qini results</span></span>
<span id="cb16-2"><a href="#cb16-2"></a><span class="cf">if</span> (<span class="fu">length</span>(reliable_ids) <span class="sc">&gt;</span> <span class="dv">0</span>) {</span>
<span id="cb16-3"><a href="#cb16-3"></a>  <span class="fu">cat</span>(qini_gain<span class="sc">$</span>qini_explanation)</span>
<span id="cb16-4"><a href="#cb16-4"></a>} <span class="cf">else</span> {</span>
<span id="cb16-5"><a href="#cb16-5"></a>  <span class="fu">cat</span>(<span class="st">"No significant heterogeneous treatment effects were detected using Qini curve analysis."</span>)</span>
<span id="cb16-6"><a href="#cb16-6"></a>}</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>The QINI curve compares targeted treatment allocation (based on individual treatment effects) versus uniform allocation (based on average treatment effect). Small differences in the expected values of the treatment after the entire population is treated are expected due to out of sample cross-validation (all estimates are tested on data the model has not seen). We computed expected policy effects from prioritising individuals by CATE at 10% and 40% spend levels.</p>
<p><strong>Charitable Giving</strong> At 10% spend: CATE prioritisation is beneficial (diff: 0.05 [95% CI 0.05, 0.06]). At 40% spend: CATE prioritisation is beneficial (diff: 0.12 [95% CI 0.10, 0.13]).</p>
<p><strong>Volunteering Hours</strong> At 10% spend: CATE prioritisation worsens outcomes compared to ATE. At 40% spend: No reliable benefits from CATE prioritisation.</p>
<div class="cell page-columns page-full" data-tbl-cap="Qini Curve Results">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb17"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1"></a><span class="co"># only use if you have multiple qini results</span></span>
<span id="cb17-2"><a href="#cb17-2"></a><span class="cf">if</span> (<span class="fu">length</span>(reliable_ids) <span class="sc">&gt;</span> <span class="dv">0</span>) {</span>
<span id="cb17-3"><a href="#cb17-3"></a>  knitr<span class="sc">::</span><span class="fu">kable</span>(</span>
<span id="cb17-4"><a href="#cb17-4"></a>    qini_gain<span class="sc">$</span>summary_table <span class="sc">|&gt;</span> </span>
<span id="cb17-5"><a href="#cb17-5"></a>      <span class="fu">mutate</span>(<span class="fu">across</span>(<span class="fu">where</span>(is.numeric), <span class="sc">~</span> <span class="fu">round</span>(., <span class="dv">2</span>))),</span>
<span id="cb17-6"><a href="#cb17-6"></a>    <span class="at">format =</span> <span class="st">"markdown"</span>,</span>
<span id="cb17-7"><a href="#cb17-7"></a>    <span class="at">caption =</span> <span class="st">"Qini Curve Results"</span></span>
<span id="cb17-8"><a href="#cb17-8"></a>  )</span>
<span id="cb17-9"><a href="#cb17-9"></a>} <span class="cf">else</span> {</span>
<span id="cb17-10"><a href="#cb17-10"></a>  <span class="fu">cat</span>(<span class="st">"*Note: Qini curve table only displayed when multiple significant results are found.*"</span>)</span>
<span id="cb17-11"><a href="#cb17-11"></a>}</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output-display page-columns page-full">
<table class="table table-sm table-striped small">

<thead>
<tr class="header">
<th style="text-align: left;">Model</th>
<th style="text-align: left;">Spend 10%</th>
<th style="text-align: left;">Spend 40%</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Charitable Giving</td>
<td style="text-align: left;"><strong>0.05 [0.05, 0.06]</strong></td>
<td style="text-align: left;"><strong>0.12 [0.10, 0.13]</strong></td>
</tr>
<tr class="even">
<td style="text-align: left;">Volunteering Hours</td>
<td style="text-align: left;"><em>-0.01 [-0.02, -0.00]</em></td>
<td style="text-align: left;">-0.01 [-0.03, 0.00]</td>
</tr>
</tbody>
</table>
<div class="quarto-table-caption margin-caption">Qini Curve Results</div></div>
</div>
<div class="page-columns page-full">
<div class="cell page-columns page-full">
<div class="cell-output-display page-columns page-full">
<div id="fig-qini-combined" class="quarto-float quarto-figure quarto-figure-center anchored page-columns page-full">
<figure class="quarto-float quarto-float-fig figure page-columns page-full">
<div aria-describedby="fig-qini-combined-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca" class="page-columns page-full">
<img src="06-interpretation-2_files/figure-html/fig-qini-combined-1.png" class="img-fluid figure-img column-screen" width="1152">
</div>
<figcaption class="quarto-float-caption-margin quarto-float-caption quarto-float-fig" id="fig-qini-combined-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;3: Qini Curves for Heterogeneous Treatment Effects
</figcaption>
</figure>
</div>
</div>
</div>
</div>
</section>
<section id="decision-rules-who-is-most-sensitive-to-treatment" class="level3 page-columns page-full">
<h3 class="anchored" data-anchor-id="decision-rules-who-is-most-sensitive-to-treatment">Decision Rules (Who is Most Sensitive to Treatment?)</h3>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb18"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1"></a><span class="fu">cat</span>(</span>
<span id="cb18-2"><a href="#cb18-2"></a>  boilerplate<span class="sc">::</span><span class="fu">boilerplate_generate_text</span>(</span>
<span id="cb18-3"><a href="#cb18-3"></a>    <span class="at">category     =</span> <span class="st">"results"</span>,</span>
<span id="cb18-4"><a href="#cb18-4"></a>    <span class="at">sections     =</span> <span class="fu">c</span>(<span class="st">"grf.interpretation_policy_tree"</span>),</span>
<span id="cb18-5"><a href="#cb18-5"></a>    <span class="at">global_vars  =</span> global_vars,</span>
<span id="cb18-6"><a href="#cb18-6"></a>    <span class="at">db           =</span> unified_db</span>
<span id="cb18-7"><a href="#cb18-7"></a>  )</span>
<span id="cb18-8"><a href="#cb18-8"></a>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<pre><code>ℹ generating results text with 1 sections</code></pre>
<pre><code>ℹ using results from unified database</code></pre>
<pre><code>ℹ processing section: grf.interpretation_policy_tree</code></pre>
<pre><code>ℹ applying template variables to grf.interpretation_policy_tree</code></pre>
<pre><code>✔ successfully generated results text with 1 section(s)</code></pre>
<section id="policy-trees" class="level4 page-columns page-full">
<h4 class="anchored" data-anchor-id="policy-trees">Policy Trees</h4>
<p>We used policy trees <span class="citation" data-cites="policytree_package_2024 athey2021 athey_2021_policy_tree_econometrica">(<a href="#ref-policytree_package_2024" role="doc-biblioref">Sverdrup et al. 2024</a>; <a href="#ref-athey2021" role="doc-biblioref">Athey and Wager 2021a</a>, <a href="#ref-athey_2021_policy_tree_econometrica" role="doc-biblioref">2021b</a>)</span> to find straightforward ‘if-then’ rules for who benefits most from treatment, based on participant characteristics. Because we flipped some measures, a higher predicted effect always means greater improvement. Policy trees can uncover small but important subgroups whose treatment responses stand out, even when the overall differences might be modest.</p>
<div class="no-row-height column-margin column-container"></div><p>The following pages present policy trees for each outcome with reliable heterogeneous effects. Each tree shows: (1) the decision rules for treatment assignment, (2) the distribution of treatment effects across subgroups, and (3) visual representation of how covariates split the population into groups with differential treatment responses.</p>
<div class="cell page-columns page-full">
<div class="cell-output cell-output-stdout">
<pre><code>

#### Policy Tree 1: Charitable Giving</code></pre>
</div>
<div class="cell-output-display page-columns page-full">
<div id="fig-policy-trees" class="quarto-float quarto-figure quarto-figure-center anchored page-columns page-full">
<figure class="quarto-float quarto-float-fig figure page-columns page-full">
<div aria-describedby="fig-policy-trees-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="06-interpretation-2_files/figure-html/fig-policy-trees-1.png" class="img-fluid figure-img" width="1344">
</div>
<figcaption class="quarto-float-caption-margin quarto-float-caption quarto-float-fig margin-caption" id="fig-policy-trees-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;4: Policy Trees for Treatment Assignment
</figcaption>
</figure>
</div>
</div>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb25"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1"></a><span class="co"># use this text below your decision tree graphs</span></span>
<span id="cb25-2"><a href="#cb25-2"></a><span class="cf">if</span> (<span class="fu">length</span>(reliable_ids) <span class="sc">&gt;</span> <span class="dv">0</span>) {</span>
<span id="cb25-3"><a href="#cb25-3"></a>  <span class="fu">cat</span>(policy_text, <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb25-4"><a href="#cb25-4"></a>}</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</section>
</section>
<section id="policy-tree-interpretations-depth-1" class="level3">
<h3 class="anchored" data-anchor-id="policy-tree-interpretations-depth-1">Policy Tree Interpretations (depth 1)</h3>
<section id="findings-for-charitable-giving-at-the-end-of-study" class="level4">
<h4 class="anchored" data-anchor-id="findings-for-charitable-giving-at-the-end-of-study">Findings for Charitable Giving at the end of study</h4>
<p>The policy-tree analysis divides cases on baseline Age. Those who score ≤ -0.726 (original: -0.726) are advised Control. Those above -0.726 (original: -0.726) are advised Treated.</p>
</section>
<section id="treatment-effect-heterogeneity" class="level4">
<h4 class="anchored" data-anchor-id="treatment-effect-heterogeneity">Treatment-effect heterogeneity</h4>
<p>The policy tree produces two terminal leaves. Conditional average treatment effects (CATEs) are estimated within each leaf:</p>
<ul>
<li><p><strong>Leaf 1—baseline age ≤ -0.726</strong> (n = 2,357; 23.6% of the test set): 68.1% were recommended control. The mean outcome under control was -0.101, the mean under treatment was 0.090, yielding a CATE of 0.191.</p></li>
<li><p><strong>Leaf 2—baseline age &gt; -0.726</strong> (n = 7,643; 76.4% of the test set): 97.1% were recommended treated. The mean outcome under control was -0.108, the mean under treatment was 0.088, yielding a CATE of 0.196.</p></li>
</ul>
</section>
<section id="overall-policy-performance" class="level4">
<h4 class="anchored" data-anchor-id="overall-policy-performance">Overall policy performance</h4>
<p>Across the full test set (N = 10,000), the policy prescribes control for 1,826 participants (18.3%) and treated for 8,174 participants (81.7%).</p>
</section>
</section>
</section>
<section id="discussion" class="level2">
<h2 class="anchored" data-anchor-id="discussion">Discussion</h2>
<div style="page-break-after: always;"></div>
</section>
<section id="appendix-explain-grf" class="level2">
<h2 class="anchored" data-anchor-id="appendix-explain-grf">S1: Estimating and Interpreting Heterogeneous Treatment Effects with GRF</h2>
<section id="qini-curves-1" class="level4">
<h4 class="anchored" data-anchor-id="qini-curves-1">Qini Curves</h4>
<p>The Qini curve shows the cumulative <strong>gain</strong> as we expand a targeting rule down the CATE ranking.</p>
<ul>
<li><strong>Beneficial exposure:</strong> we add individuals from the top positive CATEs downward; the baseline is ‘expose everyone.’</li>
<li><strong>Detrimental exposure:</strong> we first flip outcome direction (so higher values represent <strong>more harm</strong>; see ), then <em>add</em> the exposure starting with individuals whose CATEs show the <strong>greated harm</strong>, gradually including those predicted to be more resistant to harm; the baseline is ‘expose everyone.’ The curve therefore quantifies the harm by when those most suceptible to harm are exposed.</li>
</ul>
</section>
</section>
<section id="appendix-strengths" class="level2 page-columns page-full">
<h2 class="anchored" data-anchor-id="appendix-strengths">S2: Strengths and Limitations of Causal Forests</h2>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb26"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1"></a><span class="fu">cat</span>(</span>
<span id="cb26-2"><a href="#cb26-2"></a>  boilerplate<span class="sc">::</span><span class="fu">boilerplate_generate_text</span>(</span>
<span id="cb26-3"><a href="#cb26-3"></a>    <span class="at">category     =</span> <span class="st">"discussion"</span>,</span>
<span id="cb26-4"><a href="#cb26-4"></a>    <span class="at">sections     =</span> <span class="fu">c</span>(<span class="st">"strengths.strengths_grf_short"</span>),</span>
<span id="cb26-5"><a href="#cb26-5"></a>    <span class="at">global_vars  =</span> global_vars,</span>
<span id="cb26-6"><a href="#cb26-6"></a>    <span class="at">db           =</span> unified_db</span>
<span id="cb26-7"><a href="#cb26-7"></a>  )</span>
<span id="cb26-8"><a href="#cb26-8"></a>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<pre><code>ℹ generating discussion text with 1 sections</code></pre>
<pre><code>ℹ using discussion from unified database</code></pre>
<pre><code>ℹ processing section: strengths.strengths_grf_short</code></pre>
<pre><code>ℹ applying template variables to strengths.strengths_grf_short</code></pre>
<pre><code>✔ successfully generated discussion text with 1 section(s)</code></pre>
<p>We used causal forests to uncover how the treatment effect changes across people who differ in age, gender, baseline scores, and other measured characteristics <span class="citation" data-cites="grf2024">(<a href="#ref-grf2024" role="doc-biblioref">Tibshirani et al. 2024</a>)</span>. This flexible, non-parametric method avoids the rigid functional‐form assumptions of linear or logistic regression and can capture complex, higher-order interactions that would otherwise be missed.</p>
<div class="no-row-height column-margin column-container"><div id="ref-grf2024" class="csl-entry" role="listitem">
Tibshirani, Julie, Susan Athey, Erik Sverdrup, and Stefan Wager. 2024. <em>Grf: Generalized Random Forests</em>. <a href="https://github.com/grf-labs/grf">https://github.com/grf-labs/grf</a>.
</div><div id="ref-policytree_package_2024" class="csl-entry" role="listitem">
Sverdrup, Erik, Ayush Kanodia, Zhengyuan Zhou, Susan Athey, and Stefan Wager. 2024. <em>Policytree: Policy Learning via Doubly Robust Empirical Welfare Maximization over Trees</em>. <a href="https://CRAN.R-project.org/package=policytree">https://CRAN.R-project.org/package=policytree</a>.
</div><div id="ref-athey2021" class="csl-entry" role="listitem">
Athey, Susan, and Stefan Wager. 2021a. <span>“Policy Learning With Observational Data.”</span> <em>Econometrica</em> 89 (1): 133–61. <a href="https://doi.org/10.3982/ECTA15732">https://doi.org/10.3982/ECTA15732</a>.
</div><div id="ref-athey_2021_policy_tree_econometrica" class="csl-entry" role="listitem">
———. 2021b. <span>“Policy Learning with Observational Data.”</span> <em>Econometrica</em> 89 (1): 133–61. https://doi.org/<a href="https://doi.org/10.3982/ECTA15732">https://doi.org/10.3982/ECTA15732</a>.
</div><div id="ref-wager2018" class="csl-entry" role="listitem">
Wager, Stefan, and Susan Athey. 2018. <span>“Estimation and Inference of Heterogeneous Treatment Effects Using Random Forests.”</span> <em>Journal of the American Statistical Association</em> 113 (523): 1228–42. <a href="https://doi.org/10.1080/01621459.2017.1319839">https://doi.org/10.1080/01621459.2017.1319839</a>.
</div></div><p>To guard against over-fitting we split the data: one portion trained the forest, and the other evaluated its predictions train/test ratio: 50/50. On the evaluation set we computed three complementary metrics: (i) rate statistics: the area under the treatment–outcome curve (AUTOC) which summarise how well the model ranks individuals from ‘most likely to benefit’ to ‘least likely to benefit’ based on their baseline caracteristics; (ii) Qini curves which show the cumulative gain achieved by treating successively larger fractions of the population – which is relevant to understanding gains from different spend levels. policy trees, which convert the forest’s complex predictions into a short set of human-readable if–then rules that can guide targeting in practice <span class="citation" data-cites="policytree_package_2024 athey2021 athey_2021_policy_tree_econometrica">(<a href="#ref-policytree_package_2024" role="doc-biblioref">Sverdrup et al. 2024</a>; <a href="#ref-athey2021" role="doc-biblioref">Athey and Wager 2021a</a>, <a href="#ref-athey_2021_policy_tree_econometrica" role="doc-biblioref">2021b</a>)</span>. Collectively, these tools help to clarify whether heterogeneous effects exist, and also how much extra benefit a data-driven targeting policy might yield over random allocation <span class="citation" data-cites="wager2018">(<a href="#ref-wager2018" role="doc-biblioref">Wager and Athey 2018</a>)</span>.</p>
<p>Although causal forests improve on traditional parametric methods, every observational approach carries risks.</p>
<p>First, causal inference in observational settings inevitably relies on untestable ignorability assumptions (treatments are ‘as good as random’ conditional on measured covariates). Whether we have measured all factors that may jointly influence treatment assignment and the outcomes cannot be evaluated by statistical tests. If strong common causes of both the exposure and outcome are unobserved or poorly measured, our estimates will be biased. Interpreting subgroup findings can also be challenging: statistically significant differences are not always large enough to matter in real life. More basic, perhaps, methods for detecting real differences rely on measures that are, in survey research, inherently noisy, and noise often, but no always, attenuates affects. The twin dangers of mistaking noise for signal, or of obscuring singles from noise, abide. Such limitations must be kept firmly in mind when interpreting results.</p>
</section>
<section id="references" class="level2 appendix-refs">
<h2 class="appendix-refs anchored" data-anchor-id="references">References</h2>


<!-- -->


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    // Ensure there is a toggle, if there isn't float one in the top right
    if (window.document.querySelector('.quarto-color-scheme-toggle') === null) {
      const a = window.document.createElement('a');
      a.classList.add('top-right');
      a.classList.add('quarto-color-scheme-toggle');
      a.href = "";
      a.onclick = function() { try { window.quartoToggleColorScheme(); } catch {} return false; };
      const i = window.document.createElement("i");
      i.classList.add('bi');
      a.appendChild(i);
      window.document.body.appendChild(a);
    }
    setColorSchemeToggle(hasAlternateSentinel())
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
      const outerScaffold = trigger.parentElement.cloneNode(true);
      const codeEl = outerScaffold.querySelector('code');
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
    const viewSource = window.document.getElementById('quarto-view-source') ||
                       window.document.getElementById('quarto-code-tools-source');
    if (viewSource) {
      const sourceUrl = viewSource.getAttribute("data-quarto-source-url");
      viewSource.addEventListener("click", function(e) {
        if (sourceUrl) {
          // rstudio viewer pane
          if (/\bcapabilities=\b/.test(window.location)) {
            window.open(sourceUrl);
          } else {
            window.location.href = sourceUrl;
          }
        } else {
          const modal = new bootstrap.Modal(document.getElementById('quarto-embedded-source-code-modal'));
          modal.show();
        }
        return false;
      });
    }
    function toggleCodeHandler(show) {
      return function(e) {
        const detailsSrc = window.document.querySelectorAll(".cell > details > .sourceCode");
        for (let i=0; i<detailsSrc.length; i++) {
          const details = detailsSrc[i].parentElement;
          if (show) {
            details.open = true;
          } else {
            details.removeAttribute("open");
          }
        }
        const cellCodeDivs = window.document.querySelectorAll(".cell > .sourceCode");
        const fromCls = show ? "hidden" : "unhidden";
        const toCls = show ? "unhidden" : "hidden";
        for (let i=0; i<cellCodeDivs.length; i++) {
          const codeDiv = cellCodeDivs[i];
          if (codeDiv.classList.contains(fromCls)) {
            codeDiv.classList.remove(fromCls);
            codeDiv.classList.add(toCls);
          } 
        }
        return false;
      }
    }
    const hideAllCode = window.document.getElementById("quarto-hide-all-code");
    if (hideAllCode) {
      hideAllCode.addEventListener("click", toggleCodeHandler(false));
    }
    const showAllCode = window.document.getElementById("quarto-show-all-code");
    if (showAllCode) {
      showAllCode.addEventListener("click", toggleCodeHandler(true));
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp('/' + window.location.host + '/');
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
            // target, if specified
            link.setAttribute("target", "_blank");
            if (link.getAttribute("rel") === null) {
              link.setAttribute("rel", "noopener");
            }
            // default icon
            link.classList.add("external");
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script><div class="modal fade" id="quarto-embedded-source-code-modal" tabindex="-1" aria-labelledby="quarto-embedded-source-code-modal-label" aria-hidden="true"><div class="modal-dialog modal-dialog-scrollable"><div class="modal-content"><div class="modal-header"><h5 class="modal-title" id="quarto-embedded-source-code-modal-label">Source Code</h5><button class="btn-close" data-bs-dismiss="modal"></button></div><div class="modal-body"><div class="">
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb32" data-shortcodes="false"><pre class="sourceCode numberSource markdown number-lines code-with-copy"><code class="sourceCode markdown"><span id="cb32-1"><a href="#cb32-1"></a><span class="co">---</span></span>
<span id="cb32-2"><a href="#cb32-2"></a><span class="an">title:</span><span class="co"> "Estimating ATE and CATE using Causal Forests"</span></span>
<span id="cb32-3"><a href="#cb32-3"></a><span class="an">subtitle:</span><span class="co"> ""</span></span>
<span id="cb32-4"><a href="#cb32-4"></a><span class="an">format:</span></span>
<span id="cb32-5"><a href="#cb32-5"></a><span class="co">  html:</span></span>
<span id="cb32-6"><a href="#cb32-6"></a><span class="co">    warnings: false</span></span>
<span id="cb32-7"><a href="#cb32-7"></a><span class="co">    error: false</span></span>
<span id="cb32-8"><a href="#cb32-8"></a><span class="co">    message: false</span></span>
<span id="cb32-9"><a href="#cb32-9"></a><span class="co">    echo: true</span></span>
<span id="cb32-10"><a href="#cb32-10"></a><span class="co">    output: true</span></span>
<span id="cb32-11"><a href="#cb32-11"></a><span class="co">    code-overflow: scroll</span></span>
<span id="cb32-12"><a href="#cb32-12"></a><span class="co">    highlight-style: Ayu</span></span>
<span id="cb32-13"><a href="#cb32-13"></a><span class="co">    code-line-numbers: true</span></span>
<span id="cb32-14"><a href="#cb32-14"></a><span class="co">    code-fold: false</span></span>
<span id="cb32-15"><a href="#cb32-15"></a><span class="co">    code-tools:</span></span>
<span id="cb32-16"><a href="#cb32-16"></a><span class="co">      source: true</span></span>
<span id="cb32-17"><a href="#cb32-17"></a><span class="co">      toggle: false</span></span>
<span id="cb32-18"><a href="#cb32-18"></a><span class="an">html-math-method:</span><span class="co"> katex</span></span>
<span id="cb32-19"><a href="#cb32-19"></a><span class="an">reference-location:</span><span class="co"> margin</span></span>
<span id="cb32-20"><a href="#cb32-20"></a><span class="an">citation-location:</span><span class="co"> margin</span></span>
<span id="cb32-21"><a href="#cb32-21"></a><span class="an">cap-location:</span><span class="co"> margin</span></span>
<span id="cb32-22"><a href="#cb32-22"></a><span class="an">code-block-border-left:</span><span class="co"> true</span></span>
<span id="cb32-23"><a href="#cb32-23"></a><span class="an">bibliography:</span><span class="co"> /Users/joseph/GIT/templates/bib/references.bib</span></span>
<span id="cb32-24"><a href="#cb32-24"></a><span class="an">editor_options:</span><span class="co"> </span></span>
<span id="cb32-25"><a href="#cb32-25"></a><span class="co">  chunk_output_type: console</span></span>
<span id="cb32-26"><a href="#cb32-26"></a><span class="co">---</span></span>
<span id="cb32-27"><a href="#cb32-27"></a></span>
<span id="cb32-30"><a href="#cb32-30"></a><span class="in">```{r}</span></span>
<span id="cb32-31"><a href="#cb32-31"></a><span class="co">#| label: setup</span></span>
<span id="cb32-32"><a href="#cb32-32"></a><span class="co">#| echo: false</span></span>
<span id="cb32-33"><a href="#cb32-33"></a><span class="co">#| include: false</span></span>
<span id="cb32-34"><a href="#cb32-34"></a><span class="co">#| eval: true</span></span>
<span id="cb32-35"><a href="#cb32-35"></a></span>
<span id="cb32-36"><a href="#cb32-36"></a><span class="co"># ── initialisation and setup ──────────────────────────────────────────────────</span></span>
<span id="cb32-37"><a href="#cb32-37"></a></span>
<span id="cb32-38"><a href="#cb32-38"></a><span class="co"># save this file in your project root (e.g. 'quarto/1_setup.R')</span></span>
<span id="cb32-39"><a href="#cb32-39"></a><span class="co"># load here to manage paths</span></span>
<span id="cb32-40"><a href="#cb32-40"></a>dep <span class="ot">&lt;-</span> <span class="fu">requireNamespace</span>(<span class="st">"here"</span>, <span class="at">quietly =</span> <span class="cn">TRUE</span>)</span>
<span id="cb32-41"><a href="#cb32-41"></a><span class="cf">if</span> (<span class="sc">!</span>dep) <span class="fu">install.packages</span>(<span class="st">"here"</span>)</span>
<span id="cb32-42"><a href="#cb32-42"></a><span class="fu">library</span>(here)</span>
<span id="cb32-43"><a href="#cb32-43"></a></span>
<span id="cb32-44"><a href="#cb32-44"></a><span class="co"># create required folders (these will likely already exist)</span></span>
<span id="cb32-45"><a href="#cb32-45"></a>dirs <span class="ot">&lt;-</span> <span class="fu">c</span>(</span>
<span id="cb32-46"><a href="#cb32-46"></a>  <span class="fu">here</span>(<span class="st">"quarto"</span>),</span>
<span id="cb32-47"><a href="#cb32-47"></a>  <span class="fu">here</span>(<span class="st">"bibliography"</span>),</span>
<span id="cb32-48"><a href="#cb32-48"></a>  <span class="fu">here</span>(<span class="st">"save_directory"</span>),</span>
<span id="cb32-49"><a href="#cb32-49"></a>  <span class="fu">here</span>(<span class="st">"csl"</span>)</span>
<span id="cb32-50"><a href="#cb32-50"></a>)</span>
<span id="cb32-51"><a href="#cb32-51"></a><span class="cf">for</span> (d <span class="cf">in</span> dirs) {</span>
<span id="cb32-52"><a href="#cb32-52"></a>  <span class="cf">if</span> (<span class="sc">!</span><span class="fu">dir.exists</span>(d)) <span class="fu">dir.create</span>(d, <span class="at">recursive =</span> <span class="cn">TRUE</span>)</span>
<span id="cb32-53"><a href="#cb32-53"></a>}</span>
<span id="cb32-54"><a href="#cb32-54"></a></span>
<span id="cb32-55"><a href="#cb32-55"></a><span class="co"># ensure tinytex for PDF rendering</span></span>
<span id="cb32-56"><a href="#cb32-56"></a><span class="cf">if</span> (<span class="sc">!</span><span class="fu">requireNamespace</span>(<span class="st">"tinytex"</span>, <span class="at">quietly =</span> <span class="cn">TRUE</span>)) {</span>
<span id="cb32-57"><a href="#cb32-57"></a>  <span class="fu">install.packages</span>(<span class="st">"tinytex"</span>)</span>
<span id="cb32-58"><a href="#cb32-58"></a>  tinytex<span class="sc">::</span><span class="fu">install_tinytex</span>()</span>
<span id="cb32-59"><a href="#cb32-59"></a>}</span>
<span id="cb32-60"><a href="#cb32-60"></a></span>
<span id="cb32-61"><a href="#cb32-61"></a><span class="co"># ensure pacman for package management</span></span>
<span id="cb32-62"><a href="#cb32-62"></a><span class="cf">if</span> (<span class="sc">!</span><span class="fu">requireNamespace</span>(<span class="st">"pacman"</span>, <span class="at">quietly =</span> <span class="cn">TRUE</span>)) {</span>
<span id="cb32-63"><a href="#cb32-63"></a>  <span class="fu">install.packages</span>(<span class="st">"pacman"</span>)</span>
<span id="cb32-64"><a href="#cb32-64"></a>}</span>
<span id="cb32-65"><a href="#cb32-65"></a></span>
<span id="cb32-66"><a href="#cb32-66"></a><span class="co"># min version of margot</span></span>
<span id="cb32-67"><a href="#cb32-67"></a><span class="cf">if</span> (<span class="fu">packageVersion</span>(<span class="st">"margot"</span>) <span class="sc">&lt;</span> <span class="st">"1.0.233"</span>) {</span>
<span id="cb32-68"><a href="#cb32-68"></a>  <span class="fu">stop</span>(</span>
<span id="cb32-69"><a href="#cb32-69"></a>    <span class="st">"please install margot &gt;= 1.0.233 for this workflow</span><span class="sc">\n</span></span>
<span id="cb32-70"><a href="#cb32-70"></a><span class="st">       run: </span></span>
<span id="cb32-71"><a href="#cb32-71"></a><span class="st">       devtools::install_github('go-bayes/margot')</span></span>
<span id="cb32-72"><a href="#cb32-72"></a><span class="st">"</span></span>
<span id="cb32-73"><a href="#cb32-73"></a>  )</span>
<span id="cb32-74"><a href="#cb32-74"></a>}</span>
<span id="cb32-75"><a href="#cb32-75"></a></span>
<span id="cb32-76"><a href="#cb32-76"></a><span class="co"># call library</span></span>
<span id="cb32-77"><a href="#cb32-77"></a><span class="fu">library</span>(<span class="st">"margot"</span>)</span>
<span id="cb32-78"><a href="#cb32-78"></a></span>
<span id="cb32-79"><a href="#cb32-79"></a><span class="co"># check package version</span></span>
<span id="cb32-80"><a href="#cb32-80"></a><span class="fu">packageVersion</span>(<span class="at">pkg =</span> <span class="st">"margot"</span>)</span>
<span id="cb32-81"><a href="#cb32-81"></a></span>
<span id="cb32-82"><a href="#cb32-82"></a><span class="co"># load (and install if needed) all required packages</span></span>
<span id="cb32-83"><a href="#cb32-83"></a>pacman<span class="sc">::</span><span class="fu">p_load</span>(</span>
<span id="cb32-84"><a href="#cb32-84"></a>  boilerplate, shiny, tidyverse,</span>
<span id="cb32-85"><a href="#cb32-85"></a>  kableExtra, glue, patchwork, stringr,</span>
<span id="cb32-86"><a href="#cb32-86"></a>  ggplot2, ggeffects, parameters,</span>
<span id="cb32-87"><a href="#cb32-87"></a>  table1, knitr, extrafont, here, cli</span>
<span id="cb32-88"><a href="#cb32-88"></a>)</span>
<span id="cb32-89"><a href="#cb32-89"></a></span>
<span id="cb32-90"><a href="#cb32-90"></a><span class="co"># load fonts (requires prior extrafont::font_import())</span></span>
<span id="cb32-91"><a href="#cb32-91"></a><span class="cf">if</span> (<span class="fu">requireNamespace</span>(<span class="st">"extrafont"</span>, <span class="at">quietly =</span> <span class="cn">TRUE</span>)) {</span>
<span id="cb32-92"><a href="#cb32-92"></a>  extrafont<span class="sc">::</span><span class="fu">loadfonts</span>(<span class="at">device =</span> <span class="st">"all"</span>)</span>
<span id="cb32-93"><a href="#cb32-93"></a>} <span class="cf">else</span> {</span>
<span id="cb32-94"><a href="#cb32-94"></a>  <span class="fu">message</span>(<span class="st">"'extrafont' not installed; skipping font loading"</span>)</span>
<span id="cb32-95"><a href="#cb32-95"></a>}</span>
<span id="cb32-96"><a href="#cb32-96"></a></span>
<span id="cb32-97"><a href="#cb32-97"></a><span class="co"># reproducibility</span></span>
<span id="cb32-98"><a href="#cb32-98"></a><span class="fu">set.seed</span>(<span class="dv">123</span>)</span>
<span id="cb32-99"><a href="#cb32-99"></a></span>
<span id="cb32-100"><a href="#cb32-100"></a><span class="co"># copy CSL and BibTeX into quarto folder</span></span>
<span id="cb32-101"><a href="#cb32-101"></a>src_files <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb32-102"><a href="#cb32-102"></a>  <span class="fu">c</span>(<span class="fu">here</span>(<span class="st">"csl"</span>, <span class="st">"apa7.csl"</span>),     <span class="fu">here</span>(<span class="st">"quarto"</span>, <span class="st">"apa7.csl"</span>)),</span>
<span id="cb32-103"><a href="#cb32-103"></a>  <span class="fu">c</span>(<span class="fu">here</span>(<span class="st">"bibliography"</span>, <span class="st">"references.bib"</span>), <span class="fu">here</span>(<span class="st">"quarto"</span>, <span class="st">"references.bib"</span>))</span>
<span id="cb32-104"><a href="#cb32-104"></a>)</span>
<span id="cb32-105"><a href="#cb32-105"></a><span class="cf">for</span> (f <span class="cf">in</span> src_files) {</span>
<span id="cb32-106"><a href="#cb32-106"></a>  <span class="cf">if</span> (<span class="sc">!</span><span class="fu">file.exists</span>(f[<span class="dv">2</span>]) <span class="sc">&amp;&amp;</span> <span class="fu">file.exists</span>(f[<span class="dv">1</span>])) {</span>
<span id="cb32-107"><a href="#cb32-107"></a>    <span class="fu">file.copy</span>(f[<span class="dv">1</span>], f[<span class="dv">2</span>])</span>
<span id="cb32-108"><a href="#cb32-108"></a>  }</span>
<span id="cb32-109"><a href="#cb32-109"></a>}</span>
<span id="cb32-110"><a href="#cb32-110"></a></span>
<span id="cb32-111"><a href="#cb32-111"></a><span class="co"># ── define paths and import data ──────────────────────────────────────────────</span></span>
<span id="cb32-112"><a href="#cb32-112"></a>push_mods  <span class="ot">&lt;-</span> here<span class="sc">::</span><span class="fu">here</span>(<span class="st">"results"</span>)</span>
<span id="cb32-113"><a href="#cb32-113"></a>master_path <span class="ot">&lt;-</span> <span class="st">"/Users/joseph/GIT/templates/boilerplate/data/boilerplate_unified.json"</span></span>
<span id="cb32-114"><a href="#cb32-114"></a><span class="co"># set directory database path</span></span>
<span id="cb32-115"><a href="#cb32-115"></a></span>
<span id="cb32-116"><a href="#cb32-116"></a>unified_db <span class="ot">&lt;-</span> <span class="fu">boilerplate_import</span>(<span class="at">data_path =</span> master_path)</span>
<span id="cb32-117"><a href="#cb32-117"></a><span class="co"># ── import data for visualisation ─────────────────────────────────────────────</span></span>
<span id="cb32-118"><a href="#cb32-118"></a>original_df <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(here<span class="sc">::</span><span class="fu">here</span>(<span class="st">"data"</span>, <span class="st">"religious_prosocial_data.rds"</span>))</span>
<span id="cb32-119"><a href="#cb32-119"></a></span>
<span id="cb32-120"><a href="#cb32-120"></a><span class="co"># data used in model fitting</span></span>
<span id="cb32-121"><a href="#cb32-121"></a>df_grf  <span class="ot">&lt;-</span> margot<span class="sc">::</span><span class="fu">here_read</span>(<span class="st">'data_standardised'</span>, <span class="at">dir_path =</span> here<span class="sc">::</span><span class="fu">here</span>(<span class="st">'data'</span>))</span>
<span id="cb32-122"><a href="#cb32-122"></a></span>
<span id="cb32-123"><a href="#cb32-123"></a><span class="co"># import</span></span>
<span id="cb32-124"><a href="#cb32-124"></a>label_mapping <span class="ot">=</span> <span class="fu">here_read</span>(<span class="st">"label_mapping"</span>, push_mods)</span>
<span id="cb32-125"><a href="#cb32-125"></a></span>
<span id="cb32-126"><a href="#cb32-126"></a><span class="co"># # co-variates</span></span>
<span id="cb32-127"><a href="#cb32-127"></a><span class="co"># E                          &lt;- margot::here_read('E', push_mods)</span></span>
<span id="cb32-128"><a href="#cb32-128"></a><span class="co"># # select covariates and drop numeric attributes</span></span>
<span id="cb32-129"><a href="#cb32-129"></a><span class="co"># X                          &lt;- margot::remove_numeric_attributes(df_grf[E])</span></span>
<span id="cb32-130"><a href="#cb32-130"></a></span>
<span id="cb32-131"><a href="#cb32-131"></a><span class="co"># ── define nice names and regimes ─────────────────────────────────────────────</span></span>
<span id="cb32-132"><a href="#cb32-132"></a><span class="co"># title</span></span>
<span id="cb32-133"><a href="#cb32-133"></a>ate_title                  <span class="ot">&lt;-</span> <span class="fu">glue</span>(<span class="st">"ATE Effects of Belief in God on Cooperative outcomes"</span>)</span>
<span id="cb32-134"><a href="#cb32-134"></a></span>
<span id="cb32-135"><a href="#cb32-135"></a><span class="co"># ── set plot defaults for ate plots ───────────────────────────────────────────</span></span>
<span id="cb32-136"><a href="#cb32-136"></a>base_defaults_binary       <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb32-137"><a href="#cb32-137"></a>  <span class="at">type                     =</span> <span class="st">"RD"</span>,</span>
<span id="cb32-138"><a href="#cb32-138"></a>  <span class="at">title                    =</span> ate_title,</span>
<span id="cb32-139"><a href="#cb32-139"></a>  <span class="at">e_val_bound_threshold    =</span> <span class="fl">1.2</span>,</span>
<span id="cb32-140"><a href="#cb32-140"></a>  <span class="at">colors                   =</span> <span class="fu">c</span>(</span>
<span id="cb32-141"><a href="#cb32-141"></a>    <span class="st">"positive"</span>     <span class="ot">=</span> <span class="st">"#E69F00"</span>,</span>
<span id="cb32-142"><a href="#cb32-142"></a>    <span class="st">"not reliable"</span> <span class="ot">=</span> <span class="st">"grey50"</span>,</span>
<span id="cb32-143"><a href="#cb32-143"></a>    <span class="st">"negative"</span>     <span class="ot">=</span> <span class="st">"#56B4E9"</span></span>
<span id="cb32-144"><a href="#cb32-144"></a>  ),</span>
<span id="cb32-145"><a href="#cb32-145"></a>  <span class="at">x_offset                 =</span> <span class="sc">-</span>.<span class="dv">5</span>,</span>
<span id="cb32-146"><a href="#cb32-146"></a>  <span class="at">x_lim_lo                 =</span> <span class="sc">-</span>.<span class="dv">5</span>,</span>
<span id="cb32-147"><a href="#cb32-147"></a>  <span class="at">x_lim_hi                 =</span> <span class="dv">1</span>,</span>
<span id="cb32-148"><a href="#cb32-148"></a>  <span class="at">text_size                =</span> <span class="dv">5</span>,</span>
<span id="cb32-149"><a href="#cb32-149"></a>  <span class="at">linewidth                =</span> <span class="fl">0.75</span>,</span>
<span id="cb32-150"><a href="#cb32-150"></a>  <span class="at">estimate_scale           =</span> <span class="dv">1</span>,</span>
<span id="cb32-151"><a href="#cb32-151"></a>  <span class="at">base_size                =</span> <span class="dv">20</span>,</span>
<span id="cb32-152"><a href="#cb32-152"></a>  <span class="at">point_size               =</span> <span class="dv">4</span>,</span>
<span id="cb32-153"><a href="#cb32-153"></a>  <span class="at">title_size               =</span> <span class="dv">20</span>,</span>
<span id="cb32-154"><a href="#cb32-154"></a>  <span class="at">subtitle_size            =</span> <span class="dv">16</span>,</span>
<span id="cb32-155"><a href="#cb32-155"></a>  <span class="at">legend_text_size         =</span> <span class="dv">10</span>,</span>
<span id="cb32-156"><a href="#cb32-156"></a>  <span class="at">legend_title_size        =</span> <span class="dv">10</span>,</span>
<span id="cb32-157"><a href="#cb32-157"></a>  <span class="at">include_coefficients     =</span> <span class="cn">FALSE</span></span>
<span id="cb32-158"><a href="#cb32-158"></a>)</span>
<span id="cb32-159"><a href="#cb32-159"></a></span>
<span id="cb32-160"><a href="#cb32-160"></a><span class="co"># ── create plot options for outcomes ──────────────────────────────────────────</span></span>
<span id="cb32-161"><a href="#cb32-161"></a>outcomes_options_all       <span class="ot">&lt;-</span> <span class="fu">margot_plot_create_options</span>(</span>
<span id="cb32-162"><a href="#cb32-162"></a>  <span class="at">title           =</span> ate_title,</span>
<span id="cb32-163"><a href="#cb32-163"></a>  <span class="at">base_defaults   =</span> base_defaults_binary,</span>
<span id="cb32-164"><a href="#cb32-164"></a>  <span class="at">subtitle        =</span> <span class="st">""</span>,</span>
<span id="cb32-165"><a href="#cb32-165"></a>  <span class="at">filename_prefix =</span> <span class="st">"grf"</span></span>
<span id="cb32-166"><a href="#cb32-166"></a>)</span>
<span id="cb32-167"><a href="#cb32-167"></a></span>
<span id="cb32-168"><a href="#cb32-168"></a><span class="co"># ── load model results ────────────────────────────────────────────────────────</span></span>
<span id="cb32-169"><a href="#cb32-169"></a>models_binary_cate  <span class="ot">&lt;-</span> margot<span class="sc">::</span><span class="fu">here_read_qs</span>(<span class="st">"models_binary_cate"</span>, push_mods)</span>
<span id="cb32-170"><a href="#cb32-170"></a></span>
<span id="cb32-171"><a href="#cb32-171"></a><span class="co"># ──────────────────────────────────────────────────────────────────────────────</span></span>
<span id="cb32-172"><a href="#cb32-172"></a><span class="co"># CRITICAL DECISION POINT: FLIPPED OUTCOMES OR NOT</span></span>
<span id="cb32-173"><a href="#cb32-173"></a><span class="co"># ──────────────────────────────────────────────────────────────────────────────</span></span>
<span id="cb32-174"><a href="#cb32-174"></a></span>
<span id="cb32-175"><a href="#cb32-175"></a><span class="co"># ********** READ THIS CAREFULLY **********</span></span>
<span id="cb32-176"><a href="#cb32-176"></a><span class="co"># if you DID NOT flip any outcomes:</span></span>
<span id="cb32-177"><a href="#cb32-177"></a><span class="co">#   - set: use_flipped &lt;- FALSE</span></span>
<span id="cb32-178"><a href="#cb32-178"></a><span class="co">#   - this will use models_binary throughout</span></span>
<span id="cb32-179"><a href="#cb32-179"></a><span class="co">#   - this will use label_mapping_all throughout</span></span>
<span id="cb32-180"><a href="#cb32-180"></a><span class="co">#</span></span>
<span id="cb32-181"><a href="#cb32-181"></a><span class="co"># if you DID flip outcomes:</span></span>
<span id="cb32-182"><a href="#cb32-182"></a><span class="co">#   - set: use_flipped &lt;- TRUE</span></span>
<span id="cb32-183"><a href="#cb32-183"></a><span class="co">#   - ensure models_binary_flipped_all exists</span></span>
<span id="cb32-184"><a href="#cb32-184"></a><span class="co">#   - ensure flip_outcomes vector exists</span></span>
<span id="cb32-185"><a href="#cb32-185"></a><span class="co">#   - this will create label_mapping_all_flipped</span></span>
<span id="cb32-186"><a href="#cb32-186"></a></span>
<span id="cb32-187"><a href="#cb32-187"></a>use_flipped <span class="ot">&lt;-</span> <span class="cn">FALSE</span>  <span class="co"># &lt;- MAKE TRUE IF YOU FLIPPED OUTCOMES, `FALSE` otherwise </span></span>
<span id="cb32-188"><a href="#cb32-188"></a></span>
<span id="cb32-189"><a href="#cb32-189"></a><span class="co"># set up variables based on whether outcomes were flipped</span></span>
<span id="cb32-190"><a href="#cb32-190"></a><span class="cf">if</span> (use_flipped) {</span>
<span id="cb32-191"><a href="#cb32-191"></a>  <span class="co"># check that required objects exist</span></span>
<span id="cb32-192"><a href="#cb32-192"></a>  <span class="cf">if</span> (<span class="sc">!</span><span class="fu">exists</span>(<span class="st">"models_binary_flipped_all"</span>)) {</span>
<span id="cb32-193"><a href="#cb32-193"></a>    models_binary_flipped_all <span class="ot">&lt;-</span> <span class="fu">here_read_qs</span>(<span class="st">"models_binary_flipped_all"</span>, push_mods)</span>
<span id="cb32-194"><a href="#cb32-194"></a>  }</span>
<span id="cb32-195"><a href="#cb32-195"></a>  </span>
<span id="cb32-196"><a href="#cb32-196"></a>  <span class="co"># try to read flip_outcomes and flipped_names</span></span>
<span id="cb32-197"><a href="#cb32-197"></a>  <span class="co"># use tryCatch to handle missing files gracefully</span></span>
<span id="cb32-198"><a href="#cb32-198"></a>  flip_outcomes <span class="ot">&lt;-</span> <span class="fu">tryCatch</span>(</span>
<span id="cb32-199"><a href="#cb32-199"></a>    <span class="fu">here_read</span>(<span class="st">"flip_outcomes"</span>),</span>
<span id="cb32-200"><a href="#cb32-200"></a>    <span class="at">error =</span> <span class="cf">function</span>(e) {</span>
<span id="cb32-201"><a href="#cb32-201"></a>      <span class="fu">stop</span>(<span class="st">"flip_outcomes file not found. Please ensure it exists if use_flipped = TRUE"</span>)</span>
<span id="cb32-202"><a href="#cb32-202"></a>    }</span>
<span id="cb32-203"><a href="#cb32-203"></a>  )</span>
<span id="cb32-204"><a href="#cb32-204"></a>  </span>
<span id="cb32-205"><a href="#cb32-205"></a>  flipped_names <span class="ot">&lt;-</span> <span class="fu">tryCatch</span>(</span>
<span id="cb32-206"><a href="#cb32-206"></a>    <span class="fu">here_read</span>(<span class="st">"flipped_names"</span>),</span>
<span id="cb32-207"><a href="#cb32-207"></a>    <span class="at">error =</span> <span class="cf">function</span>(e) {</span>
<span id="cb32-208"><a href="#cb32-208"></a>      <span class="fu">stop</span>(<span class="st">"flipped_names file not found. Please ensure it exists if use_flipped = TRUE"</span>)</span>
<span id="cb32-209"><a href="#cb32-209"></a>    }</span>
<span id="cb32-210"><a href="#cb32-210"></a>  )</span>
<span id="cb32-211"><a href="#cb32-211"></a>  </span>
<span id="cb32-212"><a href="#cb32-212"></a>  <span class="co"># create flipped label mapping</span></span>
<span id="cb32-213"><a href="#cb32-213"></a>  label_mapping_all_flipped <span class="ot">&lt;-</span> <span class="fu">margot_reversed_labels</span>(label_mapping_all, flip_outcomes)</span>
<span id="cb32-214"><a href="#cb32-214"></a>  </span>
<span id="cb32-215"><a href="#cb32-215"></a>  <span class="co"># use flipped models and labels</span></span>
<span id="cb32-216"><a href="#cb32-216"></a>  models_for_analysis <span class="ot">&lt;-</span> models_binary_flipped_all</span>
<span id="cb32-217"><a href="#cb32-217"></a>  labels_for_analysis <span class="ot">&lt;-</span> label_mapping_all_flipped</span>
<span id="cb32-218"><a href="#cb32-218"></a>  flipped_list <span class="ot">&lt;-</span> <span class="fu">paste</span>(flipped_names, <span class="at">collapse =</span> <span class="st">", "</span>)</span>
<span id="cb32-219"><a href="#cb32-219"></a>  </span>
<span id="cb32-220"><a href="#cb32-220"></a>} <span class="cf">else</span> {</span>
<span id="cb32-221"><a href="#cb32-221"></a>  <span class="co"># use standard models and labels (no flipping)</span></span>
<span id="cb32-222"><a href="#cb32-222"></a>  models_for_analysis <span class="ot">&lt;-</span> models_binary_cate</span>
<span id="cb32-223"><a href="#cb32-223"></a>  labels_for_analysis <span class="ot">&lt;-</span> label_mapping</span>
<span id="cb32-224"><a href="#cb32-224"></a>  </span>
<span id="cb32-225"><a href="#cb32-225"></a>  <span class="co"># ensure flipped_names is a character vector, not a function</span></span>
<span id="cb32-226"><a href="#cb32-226"></a>  <span class="co"># remove any existing flipped_names object that might be a function</span></span>
<span id="cb32-227"><a href="#cb32-227"></a>  <span class="cf">if</span> (<span class="fu">exists</span>(<span class="st">"flipped_names"</span>) <span class="sc">&amp;&amp;</span> <span class="fu">is.function</span>(flipped_names)) {</span>
<span id="cb32-228"><a href="#cb32-228"></a>    <span class="fu">rm</span>(flipped_names)</span>
<span id="cb32-229"><a href="#cb32-229"></a>  }</span>
<span id="cb32-230"><a href="#cb32-230"></a>  </span>
<span id="cb32-231"><a href="#cb32-231"></a>  flipped_names <span class="ot">&lt;-</span> <span class="fu">character</span>(<span class="dv">0</span>)  <span class="co"># empty character vector</span></span>
<span id="cb32-232"><a href="#cb32-232"></a>  flipped_list <span class="ot">&lt;-</span> <span class="st">""</span></span>
<span id="cb32-233"><a href="#cb32-233"></a>}</span>
<span id="cb32-234"><a href="#cb32-234"></a></span>
<span id="cb32-235"><a href="#cb32-235"></a>devtools<span class="sc">::</span><span class="fu">load_all</span>(<span class="st">"/Users/joseph/GIT/margot/"</span>)</span>
<span id="cb32-236"><a href="#cb32-236"></a></span>
<span id="cb32-237"><a href="#cb32-237"></a></span>
<span id="cb32-238"><a href="#cb32-238"></a><span class="co"># ── average treatment effects (ate) analysis ──────────────────────────────────</span></span>
<span id="cb32-239"><a href="#cb32-239"></a>ate_results <span class="ot">&lt;-</span> <span class="fu">margot_plot</span>(</span>
<span id="cb32-240"><a href="#cb32-240"></a>  models_binary_cate<span class="sc">$</span>combined_table,</span>
<span id="cb32-241"><a href="#cb32-241"></a>  <span class="at">options               =</span> outcomes_options_all,</span>
<span id="cb32-242"><a href="#cb32-242"></a>  <span class="at">label_mapping         =</span> label_mapping,  <span class="co"># always use standard labels for ate</span></span>
<span id="cb32-243"><a href="#cb32-243"></a>  <span class="at">include_coefficients  =</span> <span class="cn">FALSE</span>,</span>
<span id="cb32-244"><a href="#cb32-244"></a>  <span class="at">order                 =</span> <span class="st">"evaluebound_asc"</span>,</span>
<span id="cb32-245"><a href="#cb32-245"></a>  <span class="at">original_df           =</span> original_df,</span>
<span id="cb32-246"><a href="#cb32-246"></a>  <span class="at">e_val_bound_threshold =</span> <span class="fl">1.2</span>,</span>
<span id="cb32-247"><a href="#cb32-247"></a>  <span class="at">rename_ate            =</span> <span class="cn">TRUE</span>,</span>
<span id="cb32-248"><a href="#cb32-248"></a>  <span class="at">adjust                =</span> <span class="st">"bonferroni"</span>,</span>
<span id="cb32-249"><a href="#cb32-249"></a>  <span class="at">alpha                 =</span> <span class="fl">0.05</span></span>
<span id="cb32-250"><a href="#cb32-250"></a>)</span>
<span id="cb32-251"><a href="#cb32-251"></a></span>
<span id="cb32-252"><a href="#cb32-252"></a></span>
<span id="cb32-253"><a href="#cb32-253"></a></span>
<span id="cb32-254"><a href="#cb32-254"></a><span class="co"># check results table: </span></span>
<span id="cb32-255"><a href="#cb32-255"></a>ate_results<span class="sc">$</span>transformed_table</span>
<span id="cb32-256"><a href="#cb32-256"></a></span>
<span id="cb32-257"><a href="#cb32-257"></a></span>
<span id="cb32-258"><a href="#cb32-258"></a><span class="co"># check interpretation: </span></span>
<span id="cb32-259"><a href="#cb32-259"></a><span class="fu">cat</span>(ate_results<span class="sc">$</span>interpretation)</span>
<span id="cb32-260"><a href="#cb32-260"></a></span>
<span id="cb32-261"><a href="#cb32-261"></a><span class="co"># check plot data is correct</span></span>
<span id="cb32-262"><a href="#cb32-262"></a><span class="co"># plot_data &lt;- ate_results$plot$data</span></span>
<span id="cb32-263"><a href="#cb32-263"></a><span class="co"># print(plot_data[plot_data$outcome == "Social Belonging", c("2.5 %", "97.5 %")])</span></span>
<span id="cb32-264"><a href="#cb32-264"></a></span>
<span id="cb32-265"><a href="#cb32-265"></a><span class="co"># ── make nice markdown table -----------------──────────────────────────────────</span></span>
<span id="cb32-266"><a href="#cb32-266"></a>margot_bind_tables_markdown <span class="ot">&lt;-</span> <span class="fu">margot_bind_tables</span>(</span>
<span id="cb32-267"><a href="#cb32-267"></a>  ate_results<span class="sc">$</span>transformed_table,</span>
<span id="cb32-268"><a href="#cb32-268"></a>  <span class="at">sort_E_val_bound =</span> <span class="st">"desc"</span>,</span>
<span id="cb32-269"><a href="#cb32-269"></a>  <span class="at">e_val_bound_threshold =</span> <span class="fl">1.2</span>,</span>
<span id="cb32-270"><a href="#cb32-270"></a>  <span class="co"># ← choose threshold</span></span>
<span id="cb32-271"><a href="#cb32-271"></a>  <span class="at">highlight_color =</span> <span class="cn">NULL</span>,</span>
<span id="cb32-272"><a href="#cb32-272"></a>  <span class="at">bold =</span> <span class="cn">TRUE</span>,</span>
<span id="cb32-273"><a href="#cb32-273"></a>  <span class="at">rename_cols =</span> <span class="cn">TRUE</span>,</span>
<span id="cb32-274"><a href="#cb32-274"></a>  <span class="at">col_renames =</span> <span class="fu">list</span>(<span class="st">"E-Value"</span> <span class="ot">=</span> <span class="st">"E_Value"</span>, <span class="st">"E-Value bound"</span> <span class="ot">=</span> <span class="st">"E_Val_bound"</span>),</span>
<span id="cb32-275"><a href="#cb32-275"></a>  <span class="at">rename_ate =</span> <span class="cn">TRUE</span>,</span>
<span id="cb32-276"><a href="#cb32-276"></a>  <span class="at">threshold_col =</span> <span class="st">"E_Val_bound"</span>,</span>
<span id="cb32-277"><a href="#cb32-277"></a>  <span class="at">output_format =</span> <span class="st">"markdown"</span>,</span>
<span id="cb32-278"><a href="#cb32-278"></a>  <span class="at">kbl_args =</span> <span class="fu">list</span>(</span>
<span id="cb32-279"><a href="#cb32-279"></a>    <span class="at">booktabs =</span> <span class="cn">TRUE</span>,</span>
<span id="cb32-280"><a href="#cb32-280"></a>    <span class="at">caption =</span> <span class="cn">NULL</span>,</span>
<span id="cb32-281"><a href="#cb32-281"></a>    <span class="at">align =</span> <span class="cn">NULL</span></span>
<span id="cb32-282"><a href="#cb32-282"></a>  )</span>
<span id="cb32-283"><a href="#cb32-283"></a>)</span>
<span id="cb32-284"><a href="#cb32-284"></a></span>
<span id="cb32-285"><a href="#cb32-285"></a></span>
<span id="cb32-286"><a href="#cb32-286"></a><span class="co"># ──────────────────────────────────────────────────────────────────────────────</span></span>
<span id="cb32-287"><a href="#cb32-287"></a><span class="co"># HETEROGENEITY ANALYSIS</span></span>
<span id="cb32-288"><a href="#cb32-288"></a><span class="co"># this section adapts based on whether outcomes were flipped</span></span>
<span id="cb32-289"><a href="#cb32-289"></a><span class="co"># ──────────────────────────────────────────────────────────────────────────────</span></span>
<span id="cb32-290"><a href="#cb32-290"></a></span>
<span id="cb32-291"><a href="#cb32-291"></a><span class="co"># check package version for heterogeneity analysis</span></span>
<span id="cb32-292"><a href="#cb32-292"></a><span class="fu">stopifnot</span>(utils<span class="sc">::</span><span class="fu">packageVersion</span>(<span class="st">"margot"</span>) <span class="sc">&gt;=</span> <span class="st">"1.0.233"</span>)</span>
<span id="cb32-293"><a href="#cb32-293"></a></span>
<span id="cb32-294"><a href="#cb32-294"></a><span class="co"># helper function for printing tables</span></span>
<span id="cb32-295"><a href="#cb32-295"></a>print_rate <span class="ot">&lt;-</span> <span class="cf">function</span>(tbl) {</span>
<span id="cb32-296"><a href="#cb32-296"></a>  tbl <span class="sc">|&gt;</span></span>
<span id="cb32-297"><a href="#cb32-297"></a>    <span class="fu">mutate</span>(<span class="fu">across</span>(<span class="fu">where</span>(is.numeric), \(x) <span class="fu">round</span>(x, <span class="dv">2</span>))) <span class="sc">|&gt;</span></span>
<span id="cb32-298"><a href="#cb32-298"></a>    <span class="fu">kbl</span>(<span class="at">format =</span> <span class="st">"markdown"</span>)</span>
<span id="cb32-299"><a href="#cb32-299"></a>}</span>
<span id="cb32-300"><a href="#cb32-300"></a></span>
<span id="cb32-301"><a href="#cb32-301"></a><span class="co"># ── 1. screen for heterogeneity (rate autoc + rate qini) ─────────────────────</span></span>
<span id="cb32-302"><a href="#cb32-302"></a>rate_results <span class="ot">&lt;-</span> <span class="fu">margot_rate</span>(</span>
<span id="cb32-303"><a href="#cb32-303"></a>  <span class="at">models        =</span> models_for_analysis,</span>
<span id="cb32-304"><a href="#cb32-304"></a>  <span class="at">policy        =</span> <span class="st">"treat_best"</span>,</span>
<span id="cb32-305"><a href="#cb32-305"></a>  <span class="at">alpha         =</span> <span class="fl">0.20</span>,</span>
<span id="cb32-306"><a href="#cb32-306"></a>  <span class="at">adjust        =</span> <span class="st">"fdr"</span>,</span>
<span id="cb32-307"><a href="#cb32-307"></a>  <span class="at">label_mapping =</span> labels_for_analysis</span>
<span id="cb32-308"><a href="#cb32-308"></a>)</span>
<span id="cb32-309"><a href="#cb32-309"></a></span>
<span id="cb32-310"><a href="#cb32-310"></a><span class="co"># interpret rate results</span></span>
<span id="cb32-311"><a href="#cb32-311"></a><span class="cf">if</span> (use_flipped) {</span>
<span id="cb32-312"><a href="#cb32-312"></a>  rate_interp <span class="ot">&lt;-</span> <span class="fu">margot_interpret_rate</span>(</span>
<span id="cb32-313"><a href="#cb32-313"></a>    rate_results,</span>
<span id="cb32-314"><a href="#cb32-314"></a>    <span class="at">flipped_outcomes      =</span> flipped_names,</span>
<span id="cb32-315"><a href="#cb32-315"></a>    <span class="at">adjust_positives_only =</span> <span class="cn">TRUE</span></span>
<span id="cb32-316"><a href="#cb32-316"></a>  )</span>
<span id="cb32-317"><a href="#cb32-317"></a>} <span class="cf">else</span> {</span>
<span id="cb32-318"><a href="#cb32-318"></a>  rate_interp <span class="ot">&lt;-</span> <span class="fu">margot_interpret_rate</span>(</span>
<span id="cb32-319"><a href="#cb32-319"></a>    rate_results,</span>
<span id="cb32-320"><a href="#cb32-320"></a>    <span class="at">flipped_outcomes      =</span> <span class="cn">NULL</span>,  <span class="co"># no flipped outcomes</span></span>
<span id="cb32-321"><a href="#cb32-321"></a>    <span class="at">adjust_positives_only =</span> <span class="cn">TRUE</span></span>
<span id="cb32-322"><a href="#cb32-322"></a>  )</span>
<span id="cb32-323"><a href="#cb32-323"></a>}</span>
<span id="cb32-324"><a href="#cb32-324"></a></span>
<span id="cb32-325"><a href="#cb32-325"></a><span class="fu">cat</span>(rate_interp<span class="sc">$</span>comparison, <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb32-326"><a href="#cb32-326"></a><span class="fu">cli_h2</span>(<span class="st">"Analysis ready for Appendix ✔"</span>)</span>
<span id="cb32-327"><a href="#cb32-327"></a></span>
<span id="cb32-328"><a href="#cb32-328"></a><span class="co"># organise model names by evidence strength</span></span>
<span id="cb32-329"><a href="#cb32-329"></a>model_groups <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb32-330"><a href="#cb32-330"></a>  <span class="at">autoc       =</span> rate_interp<span class="sc">$</span>autoc_model_names,</span>
<span id="cb32-331"><a href="#cb32-331"></a>  <span class="at">qini        =</span> rate_interp<span class="sc">$</span>qini_model_names,</span>
<span id="cb32-332"><a href="#cb32-332"></a>  <span class="at">either      =</span> rate_interp<span class="sc">$</span>either_model_names,</span>
<span id="cb32-333"><a href="#cb32-333"></a>  <span class="at">exploratory =</span> rate_interp<span class="sc">$</span>not_excluded_either</span>
<span id="cb32-334"><a href="#cb32-334"></a>)</span>
<span id="cb32-335"><a href="#cb32-335"></a></span>
<span id="cb32-336"><a href="#cb32-336"></a><span class="co"># ── 2. plot rate autoc curves (if any exist) ─────────────────────────────────</span></span>
<span id="cb32-337"><a href="#cb32-337"></a><span class="cf">if</span> (<span class="fu">length</span>(model_groups<span class="sc">$</span>autoc) <span class="sc">&gt;</span> <span class="dv">0</span>) {</span>
<span id="cb32-338"><a href="#cb32-338"></a>  autoc_plots <span class="ot">&lt;-</span> <span class="fu">margot_plot_rate_batch</span>(</span>
<span id="cb32-339"><a href="#cb32-339"></a>    <span class="at">models        =</span> models_for_analysis,</span>
<span id="cb32-340"><a href="#cb32-340"></a>    <span class="at">label_mapping =</span> labels_for_analysis,</span>
<span id="cb32-341"><a href="#cb32-341"></a>    <span class="at">model_names   =</span> model_groups<span class="sc">$</span>autoc</span>
<span id="cb32-342"><a href="#cb32-342"></a>  )</span>
<span id="cb32-343"><a href="#cb32-343"></a>  </span>
<span id="cb32-344"><a href="#cb32-344"></a>  <span class="co"># store first autoc name if it exists</span></span>
<span id="cb32-345"><a href="#cb32-345"></a>  <span class="cf">if</span> (<span class="fu">nrow</span>(rate_results<span class="sc">$</span>rate_autoc) <span class="sc">&gt;</span> <span class="dv">0</span>) {</span>
<span id="cb32-346"><a href="#cb32-346"></a>    autoc_name_1 <span class="ot">&lt;-</span> rate_results<span class="sc">$</span>rate_autoc<span class="sc">$</span>outcome[[<span class="dv">1</span>]]</span>
<span id="cb32-347"><a href="#cb32-347"></a>  }</span>
<span id="cb32-348"><a href="#cb32-348"></a>} <span class="cf">else</span> {</span>
<span id="cb32-349"><a href="#cb32-349"></a>  autoc_plots <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb32-350"><a href="#cb32-350"></a>  <span class="fu">message</span>(<span class="st">"no significant rate autoc results found"</span>)</span>
<span id="cb32-351"><a href="#cb32-351"></a>}</span>
<span id="cb32-352"><a href="#cb32-352"></a></span>
<span id="cb32-353"><a href="#cb32-353"></a><span class="co"># ── 3. qini curves + gain interpretation ──────────────────────────────────────</span></span>
<span id="cb32-354"><a href="#cb32-354"></a></span>
<span id="cb32-355"><a href="#cb32-355"></a><span class="co"># define plot settings (move here so they exist even if not used)</span></span>
<span id="cb32-356"><a href="#cb32-356"></a>policy_tree_defaults <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb32-357"><a href="#cb32-357"></a>  <span class="at">point_alpha              =</span> <span class="fl">0.5</span>,</span>
<span id="cb32-358"><a href="#cb32-358"></a>  <span class="at">title_size               =</span> <span class="dv">30</span>,</span>
<span id="cb32-359"><a href="#cb32-359"></a>  <span class="at">subtitle_size            =</span> <span class="dv">25</span>,</span>
<span id="cb32-360"><a href="#cb32-360"></a>  <span class="at">axis_title_size          =</span> <span class="dv">25</span>,</span>
<span id="cb32-361"><a href="#cb32-361"></a>  <span class="at">legend_title_size        =</span> <span class="dv">18</span>,</span>
<span id="cb32-362"><a href="#cb32-362"></a>  <span class="at">split_line_color         =</span> <span class="st">"red"</span>,</span>
<span id="cb32-363"><a href="#cb32-363"></a>  <span class="at">split_line_alpha         =</span> <span class="fl">0.8</span>,</span>
<span id="cb32-364"><a href="#cb32-364"></a>  <span class="at">split_label_color        =</span> <span class="st">"red"</span>,</span>
<span id="cb32-365"><a href="#cb32-365"></a>  <span class="at">split_label_nudge_factor =</span> <span class="fl">0.007</span></span>
<span id="cb32-366"><a href="#cb32-366"></a>)</span>
<span id="cb32-367"><a href="#cb32-367"></a></span>
<span id="cb32-368"><a href="#cb32-368"></a>decision_tree_defaults <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb32-369"><a href="#cb32-369"></a>  <span class="at">span_ratio        =</span> <span class="fl">0.1</span>,</span>
<span id="cb32-370"><a href="#cb32-370"></a>  <span class="at">text_size         =</span> <span class="dv">4</span>,</span>
<span id="cb32-371"><a href="#cb32-371"></a>  <span class="at">y_padding         =</span> <span class="fl">0.5</span>,</span>
<span id="cb32-372"><a href="#cb32-372"></a>  <span class="at">edge_label_offset =</span> <span class="fl">0.02</span>,</span>
<span id="cb32-373"><a href="#cb32-373"></a>  <span class="at">border_size       =</span> <span class="fl">0.01</span></span>
<span id="cb32-374"><a href="#cb32-374"></a>)</span>
<span id="cb32-375"><a href="#cb32-375"></a></span>
<span id="cb32-376"><a href="#cb32-376"></a><span class="co"># run initial qini analysis</span></span>
<span id="cb32-377"><a href="#cb32-377"></a>qini_results <span class="ot">&lt;-</span> <span class="fu">margot_policy</span>(</span>
<span id="cb32-378"><a href="#cb32-378"></a>  models_for_analysis,</span>
<span id="cb32-379"><a href="#cb32-379"></a>  <span class="at">policy_tree_args   =</span> policy_tree_defaults,</span>
<span id="cb32-380"><a href="#cb32-380"></a>  <span class="at">model_names        =</span> <span class="fu">names</span>(models_for_analysis<span class="sc">$</span>results),</span>
<span id="cb32-381"><a href="#cb32-381"></a>  <span class="at">original_df        =</span> original_df,</span>
<span id="cb32-382"><a href="#cb32-382"></a>  <span class="at">label_mapping      =</span> labels_for_analysis,</span>
<span id="cb32-383"><a href="#cb32-383"></a>  <span class="at">qini_args          =</span> <span class="fu">list</span>(<span class="at">show_ci =</span> <span class="st">"both"</span>),</span>
<span id="cb32-384"><a href="#cb32-384"></a>  <span class="at">max_depth          =</span> <span class="dv">1</span>L,</span>
<span id="cb32-385"><a href="#cb32-385"></a>  <span class="at">output_objects     =</span> <span class="fu">c</span>(<span class="st">"qini_plot"</span>, <span class="st">"diff_gain_summaries"</span>)</span>
<span id="cb32-386"><a href="#cb32-386"></a>)</span>
<span id="cb32-387"><a href="#cb32-387"></a></span>
<span id="cb32-388"><a href="#cb32-388"></a><span class="co"># interpret qini results</span></span>
<span id="cb32-389"><a href="#cb32-389"></a>qini_gain <span class="ot">&lt;-</span> <span class="fu">margot_interpret_qini</span>(</span>
<span id="cb32-390"><a href="#cb32-390"></a>  qini_results,</span>
<span id="cb32-391"><a href="#cb32-391"></a>  <span class="at">label_mapping =</span> labels_for_analysis</span>
<span id="cb32-392"><a href="#cb32-392"></a>)</span>
<span id="cb32-393"><a href="#cb32-393"></a></span>
<span id="cb32-394"><a href="#cb32-394"></a><span class="fu">print_rate</span>(qini_gain<span class="sc">$</span>summary_table)</span>
<span id="cb32-395"><a href="#cb32-395"></a><span class="fu">cat</span>(qini_gain<span class="sc">$</span>qini_explanation, <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb32-396"><a href="#cb32-396"></a></span>
<span id="cb32-397"><a href="#cb32-397"></a>reliable_ids <span class="ot">&lt;-</span> qini_gain<span class="sc">$</span>reliable_model_ids</span>
<span id="cb32-398"><a href="#cb32-398"></a></span>
<span id="cb32-399"><a href="#cb32-399"></a><span class="co"># ── 4. policy trees (only if reliable models exist) ──────────────────────────</span></span>
<span id="cb32-400"><a href="#cb32-400"></a><span class="cf">if</span> (<span class="fu">length</span>(reliable_ids) <span class="sc">&gt;</span> <span class="dv">0</span>) {</span>
<span id="cb32-401"><a href="#cb32-401"></a>  <span class="co"># recompute for reliable models only</span></span>
<span id="cb32-402"><a href="#cb32-402"></a>  qini_results_valid <span class="ot">&lt;-</span> <span class="fu">margot_policy</span>(</span>
<span id="cb32-403"><a href="#cb32-403"></a>    models_for_analysis,</span>
<span id="cb32-404"><a href="#cb32-404"></a>    <span class="at">decision_tree_args =</span> decision_tree_defaults,</span>
<span id="cb32-405"><a href="#cb32-405"></a>    <span class="at">policy_tree_args   =</span> policy_tree_defaults,</span>
<span id="cb32-406"><a href="#cb32-406"></a>    <span class="at">model_names        =</span> reliable_ids,</span>
<span id="cb32-407"><a href="#cb32-407"></a>    <span class="at">original_df        =</span> original_df,</span>
<span id="cb32-408"><a href="#cb32-408"></a>    <span class="at">qini_args          =</span> <span class="fu">list</span>(<span class="at">show_ci =</span> <span class="st">"both"</span>,  <span class="at">ylim =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">1</span>)),</span>
<span id="cb32-409"><a href="#cb32-409"></a>    <span class="at">label_mapping      =</span> labels_for_analysis,</span>
<span id="cb32-410"><a href="#cb32-410"></a>    <span class="at">max_depth          =</span> <span class="dv">1</span>L,</span>
<span id="cb32-411"><a href="#cb32-411"></a>    <span class="at">output_objects     =</span> <span class="fu">c</span>(<span class="st">"qini_plot"</span>, <span class="st">"diff_gain_summaries"</span>)</span>
<span id="cb32-412"><a href="#cb32-412"></a>  )</span>
<span id="cb32-413"><a href="#cb32-413"></a>  </span>
<span id="cb32-414"><a href="#cb32-414"></a>  qini_plots <span class="ot">&lt;-</span> <span class="fu">map</span>(qini_results_valid, <span class="sc">~</span> .x<span class="sc">$</span>qini_plot)</span>
<span id="cb32-415"><a href="#cb32-415"></a>  qini_names <span class="ot">&lt;-</span> <span class="fu">margot_get_labels</span>(reliable_ids, labels_for_analysis)</span>
<span id="cb32-416"><a href="#cb32-416"></a>  </span>
<span id="cb32-417"><a href="#cb32-417"></a>  <span class="co"># compute policy trees</span></span>
<span id="cb32-418"><a href="#cb32-418"></a>  policy_results_2L <span class="ot">&lt;-</span> <span class="fu">margot_policy</span>(</span>
<span id="cb32-419"><a href="#cb32-419"></a>    models_for_analysis,</span>
<span id="cb32-420"><a href="#cb32-420"></a>    <span class="at">decision_tree_args =</span> decision_tree_defaults,</span>
<span id="cb32-421"><a href="#cb32-421"></a>    <span class="at">policy_tree_args   =</span> policy_tree_defaults,</span>
<span id="cb32-422"><a href="#cb32-422"></a>    <span class="at">model_names        =</span> reliable_ids,</span>
<span id="cb32-423"><a href="#cb32-423"></a>    <span class="at">max_depth          =</span> <span class="dv">1</span>L,</span>
<span id="cb32-424"><a href="#cb32-424"></a>    <span class="at">original_df        =</span> original_df,</span>
<span id="cb32-425"><a href="#cb32-425"></a>    <span class="at">label_mapping      =</span> labels_for_analysis,</span>
<span id="cb32-426"><a href="#cb32-426"></a>    <span class="at">output_objects     =</span> <span class="fu">c</span>(<span class="st">"combined_plot"</span>)</span>
<span id="cb32-427"><a href="#cb32-427"></a>  )</span>
<span id="cb32-428"><a href="#cb32-428"></a>  </span>
<span id="cb32-429"><a href="#cb32-429"></a>  policy_plots <span class="ot">&lt;-</span> <span class="fu">map</span>(policy_results_2L, <span class="sc">~</span> .x<span class="sc">$</span>combined_plot)</span>
<span id="cb32-430"><a href="#cb32-430"></a>  </span>
<span id="cb32-431"><a href="#cb32-431"></a>  <span class="co"># generate plain language interpretation</span></span>
<span id="cb32-432"><a href="#cb32-432"></a>  policy_text <span class="ot">&lt;-</span> <span class="fu">margot_interpret_policy_batch</span>(</span>
<span id="cb32-433"><a href="#cb32-433"></a>    <span class="at">models        =</span> models_for_analysis,</span>
<span id="cb32-434"><a href="#cb32-434"></a>    <span class="at">original_df   =</span> original_df,</span>
<span id="cb32-435"><a href="#cb32-435"></a>    <span class="at">model_names   =</span> reliable_ids,</span>
<span id="cb32-436"><a href="#cb32-436"></a>    <span class="at">label_mapping =</span> labels_for_analysis,</span>
<span id="cb32-437"><a href="#cb32-437"></a>    <span class="at">max_depth     =</span> <span class="dv">1</span>L</span>
<span id="cb32-438"><a href="#cb32-438"></a>  )</span>
<span id="cb32-439"><a href="#cb32-439"></a>  </span>
<span id="cb32-440"><a href="#cb32-440"></a>  <span class="fu">cat</span>(policy_text, <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb32-441"><a href="#cb32-441"></a>  </span>
<span id="cb32-442"><a href="#cb32-442"></a>} <span class="cf">else</span> {</span>
<span id="cb32-443"><a href="#cb32-443"></a>  qini_plots <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb32-444"><a href="#cb32-444"></a>  policy_plots <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb32-445"><a href="#cb32-445"></a>  qini_names <span class="ot">&lt;-</span> <span class="fu">character</span>(<span class="dv">0</span>)</span>
<span id="cb32-446"><a href="#cb32-446"></a>  policy_text <span class="ot">&lt;-</span> <span class="st">"No reliable heterogeneous treatment effects found."</span></span>
<span id="cb32-447"><a href="#cb32-447"></a>  <span class="fu">message</span>(<span class="st">"no reliable qini models found - skipping policy tree analysis"</span>)</span>
<span id="cb32-448"><a href="#cb32-448"></a>}</span>
<span id="cb32-449"><a href="#cb32-449"></a></span>
<span id="cb32-450"><a href="#cb32-450"></a>cli<span class="sc">::</span><span class="fu">cli_h1</span>(<span class="st">"Finished: heterogeneity analysis complete ✔"</span>)</span>
<span id="cb32-451"><a href="#cb32-451"></a><span class="co"># run this code, copy and paste contents into your text</span></span>
<span id="cb32-452"><a href="#cb32-452"></a>global_vars <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb32-453"><a href="#cb32-453"></a>  <span class="at">name_exposure_variable     =</span> <span class="st">"Belief in God"</span>,</span>
<span id="cb32-454"><a href="#cb32-454"></a>  <span class="at">n_total       =</span> <span class="fu">as.character</span>(<span class="dv">20</span>,<span class="dv">000</span>),</span>
<span id="cb32-455"><a href="#cb32-455"></a>  <span class="at">ate_adjustment             =</span> <span class="st">"bonferroni"</span>, </span>
<span id="cb32-456"><a href="#cb32-456"></a>  <span class="at">ate_alpha                  =</span> <span class="st">"0.1"</span>,</span>
<span id="cb32-457"><a href="#cb32-457"></a>  <span class="at">cate_adjustment            =</span> <span class="st">"bonferroni"</span>,</span>
<span id="cb32-458"><a href="#cb32-458"></a>  <span class="at">cate_alpha                 =</span> <span class="st">"0.1"</span>,             </span>
<span id="cb32-459"><a href="#cb32-459"></a>  <span class="at">sample_ratio_policy        =</span> <span class="st">"50/50"</span>,</span>
<span id="cb32-460"><a href="#cb32-460"></a>  <span class="at">n_participants             =</span> <span class="dv">20000</span>,</span>
<span id="cb32-461"><a href="#cb32-461"></a>  <span class="co"># n_censored                 = n_censored,</span></span>
<span id="cb32-462"><a href="#cb32-462"></a>  <span class="at">n_iterations               =</span> <span class="fu">as.character</span>(<span class="dv">1000</span>),</span>
<span id="cb32-463"><a href="#cb32-463"></a>  <span class="at">stability_threshold        =</span> <span class="fu">as.character</span>(<span class="dv">10</span>),</span>
<span id="cb32-464"><a href="#cb32-464"></a>  <span class="at">appendix_outcomes          =</span> <span class="fu">as.character</span>(<span class="dv">2</span>),</span>
<span id="cb32-465"><a href="#cb32-465"></a>  <span class="co"># eligibility_criteria       = eligibility_criteria,</span></span>
<span id="cb32-466"><a href="#cb32-466"></a>  <span class="co"># exposure_variable          = name_exposure,</span></span>
<span id="cb32-467"><a href="#cb32-467"></a>  <span class="co"># name_exposure_lower        = name_exposure_lower,</span></span>
<span id="cb32-468"><a href="#cb32-468"></a>  <span class="co"># name_control_regime_lower  = name_control_regime_lower,</span></span>
<span id="cb32-469"><a href="#cb32-469"></a>  <span class="at">name_outcome_variables     =</span> <span class="st">"Cooperation Outcomes"</span>, <span class="co"># &lt;- adjust to your study</span></span>
<span id="cb32-470"><a href="#cb32-470"></a>  <span class="co"># name_outcomes_lower        = name_outcomes_lower,</span></span>
<span id="cb32-471"><a href="#cb32-471"></a>  <span class="co"># name_exposure_capfirst     = nice_name_exposure,</span></span>
<span id="cb32-472"><a href="#cb32-472"></a>  <span class="co"># measures_exposure          = measures_exposure,</span></span>
<span id="cb32-473"><a href="#cb32-473"></a>  <span class="co"># value_exposure_regime      = value_exposure_regime,</span></span>
<span id="cb32-474"><a href="#cb32-474"></a>  <span class="co"># value_control_regime       = value_control_regime,</span></span>
<span id="cb32-475"><a href="#cb32-475"></a>  <span class="at">flipped_list               =</span> flipped_list,</span>
<span id="cb32-476"><a href="#cb32-476"></a>  <span class="at">appendix_explain_grf       =</span> <span class="st">"4"</span>,</span>
<span id="cb32-477"><a href="#cb32-477"></a>  <span class="at">appendix_assumptions_grf   =</span> <span class="st">"5"</span>,</span>
<span id="cb32-478"><a href="#cb32-478"></a>  <span class="at">name_exposure_threshold    =</span> <span class="st">"1"</span>,</span>
<span id="cb32-479"><a href="#cb32-479"></a>  <span class="at">name_control_threshold     =</span> <span class="st">"0"</span>,</span>
<span id="cb32-480"><a href="#cb32-480"></a>  <span class="at">appendix_measures          =</span> <span class="st">"2"</span>,</span>
<span id="cb32-481"><a href="#cb32-481"></a>  <span class="co"># value_control              = value_control,</span></span>
<span id="cb32-482"><a href="#cb32-482"></a>  <span class="co"># value_exposure             = value_exposure,</span></span>
<span id="cb32-483"><a href="#cb32-483"></a>  <span class="at">appendix_positivity        =</span> <span class="st">"3"</span>,</span>
<span id="cb32-484"><a href="#cb32-484"></a>  <span class="at">appendix_rate              =</span> <span class="st">"4"</span>,</span>
<span id="cb32-485"><a href="#cb32-485"></a>  <span class="at">appendix_qini_curve        =</span> <span class="st">"4"</span>,</span>
<span id="cb32-486"><a href="#cb32-486"></a>  <span class="at">appendix_explain_grf       =</span> <span class="st">"6"</span>,</span>
<span id="cb32-487"><a href="#cb32-487"></a>  <span class="at">train_proportion_decision_tree =</span> <span class="st">"50 percent"</span>,</span>
<span id="cb32-488"><a href="#cb32-488"></a>  <span class="at">training_proportion        =</span> <span class="st">"50 percent"</span>,</span>
<span id="cb32-489"><a href="#cb32-489"></a>  <span class="at">sample_split               =</span> <span class="st">"50/50"</span>,</span>
<span id="cb32-490"><a href="#cb32-490"></a>  <span class="at">sample_ratio_policy        =</span> <span class="st">"50/50"</span>,</span>
<span id="cb32-491"><a href="#cb32-491"></a>  <span class="co"># baseline_wave              = baseline_wave,</span></span>
<span id="cb32-492"><a href="#cb32-492"></a>  <span class="co"># exposure_waves             = exposure_waves,</span></span>
<span id="cb32-493"><a href="#cb32-493"></a>  <span class="co"># outcome_wave               = outcome_wave,</span></span>
<span id="cb32-494"><a href="#cb32-494"></a>  <span class="at">protocol_url               =</span> <span class="st">"https://osf.io/ce4t9/"</span>, <span class="co"># if used</span></span>
<span id="cb32-495"><a href="#cb32-495"></a>  <span class="at">appendix_timeline          =</span> <span class="st">"S1"</span> <span class="co"># if used</span></span>
<span id="cb32-496"><a href="#cb32-496"></a>)</span>
<span id="cb32-497"><a href="#cb32-497"></a></span>
<span id="cb32-498"><a href="#cb32-498"></a></span>
<span id="cb32-499"><a href="#cb32-499"></a><span class="in">```</span></span>
<span id="cb32-500"><a href="#cb32-500"></a></span>
<span id="cb32-501"><a href="#cb32-501"></a>{{&lt; pagebreak &gt;}}</span>
<span id="cb32-502"><a href="#cb32-502"></a></span>
<span id="cb32-503"><a href="#cb32-503"></a><span class="fu">## Introduction</span></span>
<span id="cb32-504"><a href="#cb32-504"></a></span>
<span id="cb32-505"><a href="#cb32-505"></a>The following briefly walks through the results of ATE and CATE estimation and reporting.</span>
<span id="cb32-506"><a href="#cb32-506"></a></span>
<span id="cb32-507"><a href="#cb32-507"></a><span class="fu">## Method - Example Report</span></span>
<span id="cb32-508"><a href="#cb32-508"></a></span>
<span id="cb32-509"><a href="#cb32-509"></a><span class="in">```{r, results='asis'}</span></span>
<span id="cb32-510"><a href="#cb32-510"></a><span class="co">#| eval: true # &lt;- set to false, copy, delete, modify, and extend text as needed</span></span>
<span id="cb32-511"><a href="#cb32-511"></a><span class="co">#| include: true</span></span>
<span id="cb32-512"><a href="#cb32-512"></a><span class="co">#| echo: true</span></span>
<span id="cb32-513"><a href="#cb32-513"></a></span>
<span id="cb32-514"><a href="#cb32-514"></a></span>
<span id="cb32-515"><a href="#cb32-515"></a><span class="fu">cat</span>(<span class="fu">boilerplate_generate_text</span>(</span>
<span id="cb32-516"><a href="#cb32-516"></a>  <span class="at">category =</span> <span class="st">"method"</span>,</span>
<span id="cb32-517"><a href="#cb32-517"></a>  <span class="at">sections =</span> <span class="fu">c</span>(<span class="st">"statistical_models.grf_short_explanation"</span>),</span>
<span id="cb32-518"><a href="#cb32-518"></a>  <span class="co"># global_vars = list(</span></span>
<span id="cb32-519"><a href="#cb32-519"></a>  <span class="co">#   name_outcomes_lower = name_outcomes_lower,</span></span>
<span id="cb32-520"><a href="#cb32-520"></a>  <span class="co">#   name_exposure_lower = name_exposure_lower,</span></span>
<span id="cb32-521"><a href="#cb32-521"></a>  <span class="co">#   name_exposure_capfirst = name_exposure_variable</span></span>
<span id="cb32-522"><a href="#cb32-522"></a>  <span class="co"># ),</span></span>
<span id="cb32-523"><a href="#cb32-523"></a>  <span class="at">db =</span> unified_db</span>
<span id="cb32-524"><a href="#cb32-524"></a>))</span>
<span id="cb32-525"><a href="#cb32-525"></a></span>
<span id="cb32-526"><a href="#cb32-526"></a><span class="in">```</span></span>
<span id="cb32-527"><a href="#cb32-527"></a></span>
<span id="cb32-528"><a href="#cb32-528"></a>{{&lt; pagebreak &gt;}}</span>
<span id="cb32-529"><a href="#cb32-529"></a></span>
<span id="cb32-530"><a href="#cb32-530"></a><span class="fu">## Results</span></span>
<span id="cb32-531"><a href="#cb32-531"></a></span>
<span id="cb32-532"><a href="#cb32-532"></a><span class="fu">### Average Treatment Effects</span></span>
<span id="cb32-533"><a href="#cb32-533"></a></span>
<span id="cb32-534"><a href="#cb32-534"></a>::: {.column-screen}</span>
<span id="cb32-537"><a href="#cb32-537"></a><span class="in">```{r}</span></span>
<span id="cb32-538"><a href="#cb32-538"></a><span class="co">#| label: fig-ate</span></span>
<span id="cb32-539"><a href="#cb32-539"></a><span class="co">#| fig-cap: "Average Treatment Effects on Multi-dimensional Wellbeing"</span></span>
<span id="cb32-540"><a href="#cb32-540"></a><span class="co">#| eval: true</span></span>
<span id="cb32-541"><a href="#cb32-541"></a><span class="co">#| include: true</span></span>
<span id="cb32-542"><a href="#cb32-542"></a><span class="co">#| fig-height: 12</span></span>
<span id="cb32-543"><a href="#cb32-543"></a><span class="co">#| fig-width: 12</span></span>
<span id="cb32-544"><a href="#cb32-544"></a>ate_results<span class="sc">$</span>plot</span>
<span id="cb32-545"><a href="#cb32-545"></a><span class="in">```</span></span>
<span id="cb32-546"><a href="#cb32-546"></a>:::</span>
<span id="cb32-547"><a href="#cb32-547"></a></span>
<span id="cb32-548"><a href="#cb32-548"></a>{{&lt; pagebreak &gt;}}</span>
<span id="cb32-549"><a href="#cb32-549"></a></span>
<span id="cb32-552"><a href="#cb32-552"></a><span class="in">```{r}</span></span>
<span id="cb32-553"><a href="#cb32-553"></a><span class="co">#| label: tbl-outcomes</span></span>
<span id="cb32-554"><a href="#cb32-554"></a><span class="co">#| tbl-cap: "Average Treatment Effects on Multi-dimensional Wellbeing"</span></span>
<span id="cb32-555"><a href="#cb32-555"></a><span class="co">#| eval: true # - set to false/ copy and change </span></span>
<span id="cb32-556"><a href="#cb32-556"></a><span class="co">#| echo: false</span></span>
<span id="cb32-557"><a href="#cb32-557"></a><span class="co">#| include: true</span></span>
<span id="cb32-558"><a href="#cb32-558"></a></span>
<span id="cb32-559"><a href="#cb32-559"></a>margot_bind_tables_markdown</span>
<span id="cb32-560"><a href="#cb32-560"></a><span class="in">```</span></span>
<span id="cb32-561"><a href="#cb32-561"></a></span>
<span id="cb32-562"><a href="#cb32-562"></a><span class="in">```{r, results = 'asis'}</span></span>
<span id="cb32-563"><a href="#cb32-563"></a><span class="co">#| eval: true # - set to false/ copy and change </span></span>
<span id="cb32-564"><a href="#cb32-564"></a><span class="co">#| echo: false</span></span>
<span id="cb32-565"><a href="#cb32-565"></a><span class="co">#| include: true</span></span>
<span id="cb32-566"><a href="#cb32-566"></a><span class="fu">cat</span>(ate_results<span class="sc">$</span>interpretation)</span>
<span id="cb32-567"><a href="#cb32-567"></a><span class="in">```</span></span>
<span id="cb32-568"><a href="#cb32-568"></a></span>
<span id="cb32-569"><a href="#cb32-569"></a>{{&lt; pagebreak &gt;}}</span>
<span id="cb32-570"><a href="#cb32-570"></a></span>
<span id="cb32-571"><a href="#cb32-571"></a></span>
<span id="cb32-572"><a href="#cb32-572"></a><span class="fu">### Heterogeneous Treatment Effects {#results-qini-curve}</span></span>
<span id="cb32-573"><a href="#cb32-573"></a></span>
<span id="cb32-574"><a href="#cb32-574"></a>We begin by examining the distribution of individual treatment effects ($\tau) across our sample. @fig-tau-distribution presents the estimated treatment effects for each individual, revealing substantial variability in how people respond to {name_exposure_lower}.</span>
<span id="cb32-575"><a href="#cb32-575"></a></span>
<span id="cb32-576"><a href="#cb32-576"></a></span>
<span id="cb32-577"><a href="#cb32-577"></a>::: {.column-screen}</span>
<span id="cb32-580"><a href="#cb32-580"></a><span class="in">```{r}</span></span>
<span id="cb32-581"><a href="#cb32-581"></a><span class="co">#| label: fig-tau-distribution</span></span>
<span id="cb32-582"><a href="#cb32-582"></a><span class="co">#| fig-cap: "Distribution of Individual Treatment Effects (τᵢ) Across Outcomes"</span></span>
<span id="cb32-583"><a href="#cb32-583"></a><span class="co">#| eval: true</span></span>
<span id="cb32-584"><a href="#cb32-584"></a><span class="co">#| echo: true</span></span>
<span id="cb32-585"><a href="#cb32-585"></a></span>
<span id="cb32-586"><a href="#cb32-586"></a><span class="co"># create tau plots showing individual treatment effect distributions</span></span>
<span id="cb32-587"><a href="#cb32-587"></a>tau_plots <span class="ot">&lt;-</span> <span class="fu">margot_plot_tau</span>(</span>
<span id="cb32-588"><a href="#cb32-588"></a>  models_for_analysis, </span>
<span id="cb32-589"><a href="#cb32-589"></a>  <span class="at">label_mapping =</span> labels_for_analysis</span>
<span id="cb32-590"><a href="#cb32-590"></a>)</span>
<span id="cb32-591"><a href="#cb32-591"></a></span>
<span id="cb32-592"><a href="#cb32-592"></a><span class="co"># display the plot</span></span>
<span id="cb32-593"><a href="#cb32-593"></a>tau_plots</span>
<span id="cb32-594"><a href="#cb32-594"></a><span class="in">```</span></span>
<span id="cb32-595"><a href="#cb32-595"></a>:::</span>
<span id="cb32-596"><a href="#cb32-596"></a></span>
<span id="cb32-597"><a href="#cb32-597"></a>The histograms above show considerable heterogeneity in treatment effects across individuals in the charitable giving condition. To determine whether this variability is systematic (i.e., predictable based on individual characteristics) rather than random noise, we employ two complementary approaches: Qini curves to assess the reliability of heterogeneous effects, and policy trees to identify subgroups with differential treatment responses.</span>
<span id="cb32-598"><a href="#cb32-598"></a></span>
<span id="cb32-599"><a href="#cb32-599"></a><span class="in">```{r, results='asis'}</span></span>
<span id="cb32-600"><a href="#cb32-600"></a><span class="co">#| eval: true  # &lt;- copy and modify text as needed</span></span>
<span id="cb32-601"><a href="#cb32-601"></a><span class="co">#| echo: false</span></span>
<span id="cb32-602"><a href="#cb32-602"></a><span class="co">#| message: false</span></span>
<span id="cb32-603"><a href="#cb32-603"></a></span>
<span id="cb32-604"><a href="#cb32-604"></a><span class="co"># copy and paste into your text</span></span>
<span id="cb32-605"><a href="#cb32-605"></a><span class="fu">cat</span>(</span>
<span id="cb32-606"><a href="#cb32-606"></a>  boilerplate<span class="sc">::</span><span class="fu">boilerplate_generate_text</span>(</span>
<span id="cb32-607"><a href="#cb32-607"></a>    <span class="at">category     =</span> <span class="st">"results"</span>,</span>
<span id="cb32-608"><a href="#cb32-608"></a>    <span class="at">sections     =</span> <span class="fu">c</span>(<span class="st">"grf.interpretation_qini"</span>),</span>
<span id="cb32-609"><a href="#cb32-609"></a>    <span class="at">global_vars  =</span> global_vars,</span>
<span id="cb32-610"><a href="#cb32-610"></a>    <span class="at">db           =</span> unified_db</span>
<span id="cb32-611"><a href="#cb32-611"></a>  )</span>
<span id="cb32-612"><a href="#cb32-612"></a>)</span>
<span id="cb32-613"><a href="#cb32-613"></a><span class="in">```</span></span>
<span id="cb32-614"><a href="#cb32-614"></a></span>
<span id="cb32-615"><a href="#cb32-615"></a></span>
<span id="cb32-616"><a href="#cb32-616"></a><span class="fu">##### RATE AUTOC RESULTS</span></span>
<span id="cb32-617"><a href="#cb32-617"></a></span>
<span id="cb32-618"><a href="#cb32-618"></a><span class="in">```{r, results = 'asis'}</span></span>
<span id="cb32-619"><a href="#cb32-619"></a><span class="co"># only show if there are autoc results</span></span>
<span id="cb32-620"><a href="#cb32-620"></a><span class="cf">if</span> (<span class="fu">length</span>(model_groups<span class="sc">$</span>autoc) <span class="sc">&gt;</span> <span class="dv">0</span>) {</span>
<span id="cb32-621"><a href="#cb32-621"></a>  <span class="fu">cat</span>(rate_interp<span class="sc">$</span>autoc_results)</span>
<span id="cb32-622"><a href="#cb32-622"></a>} <span class="cf">else</span> {</span>
<span id="cb32-623"><a href="#cb32-623"></a>  <span class="fu">cat</span>(<span class="st">"No significant RATE AUTOC results were found."</span>)</span>
<span id="cb32-624"><a href="#cb32-624"></a>}</span>
<span id="cb32-625"><a href="#cb32-625"></a><span class="in">```</span></span>
<span id="cb32-626"><a href="#cb32-626"></a></span>
<span id="cb32-627"><a href="#cb32-627"></a></span>
<span id="cb32-628"><a href="#cb32-628"></a>::: {.column-screen}</span>
<span id="cb32-631"><a href="#cb32-631"></a><span class="in">```{r}</span></span>
<span id="cb32-632"><a href="#cb32-632"></a><span class="co">#| label: fig-rate-autoc</span></span>
<span id="cb32-633"><a href="#cb32-633"></a><span class="co">#| fig-cap: "RATE AUTOC Curves"</span></span>
<span id="cb32-634"><a href="#cb32-634"></a><span class="co">#| eval: true # &lt;- set to true if you have autoc plots</span></span>
<span id="cb32-635"><a href="#cb32-635"></a><span class="co">#| echo: true</span></span>
<span id="cb32-636"><a href="#cb32-636"></a><span class="co">#| fig-height: 12</span></span>
<span id="cb32-637"><a href="#cb32-637"></a><span class="co">#| fig-width: 12</span></span>
<span id="cb32-638"><a href="#cb32-638"></a></span>
<span id="cb32-639"><a href="#cb32-639"></a><span class="co"># display autoc plots if they exist</span></span>
<span id="cb32-640"><a href="#cb32-640"></a><span class="cf">if</span> (<span class="fu">length</span>(autoc_plots) <span class="sc">&gt;</span> <span class="dv">0</span>) {</span>
<span id="cb32-641"><a href="#cb32-641"></a>  <span class="co"># create blank plot for spacing</span></span>
<span id="cb32-642"><a href="#cb32-642"></a>  blank_plot <span class="ot">&lt;-</span> <span class="fu">plot_spacer</span>()</span>
<span id="cb32-643"><a href="#cb32-643"></a>  </span>
<span id="cb32-644"><a href="#cb32-644"></a>  <span class="co"># determine grid layout (2 columns preferred)</span></span>
<span id="cb32-645"><a href="#cb32-645"></a>  n_plots <span class="ot">&lt;-</span> <span class="fu">length</span>(autoc_plots)</span>
<span id="cb32-646"><a href="#cb32-646"></a>  n_cols <span class="ot">&lt;-</span> <span class="dv">2</span></span>
<span id="cb32-647"><a href="#cb32-647"></a>  n_rows <span class="ot">&lt;-</span> <span class="fu">ceiling</span>(n_plots <span class="sc">/</span> n_cols)</span>
<span id="cb32-648"><a href="#cb32-648"></a>  </span>
<span id="cb32-649"><a href="#cb32-649"></a>  <span class="co"># create list of plots including blank spacers for even grid</span></span>
<span id="cb32-650"><a href="#cb32-650"></a>  plot_list <span class="ot">&lt;-</span> autoc_plots</span>
<span id="cb32-651"><a href="#cb32-651"></a>  n_blanks_needed <span class="ot">&lt;-</span> (n_rows <span class="sc">*</span> n_cols) <span class="sc">-</span> n_plots</span>
<span id="cb32-652"><a href="#cb32-652"></a>  </span>
<span id="cb32-653"><a href="#cb32-653"></a>  <span class="co"># add blank plots to fill the grid</span></span>
<span id="cb32-654"><a href="#cb32-654"></a>  <span class="cf">if</span> (n_blanks_needed <span class="sc">&gt;</span> <span class="dv">0</span>) {</span>
<span id="cb32-655"><a href="#cb32-655"></a>    <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>n_blanks_needed) {</span>
<span id="cb32-656"><a href="#cb32-656"></a>      plot_list <span class="ot">&lt;-</span> <span class="fu">append</span>(plot_list, <span class="fu">list</span>(blank_plot))</span>
<span id="cb32-657"><a href="#cb32-657"></a>    }</span>
<span id="cb32-658"><a href="#cb32-658"></a>  }</span>
<span id="cb32-659"><a href="#cb32-659"></a>  </span>
<span id="cb32-660"><a href="#cb32-660"></a>  <span class="co"># combine plots in a grid</span></span>
<span id="cb32-661"><a href="#cb32-661"></a>  combined_autoc <span class="ot">&lt;-</span> <span class="fu">wrap_plots</span>(</span>
<span id="cb32-662"><a href="#cb32-662"></a>    plot_list,</span>
<span id="cb32-663"><a href="#cb32-663"></a>    <span class="at">ncol =</span> n_cols,</span>
<span id="cb32-664"><a href="#cb32-664"></a>    <span class="at">nrow =</span> n_rows</span>
<span id="cb32-665"><a href="#cb32-665"></a>  ) <span class="sc">+</span></span>
<span id="cb32-666"><a href="#cb32-666"></a>    <span class="fu">plot_layout</span>(<span class="at">guides =</span> <span class="st">"collect"</span>) <span class="sc">+</span></span>
<span id="cb32-667"><a href="#cb32-667"></a>    <span class="fu">plot_annotation</span>(</span>
<span id="cb32-668"><a href="#cb32-668"></a>      <span class="at">title    =</span> <span class="st">"RATE AUTOC Curves for Heterogeneous Effects"</span>,</span>
<span id="cb32-669"><a href="#cb32-669"></a>      <span class="at">subtitle =</span> <span class="fu">paste</span>(<span class="st">"Outcomes with significant autocorrelation (n ="</span>, </span>
<span id="cb32-670"><a href="#cb32-670"></a>                       n_plots, <span class="st">")"</span>)</span>
<span id="cb32-671"><a href="#cb32-671"></a>    ) <span class="sc">&amp;</span></span>
<span id="cb32-672"><a href="#cb32-672"></a>    <span class="fu">theme</span>(</span>
<span id="cb32-673"><a href="#cb32-673"></a>      <span class="at">legend.position   =</span> <span class="st">"bottom"</span>,</span>
<span id="cb32-674"><a href="#cb32-674"></a>      <span class="at">plot.title        =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>),</span>
<span id="cb32-675"><a href="#cb32-675"></a>      <span class="at">plot.subtitle     =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>)</span>
<span id="cb32-676"><a href="#cb32-676"></a>    )</span>
<span id="cb32-677"><a href="#cb32-677"></a>  </span>
<span id="cb32-678"><a href="#cb32-678"></a>  <span class="fu">print</span>(combined_autoc)</span>
<span id="cb32-679"><a href="#cb32-679"></a>} <span class="cf">else</span> {</span>
<span id="cb32-680"><a href="#cb32-680"></a>  <span class="fu">message</span>(<span class="st">"no autoc plots to display"</span>)</span>
<span id="cb32-681"><a href="#cb32-681"></a>}</span>
<span id="cb32-682"><a href="#cb32-682"></a><span class="in">```</span></span>
<span id="cb32-683"><a href="#cb32-683"></a>:::</span>
<span id="cb32-684"><a href="#cb32-684"></a></span>
<span id="cb32-685"><a href="#cb32-685"></a></span>
<span id="cb32-686"><a href="#cb32-686"></a><span class="in">```{r, results = 'asis'}</span></span>
<span id="cb32-687"><a href="#cb32-687"></a><span class="co">#| eval: true  # &lt;- set to true and use if you have reliable results</span></span>
<span id="cb32-688"><a href="#cb32-688"></a></span>
<span id="cb32-689"><a href="#cb32-689"></a><span class="co"># only use if you have reliable qini results</span></span>
<span id="cb32-690"><a href="#cb32-690"></a><span class="cf">if</span> (<span class="fu">length</span>(reliable_ids) <span class="sc">&gt;</span> <span class="dv">0</span>) {</span>
<span id="cb32-691"><a href="#cb32-691"></a>  <span class="fu">cat</span>(qini_gain<span class="sc">$</span>qini_explanation)</span>
<span id="cb32-692"><a href="#cb32-692"></a>} <span class="cf">else</span> {</span>
<span id="cb32-693"><a href="#cb32-693"></a>  <span class="fu">cat</span>(<span class="st">"No significant heterogeneous treatment effects were detected using Qini curve analysis."</span>)</span>
<span id="cb32-694"><a href="#cb32-694"></a>}</span>
<span id="cb32-695"><a href="#cb32-695"></a><span class="in">```</span></span>
<span id="cb32-696"><a href="#cb32-696"></a></span>
<span id="cb32-697"><a href="#cb32-697"></a></span>
<span id="cb32-700"><a href="#cb32-700"></a><span class="in">```{r}</span></span>
<span id="cb32-701"><a href="#cb32-701"></a><span class="co">#| tbl-cap: "Qini Curve Results"</span></span>
<span id="cb32-702"><a href="#cb32-702"></a><span class="co">#| eval: true  # &lt;- set to true if you have qini results</span></span>
<span id="cb32-703"><a href="#cb32-703"></a><span class="co"># only use if you have multiple qini results</span></span>
<span id="cb32-704"><a href="#cb32-704"></a><span class="cf">if</span> (<span class="fu">length</span>(reliable_ids) <span class="sc">&gt;</span> <span class="dv">0</span>) {</span>
<span id="cb32-705"><a href="#cb32-705"></a>  knitr<span class="sc">::</span><span class="fu">kable</span>(</span>
<span id="cb32-706"><a href="#cb32-706"></a>    qini_gain<span class="sc">$</span>summary_table <span class="sc">|&gt;</span> </span>
<span id="cb32-707"><a href="#cb32-707"></a>      <span class="fu">mutate</span>(<span class="fu">across</span>(<span class="fu">where</span>(is.numeric), <span class="sc">~</span> <span class="fu">round</span>(., <span class="dv">2</span>))),</span>
<span id="cb32-708"><a href="#cb32-708"></a>    <span class="at">format =</span> <span class="st">"markdown"</span>,</span>
<span id="cb32-709"><a href="#cb32-709"></a>    <span class="at">caption =</span> <span class="st">"Qini Curve Results"</span></span>
<span id="cb32-710"><a href="#cb32-710"></a>  )</span>
<span id="cb32-711"><a href="#cb32-711"></a>} <span class="cf">else</span> {</span>
<span id="cb32-712"><a href="#cb32-712"></a>  <span class="fu">cat</span>(<span class="st">"*Note: Qini curve table only displayed when multiple significant results are found.*"</span>)</span>
<span id="cb32-713"><a href="#cb32-713"></a>}</span>
<span id="cb32-714"><a href="#cb32-714"></a><span class="in">```</span></span>
<span id="cb32-715"><a href="#cb32-715"></a></span>
<span id="cb32-716"><a href="#cb32-716"></a>::: {.column-screen}</span>
<span id="cb32-719"><a href="#cb32-719"></a><span class="in">```{r}</span></span>
<span id="cb32-720"><a href="#cb32-720"></a><span class="co">#| label: fig-qini-combined</span></span>
<span id="cb32-721"><a href="#cb32-721"></a><span class="co">#| fig-cap: "Qini Curves for Heterogeneous Treatment Effects"</span></span>
<span id="cb32-722"><a href="#cb32-722"></a><span class="co">#| eval: true # &lt;- set to true if you have qini plots</span></span>
<span id="cb32-723"><a href="#cb32-723"></a><span class="co">#| echo: false</span></span>
<span id="cb32-724"><a href="#cb32-724"></a><span class="co">#| fig-height: 8</span></span>
<span id="cb32-725"><a href="#cb32-725"></a><span class="co">#| fig-width: 12</span></span>
<span id="cb32-726"><a href="#cb32-726"></a><span class="co"># only run if you have qini plots</span></span>
<span id="cb32-727"><a href="#cb32-727"></a><span class="cf">if</span> (<span class="fu">length</span>(qini_plots) <span class="sc">&gt;</span> <span class="dv">0</span>) {</span>
<span id="cb32-728"><a href="#cb32-728"></a>  <span class="co"># create blank plot for spacing</span></span>
<span id="cb32-729"><a href="#cb32-729"></a>  blank_plot <span class="ot">&lt;-</span> <span class="fu">plot_spacer</span>()</span>
<span id="cb32-730"><a href="#cb32-730"></a>  </span>
<span id="cb32-731"><a href="#cb32-731"></a>  <span class="co"># determine grid layout (2 columns preferred)</span></span>
<span id="cb32-732"><a href="#cb32-732"></a>  n_plots <span class="ot">&lt;-</span> <span class="fu">length</span>(qini_plots)</span>
<span id="cb32-733"><a href="#cb32-733"></a>  n_cols <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb32-734"><a href="#cb32-734"></a>  n_rows <span class="ot">&lt;-</span> <span class="fu">ceiling</span>(n_plots <span class="sc">/</span> n_cols)</span>
<span id="cb32-735"><a href="#cb32-735"></a>  </span>
<span id="cb32-736"><a href="#cb32-736"></a>  <span class="co"># create list of plots including blank spacers for even grid</span></span>
<span id="cb32-737"><a href="#cb32-737"></a>  plot_list <span class="ot">&lt;-</span> qini_plots</span>
<span id="cb32-738"><a href="#cb32-738"></a>  n_blanks_needed <span class="ot">&lt;-</span> (n_rows <span class="sc">*</span> n_cols) <span class="sc">-</span> n_plots</span>
<span id="cb32-739"><a href="#cb32-739"></a>  </span>
<span id="cb32-740"><a href="#cb32-740"></a>  <span class="co"># add blank plots to fill the grid</span></span>
<span id="cb32-741"><a href="#cb32-741"></a>  <span class="cf">if</span> (n_blanks_needed <span class="sc">&gt;</span> <span class="dv">0</span>) {</span>
<span id="cb32-742"><a href="#cb32-742"></a>    <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>n_blanks_needed) {</span>
<span id="cb32-743"><a href="#cb32-743"></a>      plot_list <span class="ot">&lt;-</span> <span class="fu">append</span>(plot_list, <span class="fu">list</span>(blank_plot))</span>
<span id="cb32-744"><a href="#cb32-744"></a>    }</span>
<span id="cb32-745"><a href="#cb32-745"></a>  }</span>
<span id="cb32-746"><a href="#cb32-746"></a>  </span>
<span id="cb32-747"><a href="#cb32-747"></a>  <span class="co"># combine plots in a grid</span></span>
<span id="cb32-748"><a href="#cb32-748"></a>  combined_qini <span class="ot">&lt;-</span> <span class="fu">wrap_plots</span>(</span>
<span id="cb32-749"><a href="#cb32-749"></a>    plot_list,</span>
<span id="cb32-750"><a href="#cb32-750"></a>    <span class="at">ncol =</span> n_cols,</span>
<span id="cb32-751"><a href="#cb32-751"></a>    <span class="at">nrow =</span> n_rows</span>
<span id="cb32-752"><a href="#cb32-752"></a>  ) <span class="sc">+</span></span>
<span id="cb32-753"><a href="#cb32-753"></a>    <span class="fu">plot_layout</span>(<span class="at">guides =</span> <span class="st">"collect"</span>) <span class="sc">+</span></span>
<span id="cb32-754"><a href="#cb32-754"></a>    <span class="fu">plot_annotation</span>(</span>
<span id="cb32-755"><a href="#cb32-755"></a>      <span class="at">title    =</span> <span class="st">"Qini Curves for Reliable Heterogeneous Effects"</span>,</span>
<span id="cb32-756"><a href="#cb32-756"></a>      <span class="at">subtitle =</span> <span class="fu">paste</span>(<span class="st">"Models with significant treatment effect heterogeneity (n ="</span>, </span>
<span id="cb32-757"><a href="#cb32-757"></a>                       n_plots, <span class="st">")"</span>)</span>
<span id="cb32-758"><a href="#cb32-758"></a>    ) <span class="sc">&amp;</span></span>
<span id="cb32-759"><a href="#cb32-759"></a>    <span class="fu">theme</span>(</span>
<span id="cb32-760"><a href="#cb32-760"></a>      <span class="at">legend.position   =</span> <span class="st">"bottom"</span>,</span>
<span id="cb32-761"><a href="#cb32-761"></a>      <span class="at">plot.title        =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>),</span>
<span id="cb32-762"><a href="#cb32-762"></a>      <span class="at">plot.subtitle     =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>)</span>
<span id="cb32-763"><a href="#cb32-763"></a>    )</span>
<span id="cb32-764"><a href="#cb32-764"></a>  </span>
<span id="cb32-765"><a href="#cb32-765"></a>  <span class="fu">print</span>(combined_qini)</span>
<span id="cb32-766"><a href="#cb32-766"></a>} <span class="cf">else</span> {</span>
<span id="cb32-767"><a href="#cb32-767"></a>  <span class="fu">message</span>(<span class="st">"no qini plots to display"</span>)</span>
<span id="cb32-768"><a href="#cb32-768"></a>}</span>
<span id="cb32-769"><a href="#cb32-769"></a></span>
<span id="cb32-770"><a href="#cb32-770"></a><span class="in">```</span></span>
<span id="cb32-771"><a href="#cb32-771"></a>:::</span>
<span id="cb32-772"><a href="#cb32-772"></a></span>
<span id="cb32-773"><a href="#cb32-773"></a><span class="fu">### Decision Rules (Who is Most Sensitive to Treatment?)</span></span>
<span id="cb32-774"><a href="#cb32-774"></a></span>
<span id="cb32-775"><a href="#cb32-775"></a><span class="in">```{r, results='asis'}</span></span>
<span id="cb32-776"><a href="#cb32-776"></a><span class="co">#| eval: true  # &lt;- set to true and modify text as needed</span></span>
<span id="cb32-777"><a href="#cb32-777"></a></span>
<span id="cb32-778"><a href="#cb32-778"></a><span class="fu">cat</span>(</span>
<span id="cb32-779"><a href="#cb32-779"></a>  boilerplate<span class="sc">::</span><span class="fu">boilerplate_generate_text</span>(</span>
<span id="cb32-780"><a href="#cb32-780"></a>    <span class="at">category     =</span> <span class="st">"results"</span>,</span>
<span id="cb32-781"><a href="#cb32-781"></a>    <span class="at">sections     =</span> <span class="fu">c</span>(<span class="st">"grf.interpretation_policy_tree"</span>),</span>
<span id="cb32-782"><a href="#cb32-782"></a>    <span class="at">global_vars  =</span> global_vars,</span>
<span id="cb32-783"><a href="#cb32-783"></a>    <span class="at">db           =</span> unified_db</span>
<span id="cb32-784"><a href="#cb32-784"></a>  )</span>
<span id="cb32-785"><a href="#cb32-785"></a>)</span>
<span id="cb32-786"><a href="#cb32-786"></a><span class="in">```</span></span>
<span id="cb32-787"><a href="#cb32-787"></a></span>
<span id="cb32-788"><a href="#cb32-788"></a>The following pages present policy trees for each outcome with reliable heterogeneous effects. Each tree shows: (1) the decision rules for treatment assignment, (2) the distribution of treatment effects across subgroups, and (3) visual representation of how covariates split the population into groups with differential treatment responses.</span>
<span id="cb32-789"><a href="#cb32-789"></a></span>
<span id="cb32-790"><a href="#cb32-790"></a>::: {.column-screen}</span>
<span id="cb32-793"><a href="#cb32-793"></a><span class="in">```{r}</span></span>
<span id="cb32-794"><a href="#cb32-794"></a><span class="co">#| label: fig-policy-trees</span></span>
<span id="cb32-795"><a href="#cb32-795"></a><span class="co">#| fig-cap: "Policy Trees for Treatment Assignment"</span></span>
<span id="cb32-796"><a href="#cb32-796"></a><span class="co">#| eval: true # &lt;- set to true if you have policy trees</span></span>
<span id="cb32-797"><a href="#cb32-797"></a><span class="co">#| echo: true</span></span>
<span id="cb32-798"><a href="#cb32-798"></a><span class="co">#| fig-height: 12</span></span>
<span id="cb32-799"><a href="#cb32-799"></a><span class="co">#| fig-width: 18</span></span>
<span id="cb32-800"><a href="#cb32-800"></a></span>
<span id="cb32-801"><a href="#cb32-801"></a><span class="co"># display policy trees if they exist - one per page</span></span>
<span id="cb32-802"><a href="#cb32-802"></a><span class="cf">if</span> (<span class="fu">length</span>(policy_plots) <span class="sc">&gt;</span> <span class="dv">0</span>) {</span>
<span id="cb32-803"><a href="#cb32-803"></a>  <span class="co"># iterate through each policy tree</span></span>
<span id="cb32-804"><a href="#cb32-804"></a>  <span class="cf">for</span> (i <span class="cf">in</span> <span class="fu">seq_along</span>(policy_plots)) {</span>
<span id="cb32-805"><a href="#cb32-805"></a>    <span class="co"># add page break before each plot except the first</span></span>
<span id="cb32-806"><a href="#cb32-806"></a>    <span class="cf">if</span> (i <span class="sc">&gt;</span> <span class="dv">1</span>) {</span>
<span id="cb32-807"><a href="#cb32-807"></a>      <span class="fu">cat</span>(<span class="st">"</span><span class="sc">\n\n</span><span class="st">{{&lt; pagebreak &gt;}}</span><span class="sc">\n\n</span><span class="st">"</span>)</span>
<span id="cb32-808"><a href="#cb32-808"></a>    }</span>
<span id="cb32-809"><a href="#cb32-809"></a>    </span>
<span id="cb32-810"><a href="#cb32-810"></a>    <span class="co"># create individual caption for each tree</span></span>
<span id="cb32-811"><a href="#cb32-811"></a>    <span class="fu">cat</span>(<span class="fu">paste0</span>(<span class="st">"</span><span class="sc">\n\n</span><span class="st">#### Policy Tree "</span>, i, <span class="st">": "</span>, qini_names[[i]], <span class="st">"</span><span class="sc">\n\n</span><span class="st">"</span>))</span>
<span id="cb32-812"><a href="#cb32-812"></a>    </span>
<span id="cb32-813"><a href="#cb32-813"></a>    <span class="co"># print the policy tree</span></span>
<span id="cb32-814"><a href="#cb32-814"></a>    <span class="fu">print</span>(policy_plots[[i]])</span>
<span id="cb32-815"><a href="#cb32-815"></a>    </span>
<span id="cb32-816"><a href="#cb32-816"></a>    <span class="co"># add some space after</span></span>
<span id="cb32-817"><a href="#cb32-817"></a>    <span class="fu">cat</span>(<span class="st">"</span><span class="sc">\n\n</span><span class="st">"</span>)</span>
<span id="cb32-818"><a href="#cb32-818"></a>  }</span>
<span id="cb32-819"><a href="#cb32-819"></a>} <span class="cf">else</span> {</span>
<span id="cb32-820"><a href="#cb32-820"></a>  <span class="fu">message</span>(<span class="st">"no policy trees to display"</span>)</span>
<span id="cb32-821"><a href="#cb32-821"></a>}</span>
<span id="cb32-822"><a href="#cb32-822"></a><span class="in">```</span></span>
<span id="cb32-823"><a href="#cb32-823"></a>:::</span>
<span id="cb32-824"><a href="#cb32-824"></a></span>
<span id="cb32-825"><a href="#cb32-825"></a></span>
<span id="cb32-826"><a href="#cb32-826"></a><span class="in">```{r, results = 'asis'}</span></span>
<span id="cb32-827"><a href="#cb32-827"></a><span class="co">#| eval: true # &lt;- copy and paste text a insert jsust below graph</span></span>
<span id="cb32-828"><a href="#cb32-828"></a><span class="co"># use this text below your decision tree graphs</span></span>
<span id="cb32-829"><a href="#cb32-829"></a><span class="cf">if</span> (<span class="fu">length</span>(reliable_ids) <span class="sc">&gt;</span> <span class="dv">0</span>) {</span>
<span id="cb32-830"><a href="#cb32-830"></a>  <span class="fu">cat</span>(policy_text, <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb32-831"><a href="#cb32-831"></a>}</span>
<span id="cb32-832"><a href="#cb32-832"></a><span class="in">```</span></span>
<span id="cb32-833"><a href="#cb32-833"></a></span>
<span id="cb32-834"><a href="#cb32-834"></a></span>
<span id="cb32-835"><a href="#cb32-835"></a></span>
<span id="cb32-836"><a href="#cb32-836"></a><span class="fu">### What happens when you estimate a policy tree when there is no heterogeneity? </span></span>
<span id="cb32-837"><a href="#cb32-837"></a></span>
<span id="cb32-838"><a href="#cb32-838"></a></span>
<span id="cb32-839"><a href="#cb32-839"></a></span>
<span id="cb32-840"><a href="#cb32-840"></a></span>
<span id="cb32-841"><a href="#cb32-841"></a></span>
<span id="cb32-842"><a href="#cb32-842"></a><span class="fu">## Discussion</span></span>
<span id="cb32-843"><a href="#cb32-843"></a></span>
<span id="cb32-844"><a href="#cb32-844"></a><span class="in">```{r,  results='asis'}</span></span>
<span id="cb32-845"><a href="#cb32-845"></a><span class="co">#| eval: false  # &lt;- set to true and modify text as needed</span></span>
<span id="cb32-846"><a href="#cb32-846"></a><span class="co">#| echo: false</span></span>
<span id="cb32-847"><a href="#cb32-847"></a></span>
<span id="cb32-848"><a href="#cb32-848"></a><span class="fu">cat</span>(<span class="fu">boilerplate_generate_text</span>(</span>
<span id="cb32-849"><a href="#cb32-849"></a>  <span class="at">category =</span> <span class="st">"discussion"</span>,</span>
<span id="cb32-850"><a href="#cb32-850"></a>  <span class="at">sections =</span> <span class="fu">c</span>(</span>
<span id="cb32-851"><a href="#cb32-851"></a>    <span class="st">"student_ethics"</span>,</span>
<span id="cb32-852"><a href="#cb32-852"></a>    <span class="st">"student_data"</span>,</span>
<span id="cb32-853"><a href="#cb32-853"></a>    <span class="st">"student_authors_statement"</span></span>
<span id="cb32-854"><a href="#cb32-854"></a>  ),</span>
<span id="cb32-855"><a href="#cb32-855"></a>  <span class="at">global_vars =</span> <span class="fu">list</span>(</span>
<span id="cb32-856"><a href="#cb32-856"></a>    <span class="at">exposure_variable =</span> <span class="st">"belief in God"</span></span>
<span id="cb32-857"><a href="#cb32-857"></a>  ),</span>
<span id="cb32-858"><a href="#cb32-858"></a>  <span class="at">db =</span> unified_db</span>
<span id="cb32-859"><a href="#cb32-859"></a>))</span>
<span id="cb32-860"><a href="#cb32-860"></a></span>
<span id="cb32-861"><a href="#cb32-861"></a></span>
<span id="cb32-862"><a href="#cb32-862"></a><span class="in">```</span></span>
<span id="cb32-863"><a href="#cb32-863"></a></span>
<span id="cb32-864"><a href="#cb32-864"></a>{{&lt; pagebreak &gt;}}</span>
<span id="cb32-865"><a href="#cb32-865"></a></span>
<span id="cb32-866"><a href="#cb32-866"></a><span class="fu">## S1: Estimating and Interpreting Heterogeneous Treatment Effects with GRF {#appendix-explain-grf}</span></span>
<span id="cb32-867"><a href="#cb32-867"></a></span>
<span id="cb32-868"><a href="#cb32-868"></a><span class="in">```{r, results='asis'}</span></span>
<span id="cb32-869"><a href="#cb32-869"></a><span class="co">#| eval: false # &lt;- set to true as needed</span></span>
<span id="cb32-870"><a href="#cb32-870"></a><span class="co">#| echo: false</span></span>
<span id="cb32-871"><a href="#cb32-871"></a></span>
<span id="cb32-872"><a href="#cb32-872"></a><span class="fu">cat</span>(</span>
<span id="cb32-873"><a href="#cb32-873"></a>  boilerplate<span class="sc">::</span><span class="fu">boilerplate_generate_text</span>(</span>
<span id="cb32-874"><a href="#cb32-874"></a>    <span class="at">category     =</span> <span class="st">"appendix"</span>,</span>
<span id="cb32-875"><a href="#cb32-875"></a>    <span class="at">sections     =</span> <span class="fu">c</span>(<span class="st">"explain.grf_short"</span>),</span>
<span id="cb32-876"><a href="#cb32-876"></a>    <span class="at">global_vars  =</span> global_vars,</span>
<span id="cb32-877"><a href="#cb32-877"></a>    <span class="at">db           =</span> unified_db</span>
<span id="cb32-878"><a href="#cb32-878"></a>  )</span>
<span id="cb32-879"><a href="#cb32-879"></a>)</span>
<span id="cb32-880"><a href="#cb32-880"></a><span class="in">```</span></span>
<span id="cb32-881"><a href="#cb32-881"></a><span class="fu">#### Qini Curves</span></span>
<span id="cb32-882"><a href="#cb32-882"></a></span>
<span id="cb32-883"><a href="#cb32-883"></a>The Qini curve shows the cumulative **gain** as we expand a targeting rule down the CATE ranking.</span>
<span id="cb32-884"><a href="#cb32-884"></a></span>
<span id="cb32-885"><a href="#cb32-885"></a><span class="ss">* </span>**Beneficial exposure:** we add individuals from the top positive CATEs downward; the baseline is 'expose everyone.'</span>
<span id="cb32-886"><a href="#cb32-886"></a><span class="ss">* </span>**Detrimental exposure:** we first flip outcome direction (so higher values represent **more harm**; see ), then *add* the exposure starting with individuals whose CATEs show the **greated harm**, gradually including those predicted to be more resistant to harm; the baseline is 'expose everyone.'  The curve therefore quantifies the harm by when those most suceptible to harm are exposed.</span>
<span id="cb32-887"><a href="#cb32-887"></a></span>
<span id="cb32-888"><a href="#cb32-888"></a></span>
<span id="cb32-889"><a href="#cb32-889"></a><span class="fu">## S2: Strengths and Limitations of Causal Forests {#appendix-strengths}</span></span>
<span id="cb32-890"><a href="#cb32-890"></a></span>
<span id="cb32-891"><a href="#cb32-891"></a><span class="in">```{r, results='asis'}</span></span>
<span id="cb32-892"><a href="#cb32-892"></a><span class="co">#| eval: true # &lt;- set to true and modify text as needed</span></span>
<span id="cb32-893"><a href="#cb32-893"></a></span>
<span id="cb32-894"><a href="#cb32-894"></a><span class="fu">cat</span>(</span>
<span id="cb32-895"><a href="#cb32-895"></a>  boilerplate<span class="sc">::</span><span class="fu">boilerplate_generate_text</span>(</span>
<span id="cb32-896"><a href="#cb32-896"></a>    <span class="at">category     =</span> <span class="st">"discussion"</span>,</span>
<span id="cb32-897"><a href="#cb32-897"></a>    <span class="at">sections     =</span> <span class="fu">c</span>(<span class="st">"strengths.strengths_grf_short"</span>),</span>
<span id="cb32-898"><a href="#cb32-898"></a>    <span class="at">global_vars  =</span> global_vars,</span>
<span id="cb32-899"><a href="#cb32-899"></a>    <span class="at">db           =</span> unified_db</span>
<span id="cb32-900"><a href="#cb32-900"></a>  )</span>
<span id="cb32-901"><a href="#cb32-901"></a>)</span>
<span id="cb32-902"><a href="#cb32-902"></a><span class="in">```</span></span>
<span id="cb32-903"><a href="#cb32-903"></a></span>
<span id="cb32-904"><a href="#cb32-904"></a><span class="fu">## References {.appendix-refs}</span></span>
</code></pre></div><button title="Copy to Clipboard" class="code-copy-button" data-in-quarto-modal=""><i class="bi"></i></button></div>
</div></div></div></div></div>
</div> <!-- /content -->




<script src="../site_libs/quarto-html/zenscroll-min.js"></script>
</body></html>