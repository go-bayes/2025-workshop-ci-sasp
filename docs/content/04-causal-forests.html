<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.8.18">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="dcterms.date" content="2025-08-12">

<title>Estimation of ATE and CATE Using Machine Learning ‚Äì Day 2: SPARCC Causal Inference Workshop</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
/* CSS for citations */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
  margin-bottom: 0em;
}
.hanging-indent div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}</style>


<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<script src="../site_libs/quarto-html/quarto.js" type="module"></script>
<script src="../site_libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="../site_libs/quarto-html/axe/axe-check.js" type="module"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting-3093d61113649c6a7049b7a5dcf186b4.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-text-highlighting-styles">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting-dark-0eb7924ecc8bf9a85b83eff7fafeffc4.css" rel="stylesheet" class="quarto-color-scheme quarto-color-alternate" id="quarto-text-highlighting-styles">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting-3093d61113649c6a7049b7a5dcf186b4.css" rel="stylesheet" class="quarto-color-scheme-extra" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap-0ed94031a29975fead07021e53b97c54.min.css" rel="stylesheet" append-hash="true" class="quarto-color-scheme" id="quarto-bootstrap" data-mode="light">
<link href="../site_libs/bootstrap/bootstrap-dark-2dce174802e107ce2a29065059e2a967.min.css" rel="stylesheet" append-hash="true" class="quarto-color-scheme quarto-color-alternate" id="quarto-bootstrap" data-mode="dark">
<link href="../site_libs/bootstrap/bootstrap-0ed94031a29975fead07021e53b97c54.min.css" rel="stylesheet" append-hash="true" class="quarto-color-scheme-extra" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<style>html{ scroll-behavior: smooth; }</style>

  <script>window.backupDefine = window.define; window.define = undefined;</script><script src="https://cdn.jsdelivr.net/npm/katex@latest/dist/katex.min.js"></script>
  <script>document.addEventListener("DOMContentLoaded", function () {
 var mathElements = document.getElementsByClassName("math");
 var macros = [];
 for (var i = 0; i < mathElements.length; i++) {
  var texText = mathElements[i].firstChild;
  if (mathElements[i].tagName == "SPAN") {
   katex.render(texText.data, mathElements[i], {
    displayMode: mathElements[i].classList.contains('display'),
    throwOnError: false,
    macros: macros,
    fleqn: false
   });
}}});
  </script>
  <script>window.define = window.backupDefine; window.backupDefine = undefined;</script><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@latest/dist/katex.min.css">

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN" && texText && texText.data) {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

</head>

<body class="nav-fixed quarto-light"><script id="quarto-html-before-body" type="application/javascript">
    const toggleBodyColorMode = (bsSheetEl) => {
      const mode = bsSheetEl.getAttribute("data-mode");
      const bodyEl = window.document.querySelector("body");
      if (mode === "dark") {
        bodyEl.classList.add("quarto-dark");
        bodyEl.classList.remove("quarto-light");
      } else {
        bodyEl.classList.add("quarto-light");
        bodyEl.classList.remove("quarto-dark");
      }
    }
    const toggleBodyColorPrimary = () => {
      const bsSheetEl = window.document.querySelector("link#quarto-bootstrap:not([rel=disabled-stylesheet])");
      if (bsSheetEl) {
        toggleBodyColorMode(bsSheetEl);
      }
    }
    const setColorSchemeToggle = (alternate) => {
      const toggles = window.document.querySelectorAll('.quarto-color-scheme-toggle');
      for (let i=0; i < toggles.length; i++) {
        const toggle = toggles[i];
        if (toggle) {
          if (alternate) {
            toggle.classList.add("alternate");
          } else {
            toggle.classList.remove("alternate");
          }
        }
      }
    };
    const toggleColorMode = (alternate) => {
      // Switch the stylesheets
      const primaryStylesheets = window.document.querySelectorAll('link.quarto-color-scheme:not(.quarto-color-alternate)');
      const alternateStylesheets = window.document.querySelectorAll('link.quarto-color-scheme.quarto-color-alternate');
      manageTransitions('#quarto-margin-sidebar .nav-link', false);
      if (alternate) {
        // note: dark is layered on light, we don't disable primary!
        enableStylesheet(alternateStylesheets);
        for (const sheetNode of alternateStylesheets) {
          if (sheetNode.id === "quarto-bootstrap") {
            toggleBodyColorMode(sheetNode);
          }
        }
      } else {
        disableStylesheet(alternateStylesheets);
        enableStylesheet(primaryStylesheets)
        toggleBodyColorPrimary();
      }
      manageTransitions('#quarto-margin-sidebar .nav-link', true);
      // Switch the toggles
      setColorSchemeToggle(alternate)
      // Hack to workaround the fact that safari doesn't
      // properly recolor the scrollbar when toggling (#1455)
      if (navigator.userAgent.indexOf('Safari') > 0 && navigator.userAgent.indexOf('Chrome') == -1) {
        manageTransitions("body", false);
        window.scrollTo(0, 1);
        setTimeout(() => {
          window.scrollTo(0, 0);
          manageTransitions("body", true);
        }, 40);
      }
    }
    const disableStylesheet = (stylesheets) => {
      for (let i=0; i < stylesheets.length; i++) {
        const stylesheet = stylesheets[i];
        stylesheet.rel = 'disabled-stylesheet';
      }
    }
    const enableStylesheet = (stylesheets) => {
      for (let i=0; i < stylesheets.length; i++) {
        const stylesheet = stylesheets[i];
        if(stylesheet.rel !== 'stylesheet') { // for Chrome, which will still FOUC without this check
          stylesheet.rel = 'stylesheet';
        }
      }
    }
    const manageTransitions = (selector, allowTransitions) => {
      const els = window.document.querySelectorAll(selector);
      for (let i=0; i < els.length; i++) {
        const el = els[i];
        if (allowTransitions) {
          el.classList.remove('notransition');
        } else {
          el.classList.add('notransition');
        }
      }
    }
    const isFileUrl = () => {
      return window.location.protocol === 'file:';
    }
    const hasAlternateSentinel = () => {
      let styleSentinel = getColorSchemeSentinel();
      if (styleSentinel !== null) {
        return styleSentinel === "alternate";
      } else {
        return false;
      }
    }
    const setStyleSentinel = (alternate) => {
      const value = alternate ? "alternate" : "default";
      if (!isFileUrl()) {
        window.localStorage.setItem("quarto-color-scheme", value);
      } else {
        localAlternateSentinel = value;
      }
    }
    const getColorSchemeSentinel = () => {
      if (!isFileUrl()) {
        const storageValue = window.localStorage.getItem("quarto-color-scheme");
        return storageValue != null ? storageValue : localAlternateSentinel;
      } else {
        return localAlternateSentinel;
      }
    }
    const toggleGiscusIfUsed = (isAlternate, darkModeDefault) => {
      const baseTheme = document.querySelector('#giscus-base-theme')?.value ?? 'light';
      const alternateTheme = document.querySelector('#giscus-alt-theme')?.value ?? 'dark';
      let newTheme = '';
      if(authorPrefersDark) {
        newTheme = isAlternate ? baseTheme : alternateTheme;
      } else {
        newTheme = isAlternate ? alternateTheme : baseTheme;
      }
      const changeGiscusTheme = () => {
        // From: https://github.com/giscus/giscus/issues/336
        const sendMessage = (message) => {
          const iframe = document.querySelector('iframe.giscus-frame');
          if (!iframe) return;
          iframe.contentWindow.postMessage({ giscus: message }, 'https://giscus.app');
        }
        sendMessage({
          setConfig: {
            theme: newTheme
          }
        });
      }
      const isGiscussLoaded = window.document.querySelector('iframe.giscus-frame') !== null;
      if (isGiscussLoaded) {
        changeGiscusTheme();
      }
    };
    const authorPrefersDark = false;
    const darkModeDefault = authorPrefersDark;
      document.querySelector('link#quarto-text-highlighting-styles.quarto-color-scheme-extra').rel = 'disabled-stylesheet';
      document.querySelector('link#quarto-bootstrap.quarto-color-scheme-extra').rel = 'disabled-stylesheet';
    let localAlternateSentinel = darkModeDefault ? 'alternate' : 'default';
    // Dark / light mode switch
    window.quartoToggleColorScheme = () => {
      // Read the current dark / light value
      let toAlternate = !hasAlternateSentinel();
      toggleColorMode(toAlternate);
      setStyleSentinel(toAlternate);
      toggleGiscusIfUsed(toAlternate, darkModeDefault);
      window.dispatchEvent(new Event('resize'));
    };
    // Switch to dark mode if need be
    if (hasAlternateSentinel()) {
      toggleColorMode(true);
    } else {
      toggleColorMode(false);
    }
  </script>

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a href="../index.html" class="navbar-brand navbar-brand-logo">
    </a>
    <a class="navbar-brand" href="../index.html">
    <span class="navbar-title">Day 2: SPARCC Causal Inference Workshop</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="../index.html"> 
<span class="menu-text">üè† Home</span></a>
  </li>  
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-content" role="link" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">üìö CONTENT</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-content">    
        <li class="dropdown-header">Core Materials</li>
        <li><hr class="dropdown-divider"></li>
        <li class="dropdown-header">Workshop Sessions</li>
        <li>
    <a class="dropdown-item" href="../content/00-background.html">
 <span class="dropdown-text">1. What is Causality?</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../content/01-background.html">
 <span class="dropdown-text">2. Identification Using Causal DAGs</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../content/02-causal-workflow.html">
 <span class="dropdown-text">3. Causal Workflow</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../content/03-interaction.html">
 <span class="dropdown-text">4. Average and Conditional Average Treatment Effects</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../content/05-measurement.html">
 <span class="dropdown-text">5. Measurement Matters</span></a>
  </li>  
        <li><hr class="dropdown-divider"></li>
        <li>
    <a class="dropdown-item" href="../workshop-scripts/06-interpretation-2.html">
 <span class="dropdown-text">6. Code Review</span></a>
  </li>  
        <li class="dropdown-header">Simulations</li>
        <li>
    <a class="dropdown-item" href="../simulations/01-simulation-population.html">
 <span class="dropdown-text">Simulation: Population Estimate</span></a>
  </li>  
        <li class="dropdown-header">ggdag</li>
        <li>
    <a class="dropdown-item" href="../content/ggdag-examples.html">
 <span class="dropdown-text">Causal Diagrams: The Structures of Interaction/Effect Modification, Measurement Bias, Selection Bias</span></a>
  </li>  
        <li class="dropdown-header">References</li>
        <li>
    <a class="dropdown-item" href="../pdfs/bulbulia-hand-outs/S2-glossary.pdf">
 <span class="dropdown-text">Glossary (PDF)</span></a>
  </li>  
        <li><hr class="dropdown-divider"></li>
        <li>
    <a class="dropdown-item" href="../quiz/sparcc_day_2_short_quiz.pdf">
 <span class="dropdown-text">Short Quiz</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../quiz/sparcc_day_2_short_quiz-answer-key.pdf">
 <span class="dropdown-text">Short Quiz Answer Key</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../quiz/2025-SPARCC-DAY-2-TEST.pdf">
 <span class="dropdown-text">Test</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item">
    <a class="nav-link" href="../glossary-and-dags.html"> 
<span class="menu-text">üìä Glossary &amp; DAGs</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../reading.html"> 
<span class="menu-text">üìö Reading</span></a>
  </li>  
</ul>
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item">
    <a class="nav-link" href="https://go-bayes.github.io/sparcc-day-1/"> 
<span class="menu-text">Day 1 Workshop led by B.G. Purzycki</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="https://github.com/go-bayes"> <i class="bi bi-github" role="img">
</i> 
<span class="menu-text">Research Code</span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
  <a href="" class="quarto-color-scheme-toggle quarto-navigation-tool  px-1" onclick="window.quartoToggleColorScheme(); return false;" title="Toggle dark mode"><i class="bi"></i></a>
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#part-1-heterogeneous-treatment-effect-analysis-with-causal-forests" id="toc-part-1-heterogeneous-treatment-effect-analysis-with-causal-forests" class="nav-link active" data-scroll-target="#part-1-heterogeneous-treatment-effect-analysis-with-causal-forests">PART 1 Heterogeneous-Treatment-Effect Analysis with <strong>causal forests</strong></a>
  <ul class="collapse">
  <li><a href="#why-worry-about-heterogeneity" id="toc-why-worry-about-heterogeneity" class="nav-link" data-scroll-target="#why-worry-about-heterogeneity">Why worry about heterogeneity?</a></li>
  <li><a href="#start-with-estimating-the-average-treatment-effect-ate" id="toc-start-with-estimating-the-average-treatment-effect-ate" class="nav-link" data-scroll-target="#start-with-estimating-the-average-treatment-effect-ate">1 Start with estimating the average treatment effect (ATE)</a></li>
  <li><a href="#do-effects-differ-across-people" id="toc-do-effects-differ-across-people" class="nav-link" data-scroll-target="#do-effects-differ-across-people">2 Do effects differ across people?</a></li>
  <li><a href="#from-straight-lines-to-trees" id="toc-from-straight-lines-to-trees" class="nav-link" data-scroll-target="#from-straight-lines-to-trees">3. From straight lines to trees</a></li>
  <li><a href="#building-honest-trees-avoiding-over-fitting" id="toc-building-honest-trees-avoiding-over-fitting" class="nav-link" data-scroll-target="#building-honest-trees-avoiding-over-fitting">4 Building Honest Trees: Avoiding Over-Fitting</a></li>
  <li><a href="#handling-missing-data" id="toc-handling-missing-data" class="nav-link" data-scroll-target="#handling-missing-data">5 Handling missing data</a></li>
  <li><a href="#is-the-heterogeneity-actionable-rate-statistics" id="toc-is-the-heterogeneity-actionable-rate-statistics" class="nav-link" data-scroll-target="#is-the-heterogeneity-actionable-rate-statistics">6 Is the heterogeneity <em>actionable</em>? ‚Äî RATE statistics</a></li>
  <li><a href="#rate-autoc-example" id="toc-rate-autoc-example" class="nav-link" data-scroll-target="#rate-autoc-example">7 RATE AUTOC EXAMPLE</a></li>
  <li><a href="#visualising-policy-value-the-qini-curve" id="toc-visualising-policy-value-the-qini-curve" class="nav-link" data-scroll-target="#visualising-policy-value-the-qini-curve">8 Visualising policy value: the Qini curve</a></li>
  <li><a href="#from-a-black-box-to-simple-rules-policy-trees" id="toc-from-a-black-box-to-simple-rules-policy-trees" class="nav-link" data-scroll-target="#from-a-black-box-to-simple-rules-policy-trees">9 From ‚Äòa black box‚Äô to simple rules: policy trees</a></li>
  <li><a href="#ethical-and-practical-considerations" id="toc-ethical-and-practical-considerations" class="nav-link" data-scroll-target="#ethical-and-practical-considerations">10 Ethical and practical considerations</a></li>
  <li><a href="#summarynext-steps" id="toc-summarynext-steps" class="nav-link" data-scroll-target="#summarynext-steps">Summary/next steps</a></li>
  <li><a href="#appendix" id="toc-appendix" class="nav-link" data-scroll-target="#appendix">Appendix</a>
  <ul class="collapse">
  <li><a href="#causal-estimand-statistical-estimand-statistical-estimator" id="toc-causal-estimand-statistical-estimand-statistical-estimator" class="nav-link" data-scroll-target="#causal-estimand-statistical-estimand-statistical-estimator">Causal Estimand, Statistical Estimand, Statistical Estimator</a></li>
  </ul></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content page-columns page-full" id="quarto-document-content">


<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<div class="quarto-title-block"><div><h1 class="title">Estimation of ATE and CATE Using Machine Learning</h1><button type="button" class="btn code-tools-button" id="quarto-code-tools-source"><i class="bi"></i> Code</button></div></div>
</div>



<div class="quarto-title-meta">

    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">August 12, 2025</p>
    </div>
  </div>
  
    
  </div>
  


</header>


<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p><strong>Key Readings</strong> - <a href="https://grf-labs.github.io/grf/">https://grf-labs.github.io/grf/</a></p>
<p><strong>Optional</strong> - <span class="citation" data-cites="vanderweele2020">(<a href="#ref-vanderweele2020" role="doc-biblioref">VanderWeele, Mathur, and Chen 2020</a>)</span> <a href="https://www.dropbox.com/scl/fi/srpynr0dvjcndveplcydn/OutcomeWide_StatisticalScience.pdf?rlkey=h4fv32oyjegdfl3jq9u1fifc3&amp;dl=0">link</a> - <span class="citation" data-cites="suzuki2020">(<a href="#ref-suzuki2020" role="doc-biblioref">Suzuki, Shinozaki, and Yamamoto 2020</a>)</span> <a href="https://www.dropbox.com/scl/fi/4midxwr9ltg9oce02e0ss/suzuki-causal-diagrams.pdf?rlkey=uktzf3nurtgpbj8m4h0xz82dn&amp;dl=0">link</a> - <span class="citation" data-cites="Bulbulia2024PracticalGuide">(<a href="#ref-Bulbulia2024PracticalGuide" role="doc-biblioref">Bulbulia 2024</a>)</span> <a href="https://osf.io/preprints/psyarxiv/uyg3d">link</a> - <span class="citation" data-cites="hoffman2023">(<a href="#ref-hoffman2023" role="doc-biblioref">Hoffman et al. 2023</a>)</span> <a href="https://arxiv.org/pdf/2304.09460.pdf">link</a></p>
</div>
</div>
<div class="no-row-height column-margin column-container"><div id="ref-hoffman2023" class="csl-entry" role="listitem">
Hoffman, Katherine L., Diego Salazar-Barreto, Kara E. Rudolph, and Iv√°n D√≠az. 2023. <span>‚ÄúIntroducing Longitudinal Modified Treatment Policies: A Unified Framework for Studying Complex Exposures,‚Äù</span> April. <a href="https://doi.org/10.48550/arXiv.2304.09460">https://doi.org/10.48550/arXiv.2304.09460</a>.
</div></div><div class="no-row-height column-margin column-container"><div id="ref-Bulbulia2024PracticalGuide" class="csl-entry" role="listitem">
Bulbulia, J. A. 2024. <span>‚ÄúA Practical Guide to Causal Inference in Three-Wave Panel Studies.‚Äù</span> OSF. <a href="https://doi.org/10.31234/osf.io/uyg3d">https://doi.org/10.31234/osf.io/uyg3d</a>.
</div></div><div class="no-row-height column-margin column-container"><div id="ref-suzuki2020" class="csl-entry" role="listitem">
Suzuki, Etsuji, Tomohiro Shinozaki, and Eiji Yamamoto. 2020. <span>‚ÄúCausal Diagrams: Pitfalls and Tips.‚Äù</span> <em>Journal of Epidemiology</em> 30 (4): 153‚Äì62. <a href="https://doi.org/10.2188/jea.JE20190192">https://doi.org/10.2188/jea.JE20190192</a>.
</div></div><div class="no-row-height column-margin column-container"><div id="ref-vanderweele2020" class="csl-entry" role="listitem">
VanderWeele, Tyler J, Maya B Mathur, and Ying Chen. 2020. <span>‚ÄúOutcome-Wide Longitudinal Designs for Causal Inference: A New Template for Empirical Studies.‚Äù</span> <em>Statistical Science</em> 35 (3): 437‚Äì66.
</div></div><div class="callout callout-style-default callout-important callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<span class="screen-reader-only">Important</span>Key concepts
</div>
</div>
<div class="callout-body-container callout-body">
<p>The workflow below introduces <strong>heterogeneous-treatment-effect (HTE) analysis</strong> with <em>causal forests</em>. By the end of the seminar you should understand six technical ideas: (1) ATE (2) CATE (3) The estimator <span class="math inline">\widehat{\tau}(x)</span>, (lecture 6) (4) the RATE statistics drawn from a <strong>Targeting-Operator Characteristic</strong> (TOC) curve (new) (5) Qini Curves (new) (6) <strong>policy trees</strong>‚Äîand know how each fits into an applied research pipelin (new)</p>
</div>
</div>
<section id="part-1-heterogeneous-treatment-effect-analysis-with-causal-forests" class="level1 page-columns page-full">
<h1>PART 1 Heterogeneous-Treatment-Effect Analysis with <strong>causal forests</strong></h1>
<section id="why-worry-about-heterogeneity" class="level3">
<h3 class="anchored" data-anchor-id="why-worry-about-heterogeneity">Why worry about heterogeneity?</h3>
<p>Relying on the average treatment effect (ATE) is a bit like handing out size-nine shoes to an entire student body: on <em>average</em> they might fit, but watch the tall students hobble and the small ones trip.</p>
<p>Today we will focus on the causal question: ‚ÄúWhat would be the effects on multi-dimensional well-being if everyone spent at least one hour a week socialising with their community?‚Äù</p>
<p>Note that a one-hour boost in weekly community socialising could send some students‚Äô sense of belonging soaring while leaving others desolated. Spotting that spread, measuring how big it really is, and deciding whether it is worth tailoring an exposure to individual ‚Äòshoe sizes‚Äô are the three practical goals of Heterogeneous Treatment Effects analysis.</p>
<hr>
</section>
<section id="start-with-estimating-the-average-treatment-effect-ate" class="level3">
<h3 class="anchored" data-anchor-id="start-with-estimating-the-average-treatment-effect-ate">1 Start with estimating the average treatment effect (ATE)</h3>
<p>Assume the <a href="https://go-bayes.github.io/psych-434-2025/content/05-content.html#how-can-we-make-contrasts-between-counterfactual-potential-outcomes">Three Fundamental Assumptions of Causal Inference here</a> are met. Suppose we wish to estimate the average treatment effect for socialising with one‚Äôs community.</p>
<p>We begin with the most straightforward (and secretly impossible) counterfactual: *run two parallel universes‚Äîone where <strong>everyone</strong> gets the treatment, another where <strong>no-one</strong> does‚Äîand compare the final scores. The resulting difference is the <strong>average treatment effect</strong>:</p>
<p><span class="math display">
\text{ATE}=E\!\bigl[Y(1)-Y(0)\bigr].
</span></p>
<p>This gives us the average response ‚Äì the shoe size‚Ä¶ You‚Äôve seen this before.</p>
<hr>
</section>
<section id="do-effects-differ-across-people" class="level3 page-columns page-full">
<h3 class="anchored" data-anchor-id="do-effects-differ-across-people">2 Do effects differ across people?</h3>
<p>Variation is captured by the <strong>conditional average treatment effect (CATE)</strong>,</p>
<p><span class="math display">
\tau(x)=E\!\bigl[Y(1)-Y(0)\mid X=x\bigr],
</span></p>
<p>where <span class="math inline">X</span> gathers pre-treatment covariates ‚Äì age, baseline wellbeing, personality, whatever we have measured and included in our model. Normally these will be our <em>baseline confounders.</em></p>
<p>If <span class="math inline">\tau(x)</span> turns out to be flat, we say there is no evidence for heterogeneity worth targeting.</p>
<p>People differ in countless, overlapping ways. Think of age, baseline wellbeing, personality traits, study habits, and more.</p>
<p>A linear interaction model tests whether the treatment works differently along one straight dimension, such as gender, by fitting a straight line.</p>
<p>But real‚Äêworld data often twist and turn. If the true relationship bends like a garden hose, a straight line will miss the curve.</p>
<p>Regression forests fix this by letting the data place splits wherever the shape changes, so they can follow any bends that appear <span class="citation" data-cites="wager2018">(<a href="#ref-wager2018" role="doc-biblioref">Wager and Athey 2018</a>)</span>.</p>
<div class="no-row-height column-margin column-container"></div><p>Straight-line models are fine for simple patterns, but regression forests can trace the curves that simple lines overlook.</p>
<p>Causal forests are based on regression forests, where the splitting attempts to maximise differences in causal effect estimates. What this means will soon be clear.</p>
</section>
<section id="from-straight-lines-to-trees" class="level3 page-columns page-full">
<h3 class="anchored" data-anchor-id="from-straight-lines-to-trees">3. From straight lines to trees</h3>
<p>Traditional ‚Äòparametric‚Äô models (like simple regression) guess a single functional shape ‚Äì often a straight line ‚Äì before seeing the data. A <strong>non-parametric</strong> model, by contrast, lets the data decide the shape. A <em>regression tree</em> is the simplest non-parametric learner we will use.</p>
<ol type="1">
<li><strong>Regression tree</strong></li>
</ol>
<p><em>Idea</em>: split the covariate space by asking yes/no questions‚Äî ‚ÄòAge ‚â§ 20?‚Äô, ‚ÄòBaseline wellbeing &gt; 0.3?‚Äô ‚Äî until each terminal <strong>leaf</strong> is fairly homogeneous. Inside a leaf the predicted outcome is just the sample mean, so the tree builds a <em>piece-wise constant</em> surface instead of a global line.<br>
<em>Analogy</em>: think of tiling a garden with stepping-stones: each stone is flat, but taken together they follow the ground‚Äôs contours.</p>
<ol start="2" type="1">
<li><p><strong>Regression forest</strong><br>
A single tree is quick and interpretable but unstable: small changes in the data can move the splits and shift predictions. A <strong>random forest</strong> grows many trees on bootstrap samples and averages their outputs. Averaging cancels much of the noise <span class="citation" data-cites="breiman2001random">(<a href="#ref-breiman2001random" role="doc-biblioref">Breiman 2001</a>)</span>.</p></li>
<li><p><strong>Causal Forests</strong><br>
To estimate treatment effects rather than outcomes, each tree plays a two-step ‚Äòhonest‚Äô game <span class="citation" data-cites="wager2018">(<a href="#ref-wager2018" role="doc-biblioref">Wager and Athey 2018</a>)</span>:</p>
<ul>
<li>use one half of its sample to choose splits that separate treated from control units;<br>
</li>
<li>use the other half to compute treatment-control differences within every leaf.</li>
</ul>
<p>For a new individual with covariates <span class="math inline">x_i</span> each tree supplies a noisy leaf-level effect; the forest reports the <strong>average</strong>, written</p></li>
</ol>
<div class="no-row-height column-margin column-container"><div id="ref-breiman2001random" class="csl-entry" role="listitem">
Breiman, Leo. 2001. <span>‚ÄúRandom Forests.‚Äù</span> <em>Machine Learning</em> 45 (1): 5‚Äì32. <a href="https://doi.org/10.1023/A:1010933404324">https://doi.org/10.1023/A:1010933404324</a>.
</div><div id="ref-wager2018" class="csl-entry" role="listitem">
Wager, Stefan, and Susan Athey. 2018. <span>‚ÄúEstimation and Inference of Heterogeneous Treatment Effects Using Random Forests.‚Äù</span> <em>Journal of the American Statistical Association</em> 113 (523): 1228‚Äì42. <a href="https://doi.org/10.1080/01621459.2017.1319839">https://doi.org/10.1080/01621459.2017.1319839</a>.
</div></div><p><span class="math display">
  \widehat{\tau}(x)=E[Y(1)-Y(0)\mid X=x].
</span></p>
<p>Because the noisy estimates point in many directions, their average is markedly less variable ‚Äì <em>the wisdom of trees is a wisdom of crowds</em>.</p>
<p>Straight‚Äëline models suit simple patterns; regression forests flex to any bends; causal forests add a third dimension ‚Äì variation in treatment responses. We‚Äôll see this in action/</p>
<p>For more about causal forests see (~18mins in‚Ä¶)</p>
<div class="quarto-video ratio ratio-16x9"><iframe data-external="1" src="https://www.youtube.com/embed/YBbnCDRCcAI" title="" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe></div>
<!-- So, a regression tree chops the data into locally flat chunks; a regression forest averages many such trees to smooth away chance idiosyncrasies; a causal forest adds honesty so that its averaged differences, though never directly observable for any one person, give our best data-driven forecast of individual treatment effects. -->
<hr>
</section>
<section id="building-honest-trees-avoiding-over-fitting" class="level3">
<h3 class="anchored" data-anchor-id="building-honest-trees-avoiding-over-fitting">4 Building Honest Trees: Avoiding Over-Fitting</h3>
<p>Sample splitting meanings partitioning your data into training and testing sets. This avoids overfittign the model to observations (remember we seek to estimate parameters for an entire population under two different exposures, at most, only one of which is observed on any individual.) Sample splitting is a feature of estimation in cauasal forests ‚Äì we separate model selection from estimation. Moreover, the forest adds a second safeguard: <strong>out-of-bag (OOB) prediction</strong>. Each <span class="math inline">\widehat{\tau}(x_i)</span> is averaged only over trees that never used <span class="math inline">i</span> in their split phase. Together, honesty and OOB prediction deliver reliable uncertainty estimates even in high-dimensional settings (i.e.&nbsp;settings with <em>many</em> covariates.)</p>
<hr>
</section>
<section id="handling-missing-data" class="level3">
<h3 class="anchored" data-anchor-id="handling-missing-data">5 Handling missing data</h3>
<p>The <code>grf</code> package adopts <strong>Missing Incorporated in Attributes (MIA)</strong> splitting. ‚ÄòMissing‚Äô can itself become a branch, so cases are neither discarded nor randomly imputed. This pragmatic approach keeps all observations in play while preserving the forest‚Äôs interpretability.</p>
<hr>
</section>
<section id="is-the-heterogeneity-actionable-rate-statistics" class="level3 page-columns page-full">
<h3 class="anchored" data-anchor-id="is-the-heterogeneity-actionable-rate-statistics">6 Is the heterogeneity <em>actionable</em>? ‚Äî RATE statistics</h3>
<p>Once we have a personalised score <span class="math inline">\widehat{\tau}(x)</span> for every unit, the practical question is whether <em>targeting</em> high scorers delivers a benefit large enough to justify the extra effort. The tool of choice is the <strong>Targeting-Operator Characteristic (TOC)</strong> curve:</p>
<p><span class="math display">
G(q)=\frac{1}{n}\sum_{i=1}^{\lfloor qn\rfloor}\widehat{\tau}_{(i)}, \qquad 0\le q\le1,
</span></p>
<p>where <span class="math inline">\widehat{\tau}_{(1)}\ge\widehat{\tau}_{(2)}\ge\cdots</span> are the estimated effects sorted from largest to smallest. The horizontal axis <span class="math inline">q</span> is the fraction of the population we would treat; the vertical axis <span class="math inline">G(q)</span> is the cumulative gain we expect from treating that top slice.</p>
<p>Two integrals of the TOC curve summarise how lucrative targeting could be:</p>
<ul>
<li><p><strong>RATE AUTOC</strong> (Area <em>Under</em> the TOC) puts equal weight on every <span class="math inline">q</span>. This answers: <em>If benefits are concentrated among the very best prospects, how much can we harvest by cherry-picking them?</em></p></li>
<li><p><strong>RATE Qini</strong> applies heavier weight to the mid-range of <span class="math inline">q</span>. This is the go-to metric when investigators face a fixed, moderate-sized budget‚Äîsay, ‚Äúwe can afford to treat 40 % of individuals; will targeting help?‚Äù <span class="citation" data-cites="yadlowsky2021evaluating">(<a href="#ref-yadlowsky2021evaluating" role="doc-biblioref">Yadlowsky et al. 2021</a>)</span>. We will evaluate the curve at treatment of 20% and 50% of the population.</p></li>
</ul>
<div class="no-row-height column-margin column-container"><div id="ref-yadlowsky2021evaluating" class="csl-entry" role="listitem">
Yadlowsky, Steve, Scott Fleming, Nigam Shah, Emma Brunskill, and Stefan Wager. 2021. <span>‚ÄúEvaluating Treatment Prioritization Rules via Rank-Weighted Average Treatment Effects.‚Äù</span> <em>arXiv Preprint arXiv:2111.07966</em>. <a href="https://doi.org/10.48550/arXiv.2111.07966">https://doi.org/10.48550/arXiv.2111.07966</a>.
</div></div><p>To quantify the economic or policy value of heterogeneity, rank units by <span class="math inline">\widehat{\tau}(x)</span> and draw a <strong>Targeting-Operator Characteristic (TOC)</strong> curve that plots cumulative gain against the fraction <span class="math inline">q</span> of the population treated.</p>
<hr>
</section>
<section id="rate-autoc-example" class="level3 page-columns page-full">
<h3 class="anchored" data-anchor-id="rate-autoc-example">7 RATE AUTOC EXAMPLE</h3>
<p>Although OOB predictions are ‚Äòout-of-sample‚Äô for individual trees, the full forest still reuses information. A simple remedy when estimating the RATE AUTOC and Qini is to split the data, <strong>training</strong> the forest on one fold and <strong>testing</strong> RATE/Qini on the other. Again, this explicit splitting blocks optimistic bias and yields honest test statistics (such as confidence intervals) <span class="citation" data-cites="grf2024">(<a href="#ref-grf2024" role="doc-biblioref">Tibshirani et al. 2024</a>)</span>.</p>
<div class="no-row-height column-margin column-container"></div><div class="cell page-columns page-full">
<div id="fig-rate-example" class="quarto-float quarto-figure quarto-figure-center anchored page-columns page-full">
<figure class="quarto-float quarto-float-fig figure page-columns page-full">
<div aria-describedby="fig-rate-example-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca" class="page-columns page-full">
<img src="04-causal-forests_files/figure-html/fig-rate-example-1.png" class="img-fluid figure-img column-screen" width="672">
</div>
<figcaption class="quarto-float-caption-margin quarto-float-caption quarto-float-fig" id="fig-rate-example-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;1: RATE AUTOC: Hours Socialising ‚Üí Sense of Meaning
</figcaption>
</figure>
</div>
</div>
<p><a href="#fig-rate-example" class="quarto-xref">Figure&nbsp;1</a> depicts a typical RATE AUTOC curve with sample splitting. A steep initial rise indicates that a small, correctly targeted programme could deliver large gains. Note that the curve begins dipping below zero past about 30% of the sample. At that point we might be doing worse than the ATE by targeting the CATE ‚Äì at least for some.</p>
<div class="page-columns page-full"><p><strong>Remember ‚Äì figuring out who will benefit from a treatment is a difficult statistical problem <span class="citation" data-cites="grf2024">(<a href="#ref-grf2024" role="doc-biblioref">Tibshirani et al. 2024</a>)</span>.</strong></p><div class="no-row-height column-margin column-container"><div id="ref-grf2024" class="csl-entry" role="listitem">
Tibshirani, Julie, Susan Athey, Erik Sverdrup, and Stefan Wager. 2024. <em>Grf: Generalized Random Forests</em>. <a href="https://github.com/grf-labs/grf">https://github.com/grf-labs/grf</a>.
</div></div></div>
<hr>
</section>
<section id="visualising-policy-value-the-qini-curve" class="level3 page-columns page-full">
<h3 class="anchored" data-anchor-id="visualising-policy-value-the-qini-curve">8 Visualising policy value: the Qini curve</h3>
<p>A <strong>Qini curve</strong> displays cumulative benefit on the vertical axis and treatment coverage (% of the population treated) on the horizontal. As with the AUTOC curve we are using a held-out test fold to validate the response curve.</p>
<div class="cell column-screen">
<p>NULL</p>
</div>
<p><strong>?@fig-qini-example</strong>: we find that focussing on the top 20 % of individuals nets a gain of 0.08 units (95 % CI 0.04‚Äì0.12). Widening the net to 50 % bumps the haul to 0.13 units (95 % CI 0.07‚Äì0.19). After that the curve flattens ‚Äì once we‚Äôve treated everyone who offers a decent return, there are no more ‚Äòbig fish‚Äô left to catch.</p>
<hr>
</section>
<section id="from-a-black-box-to-simple-rules-policy-trees" class="level3 page-columns page-full">
<h3 class="anchored" data-anchor-id="from-a-black-box-to-simple-rules-policy-trees">9 From ‚Äòa black box‚Äô to simple rules: policy trees</h3>
<p>The causal forest hands us a personalised CATE for every individual, mapping a <strong>high-dimensional</strong> covariate vector <span class="math inline">X</span> to a number <span class="math inline">\widehat{\tau}(X)</span>. Helpful as that forecast may be, it stops short of telling us <em>what to do</em>: the function itself is too tangled ‚Äî thousands of overlapping splits ‚Äì to translate directly into a policy.</p>
<p>The <strong>policytree</strong> algorithm bridges that gap by collapsing the forest‚Äôs many <span class="math inline">\widehat{\tau}(X)</span> values into a single, shallow decision tree whose depth you choose; each split is chosen to maximise expected benefit <span class="citation" data-cites="policytree_package_2024">(<a href="#ref-policytree_package_2024" role="doc-biblioref">Sverdrup et al. 2024</a>)</span>. In this course we cap the depth at <strong>two</strong> for a practical balance, specifially:</p>
<div class="no-row-height column-margin column-container"><div id="ref-policytree_package_2024" class="csl-entry" role="listitem">
Sverdrup, Erik, Ayush Kanodia, Zhengyuan Zhou, Susan Athey, and Stefan Wager. 2024. <em>Policytree: Policy Learning via Doubly Robust Empirical Welfare Maximization over Trees</em>. <a href="https://CRAN.R-project.org/package=policytree">https://CRAN.R-project.org/package=policytree</a>.
</div></div><ul>
<li>At most three yes/no questions per rule, so the logic fits on a slide you can present to policy-makers</li>
<li>Each leaf still contains enough observations to yield a stable effect estimate;<br>
</li>
<li>Deeper trees increase computational complexity faster than they improve payoffs.</li>
</ul>
<div class="cell page-columns page-full">
<div id="fig-decision-tree" class="quarto-float quarto-figure quarto-figure-center anchored page-columns page-full">
<figure class="quarto-float quarto-float-fig figure page-columns page-full">
<div aria-describedby="fig-decision-tree-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca" class="page-columns page-full">
<img src="04-causal-forests_files/figure-html/fig-decision-tree-1.png" class="img-fluid figure-img column-screen" width="672">
</div>
<figcaption class="quarto-float-caption-margin quarto-float-caption quarto-float-fig" id="fig-decision-tree-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;2: Decision tree for Social Belonging
</figcaption>
</figure>
</div>
</div>
<p><strong>Policy Tree Findings for Effect of Hour Socialising on Social Belonging:</strong></p>
<p>Participants are first split by Self Esteem at -0.925 (original scale: 3.958). For those with Self Esteem <span class="math inline">&lt;=</span> this threshold, the next split is by Neuroticism at 0.642 (original scale: 4.228). Within that subgroup, individuals with Neuroticism <span class="math inline">&lt;=</span> the threshold are recommended <strong>control</strong>, while those with Neuroticism <span class="math inline">&gt;</span> the threshold are recommended <strong>treated</strong>.</p>
<p>For participants with Self Esteem <span class="math inline">&gt;</span> -0.925 (original scale: 3.958), the second split is by Social Belonging at 0.776 (original scale: 5.972). In this subgroup, individuals with Social Belonging <span class="math inline">&lt;=</span> the threshold are recommended <strong>treated</strong>, while those with Social Belonging <span class="math inline">&gt;</span> the threshold are recommended <strong>control</strong>.</p>
<div id="fig-policy-map" class="quarto-float quarto-figure quarto-figure-center anchored page-columns page-full">
<figure class="quarto-float quarto-float-fig figure page-columns page-full">
<div aria-describedby="fig-policy-map-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="04-causal-forests_files/figure-html/fig-policy-map-1.png" class="img-fluid figure-img" width="1536">
</div>
<figcaption class="quarto-float-caption-margin quarto-float-caption quarto-float-fig margin-caption" id="fig-policy-map-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;3: Predicted treatment assignment (predictions out of training sample)
</figcaption>
</figure>
</div>
<hr>
</section>
<section id="ethical-and-practical-considerations" class="level3">
<h3 class="anchored" data-anchor-id="ethical-and-practical-considerations">10 Ethical and practical considerations</h3>
<p>There is no guarantee that statistical optimality will line up with social optimality. A rule that maximises expected health gains might still be <strong>unaffordable</strong> for a public agency, <strong>unfair</strong> to a protected group, or <strong>opaque</strong> to those asked to trust it. We all have our notions of fairness, and we can‚Äôt be expected to ignore them. Moreover, the estimation of CATE is always senstive to which variables we include in our model (see the caveats in <a href="https://go-bayes.github.io/psych-434-2025/content/06-content.html#appendix-b-evidence-for-effect-modification-is-relative-to-inclusion-of-other-variables-in-the-model">Lecture 6</a>).</p>
<p>So, we should not consider CATE an absolute guide to practice. We should be cautious.</p>
<p>Yet the very same CATE machinery that powers targeting also helps science move past a <em>one-size-fits-all</em> mindset. By mapping treatment effects across a high-dimensional covariate space, we can test whether our favourite categories ‚Äì gender, age group, clinical severity ‚Äì actually capture the differences that matter. Sometimes they do; often they don‚Äôt, revealing that nature is not carved at the joints of our folk classifications. Discovering <em>where</em> the forest finds meaningful splits can generate fresh psychological hypotheses about who responds, why, and under what circumstances, even when no policy decision is on the table. Over the next several weeks, we shall return to this point with examples.</p>
<!-- Before deployment we therefore need three extra layers of scrutiny: -->
<!-- 1. **Cost realism**   Will the programme's administrative and opportunity costs erase the forecast benefit?  A cost‚Äìeffectiveness analysis can reveal when a simpler, less 'optimal' rule actually delivers better value.   -->
<!-- 2. **Fairness auditing**  check whether error rates or treatment probabilities differ by gender, ethnicity, or socioeconomic status.  If gaps appear, consider adjusting the loss function or adding fairness constraints [@mitchell2021algorithmic].   -->
<!-- 3. **Transparency and consent**   Publish the rule, document data sources, and secure stakeholder buy-in.  Transparent governance limits the risk of political backlash and encourages external replication. -->
<hr>
</section>
<section id="summarynext-steps" class="level3">
<h3 class="anchored" data-anchor-id="summarynext-steps">Summary/next steps</h3>
<p>Our workflow answers three questions in sequence:</p>
<ol type="1">
<li><strong>Is there substantial heterogeneity?</strong> Reject <span class="math inline">H_0{:}\tau(x)</span> constant if RATE AUTOC or RATE Qini is positive and statistically reliable<br>
</li>
<li><strong>Does targeting pay at realistic budgets?</strong> Inspect the slope of the Qini curve around plausible coverage levels.</li>
<li><strong>Can we express the targeting rule in a few defensible steps?</strong> fit and validate a shallow policy tree.</li>
</ol>
<p>In the lab section you will reproduce each stage on a simulated dataset.</p>
</section>
<section id="appendix" class="level2">
<h2 class="anchored" data-anchor-id="appendix">Appendix</h2>
<!-- ## Subgroup analysis -->
<!-- Redcall, **Effect Modification** (also known as "heterogeneity of treatment effects", and "Effect-measure modification") occurs when the causal effect of intervention $A$ varies across different levels of another variable $R$: -->
<!-- $$E(Y^{a=1}|G=g_1, L=l) - E(Y^{a=0}|G=g_1, L=l) \neq E(Y^{a=1}|G=g_2, L=l) - E(Y^{a=0}|G=g_2, L=l)$$ -->
<!-- Effect modification indicates that the magnitude of the causal effect of intervention $A$ is related to the modifier variable $G$ level. As discussed last week, effect modification can be observed even when there is no direct causal interaction between the treatment and the modifier variable. We noted that **interaction in causal inference refers to a situation where the combined effect of two interventions is not equal to the sum of their individual effects**. **Effect modification, on the other hand, occurs when the causal effect of one intervention varies across different levels of another variable.** -->
<!-- We also noted that  -->
<!-- > **For comparative research, we are typically interested in effect-modification, which requires subgroup analysis.** -->
<section id="causal-estimand-statistical-estimand-statistical-estimator" class="level3">
<h3 class="anchored" data-anchor-id="causal-estimand-statistical-estimand-statistical-estimator">Causal Estimand, Statistical Estimand, Statistical Estimator</h3>
<p>Let‚Äôs set subgroup analysis to the side for a moment and begin focussing on statistical estimation.</p>
<p>Suppose a researcher wants to understand the causal effect of marriage on individual happiness. Participants in the study are surveyed for their marital status (‚Äúmarried‚Äù or ‚Äúnot married‚Äù) and their self-reported happiness on a scale from 1 to 10.</p>
<section id="causal-estimand" class="level4">
<h4 class="anchored" data-anchor-id="causal-estimand">Causal Estimand</h4>
<ul>
<li><p><strong>Definition</strong>: The causal estimand is the specific quantity or parameter that we aim to estimate to understand the causal effect of an intervention or treatment on an outcome.</p></li>
<li><p><strong>Example</strong>: Here, the <strong>Causal Estimand</strong> would be the Average Treatment Effect (ATE) of being married on happiness. Specifically, we define the ATE as the difference in the potential outcomes of happiness if all individuals were married versus if no individuals were married:</p>
<p><span class="math display">
\text{ATE} = E[Y^{a=1} - Y^{a=0}]
</span></p>
<p>Here, <span class="math inline">Y^{a=1}</span> represents the potential happiness score if an individual is married, and <span class="math inline">Y^{a=0}</span> if they are not married.</p></li>
</ul>
</section>
<section id="next-step-are-causal-assumptions-met" class="level4">
<h4 class="anchored" data-anchor-id="next-step-are-causal-assumptions-met">Next step: Are Causal Assumptions Met?</h4>
<ul>
<li><p>Identification (Exchangeability): balance in the confounders across the treatments to be compared</p></li>
<li><p>Consistency: well-defined interventions</p></li>
<li><p>Positivity: treatments occur within levels of covariates <span class="math inline">L</span></p></li>
</ul>
</section>
<section id="statistical-estimand-next-step" class="level4">
<h4 class="anchored" data-anchor-id="statistical-estimand-next-step">Statistical Estimand (next step)</h4>
<ul>
<li><p><strong>The problem</strong>: how do we bridge the gap between potential outcomes and data?</p></li>
<li><p><strong>Definition</strong>: the statistical estimand is the parameter or function that summarises the relationship between variables as described by a statistical model applied to data.</p></li>
<li><p><strong>Example</strong>: for our study, the <strong>Statistical Estimand</strong> might be the mean difference in happiness scores between individuals who are married and those who are not, as derived from a linear regression model:</p>
<p><span class="math display">
\text{Happiness} = \beta_0 + \beta_1 \times \text{Married} + \epsilon
</span></p>
<p>In this equation, <span class="math inline">\beta_1</span> represents the estimated difference in happiness scores between the married and non-married groups.</p></li>
</ul>
</section>
<section id="statistical-estimator" class="level4">
<h4 class="anchored" data-anchor-id="statistical-estimator">Statistical Estimator</h4>
<ul>
<li><p><strong>Definition</strong>: a statistical estimator is a rule or method by which a numerical estimate of a statistical estimand is calculated from the data.</p></li>
<li><p><strong>Example</strong>: in our marriage study, the <strong>Statistical Estimator</strong> for <span class="math inline">\beta_1</span> is the ordinary least squares (OLS) estimator. This estimator is used to calculate <span class="math inline">\beta_1</span> from the sample data provided by the survey. It provides an estimate of the impact of being married on happiness, calculated using: <span class="math display">
\hat{\beta}_1 = \frac{\sum_{i=1}^n (X_i - \bar{X})(Y_i - \bar{Y})}{\sum_{i=1}^n (X_i - \bar{X})^2}
</span> where <span class="math inline">X_i</span> is a binary indicator for being married (1 for married, 0 for not married), <span class="math inline">Y_i</span> is the observed happiness score, and <span class="math inline">\bar{X}</span>, <span class="math inline">\bar{Y}</span> are the sample means of <span class="math inline">X</span> and <span class="math inline">Y</span>, respectively.</p></li>
</ul>
<p>The upshot, we anchor our causal inquiries within a multi-step framework of data analysis. This involves:</p>
<ol type="1">
<li>clearly defining our causal estimand within a specified <em>target population,</em></li>
<li>clarifying assumptions, &amp; especially identification assumptions,</li>
<li>describing a statistical strategy for extracting this estimand from the data, and then</li>
<li>applying an algorithm that embodies this statistical method.</li>
</ol>


<!-- -->


</section>
</section>
</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    // Ensure there is a toggle, if there isn't float one in the top right
    if (window.document.querySelector('.quarto-color-scheme-toggle') === null) {
      const a = window.document.createElement('a');
      a.classList.add('top-right');
      a.classList.add('quarto-color-scheme-toggle');
      a.href = "";
      a.onclick = function() { try { window.quartoToggleColorScheme(); } catch {} return false; };
      const i = window.document.createElement("i");
      i.classList.add('bi');
      a.appendChild(i);
      window.document.body.appendChild(a);
    }
    setColorSchemeToggle(hasAlternateSentinel())
    const icon = "Óßã";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
        const codeEl = trigger.previousElementSibling.cloneNode(true);
        for (const childEl of codeEl.children) {
          if (isCodeAnnotation(childEl)) {
            childEl.remove();
          }
        }
        return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
    const viewSource = window.document.getElementById('quarto-view-source') ||
                       window.document.getElementById('quarto-code-tools-source');
    if (viewSource) {
      const sourceUrl = viewSource.getAttribute("data-quarto-source-url");
      viewSource.addEventListener("click", function(e) {
        if (sourceUrl) {
          // rstudio viewer pane
          if (/\bcapabilities=\b/.test(window.location)) {
            window.open(sourceUrl);
          } else {
            window.location.href = sourceUrl;
          }
        } else {
          const modal = new bootstrap.Modal(document.getElementById('quarto-embedded-source-code-modal'));
          modal.show();
        }
        return false;
      });
    }
    function toggleCodeHandler(show) {
      return function(e) {
        const detailsSrc = window.document.querySelectorAll(".cell > details > .sourceCode");
        for (let i=0; i<detailsSrc.length; i++) {
          const details = detailsSrc[i].parentElement;
          if (show) {
            details.open = true;
          } else {
            details.removeAttribute("open");
          }
        }
        const cellCodeDivs = window.document.querySelectorAll(".cell > .sourceCode");
        const fromCls = show ? "hidden" : "unhidden";
        const toCls = show ? "unhidden" : "hidden";
        for (let i=0; i<cellCodeDivs.length; i++) {
          const codeDiv = cellCodeDivs[i];
          if (codeDiv.classList.contains(fromCls)) {
            codeDiv.classList.remove(fromCls);
            codeDiv.classList.add(toCls);
          } 
        }
        return false;
      }
    }
    const hideAllCode = window.document.getElementById("quarto-hide-all-code");
    if (hideAllCode) {
      hideAllCode.addEventListener("click", toggleCodeHandler(false));
    }
    const showAllCode = window.document.getElementById("quarto-show-all-code");
    if (showAllCode) {
      showAllCode.addEventListener("click", toggleCodeHandler(true));
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp('/' + window.location.host + '/');
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
            // target, if specified
            link.setAttribute("target", "_blank");
            if (link.getAttribute("rel") === null) {
              link.setAttribute("rel", "noopener");
            }
            // default icon
            link.classList.add("external");
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script><div class="modal fade" id="quarto-embedded-source-code-modal" tabindex="-1" aria-labelledby="quarto-embedded-source-code-modal-label" aria-hidden="true"><div class="modal-dialog modal-dialog-scrollable"><div class="modal-content"><div class="modal-header"><h5 class="modal-title" id="quarto-embedded-source-code-modal-label">Source Code</h5><button class="btn-close" data-bs-dismiss="modal"></button></div><div class="modal-body"><div class="">
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb1" data-shortcodes="false"><pre class="sourceCode numberSource markdown number-lines code-with-copy"><code class="sourceCode markdown"><span id="cb1-1"><a href="#cb1-1"></a><span class="co">---</span></span>
<span id="cb1-2"><a href="#cb1-2"></a><span class="an">title:</span><span class="co"> "Estimation of ATE and CATE Using Machine Learning"</span></span>
<span id="cb1-3"><a href="#cb1-3"></a><span class="an">date:</span><span class="co"> "2025-AUG-12"</span></span>
<span id="cb1-4"><a href="#cb1-4"></a><span class="an">format:</span></span>
<span id="cb1-5"><a href="#cb1-5"></a><span class="co">  html:</span></span>
<span id="cb1-6"><a href="#cb1-6"></a><span class="co">    warnings: false</span></span>
<span id="cb1-7"><a href="#cb1-7"></a><span class="co">    error: false</span></span>
<span id="cb1-8"><a href="#cb1-8"></a><span class="co">    messages: false</span></span>
<span id="cb1-9"><a href="#cb1-9"></a><span class="co">    code-overflow: scroll</span></span>
<span id="cb1-10"><a href="#cb1-10"></a><span class="co">    highlight-style: Ayu</span></span>
<span id="cb1-11"><a href="#cb1-11"></a><span class="co">    code-line-numbers: true</span></span>
<span id="cb1-12"><a href="#cb1-12"></a><span class="co">    code-fold: false</span></span>
<span id="cb1-13"><a href="#cb1-13"></a><span class="co">    code-tools:</span></span>
<span id="cb1-14"><a href="#cb1-14"></a><span class="co">      source: true</span></span>
<span id="cb1-15"><a href="#cb1-15"></a><span class="co">      toggle: false</span></span>
<span id="cb1-16"><a href="#cb1-16"></a><span class="an">html-math-method:</span><span class="co"> katex</span></span>
<span id="cb1-17"><a href="#cb1-17"></a><span class="an">reference-location:</span><span class="co"> margin</span></span>
<span id="cb1-18"><a href="#cb1-18"></a><span class="an">citation-location:</span><span class="co"> margin</span></span>
<span id="cb1-19"><a href="#cb1-19"></a><span class="an">cap-location:</span><span class="co"> margin</span></span>
<span id="cb1-20"><a href="#cb1-20"></a><span class="an">code-block-border-left:</span><span class="co"> true</span></span>
<span id="cb1-21"><a href="#cb1-21"></a><span class="an">bibliography:</span><span class="co"> /Users/joseph/GIT/templates/bib/references.bib</span></span>
<span id="cb1-22"><a href="#cb1-22"></a><span class="an">editor_options:</span><span class="co"> </span></span>
<span id="cb1-23"><a href="#cb1-23"></a><span class="co">  chunk_output_type: console</span></span>
<span id="cb1-24"><a href="#cb1-24"></a><span class="co">---</span></span>
<span id="cb1-25"><a href="#cb1-25"></a></span>
<span id="cb1-28"><a href="#cb1-28"></a><span class="in">```{r}</span></span>
<span id="cb1-29"><a href="#cb1-29"></a><span class="co">#| eval: true</span></span>
<span id="cb1-30"><a href="#cb1-30"></a><span class="co">#| include: false</span></span>
<span id="cb1-31"><a href="#cb1-31"></a><span class="co">#| echo: false</span></span>
<span id="cb1-32"><a href="#cb1-32"></a><span class="co"># libraries</span></span>
<span id="cb1-33"><a href="#cb1-33"></a><span class="cf">if</span> (<span class="sc">!</span><span class="fu">require</span>(margot, <span class="at">quietly =</span> <span class="cn">TRUE</span>)) {</span>
<span id="cb1-34"><a href="#cb1-34"></a>  devtools<span class="sc">::</span><span class="fu">install_github</span>(<span class="st">"go-bayes/margot"</span>) <span class="co"># ensure version is at least 1.0.45</span></span>
<span id="cb1-35"><a href="#cb1-35"></a>  <span class="fu">library</span>(<span class="st">"margot"</span>)</span>
<span id="cb1-36"><a href="#cb1-36"></a>}</span>
<span id="cb1-37"><a href="#cb1-37"></a></span>
<span id="cb1-38"><a href="#cb1-38"></a><span class="cf">if</span> (<span class="sc">!</span><span class="fu">require</span>(boilerplate, <span class="at">quietly =</span> <span class="cn">TRUE</span>)) {</span>
<span id="cb1-39"><a href="#cb1-39"></a>  devtools<span class="sc">::</span><span class="fu">install_github</span>(<span class="st">"go-bayes/boilerplate"</span>) <span class="co"># </span></span>
<span id="cb1-40"><a href="#cb1-40"></a>}</span>
<span id="cb1-41"><a href="#cb1-41"></a></span>
<span id="cb1-42"><a href="#cb1-42"></a><span class="fu">library</span>(<span class="st">"tinytex"</span>)</span>
<span id="cb1-43"><a href="#cb1-43"></a><span class="fu">library</span>(extrafont)</span>
<span id="cb1-44"><a href="#cb1-44"></a><span class="fu">loadfonts</span>(<span class="at">device =</span> <span class="st">"win"</span>)</span>
<span id="cb1-45"><a href="#cb1-45"></a><span class="fu">library</span>(margot)</span>
<span id="cb1-46"><a href="#cb1-46"></a><span class="fu">library</span>(here)</span>
<span id="cb1-47"><a href="#cb1-47"></a><span class="co"># library(boilerplate)</span></span>
<span id="cb1-48"><a href="#cb1-48"></a><span class="fu">library</span>(patchwork)</span>
<span id="cb1-49"><a href="#cb1-49"></a><span class="fu">library</span>(kableExtra)</span>
<span id="cb1-50"><a href="#cb1-50"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb1-51"><a href="#cb1-51"></a></span>
<span id="cb1-52"><a href="#cb1-52"></a><span class="co"># set save path</span></span>
<span id="cb1-53"><a href="#cb1-53"></a>push_mods <span class="ot">&lt;-</span> here<span class="sc">::</span><span class="fu">here</span>(<span class="st">'/Users/joseph/v-project\ Dropbox/data/courses/25-psych-434'</span>)</span>
<span id="cb1-54"><a href="#cb1-54"></a></span>
<span id="cb1-55"><a href="#cb1-55"></a><span class="co"># read (large file)</span></span>
<span id="cb1-56"><a href="#cb1-56"></a>models_binary_flipped_all <span class="ot">&lt;-</span> margot<span class="sc">::</span><span class="fu">here_read_qs</span>(<span class="st">"models_binary_flipped_all"</span>, push_mods)</span>
<span id="cb1-57"><a href="#cb1-57"></a></span>
<span id="cb1-58"><a href="#cb1-58"></a><span class="co"># models_binary_flipped_all &lt;- here_read_qs("models_binary_flipped_all", here::here("data"))</span></span>
<span id="cb1-59"><a href="#cb1-59"></a></span>
<span id="cb1-60"><a href="#cb1-60"></a><span class="co"># names</span></span>
<span id="cb1-61"><a href="#cb1-61"></a>flipped_names <span class="ot">&lt;-</span> <span class="fu">here_read</span>(<span class="st">"flipped_names"</span>, push_mods)</span>
<span id="cb1-62"><a href="#cb1-62"></a></span>
<span id="cb1-63"><a href="#cb1-63"></a><span class="co"># read labels</span></span>
<span id="cb1-64"><a href="#cb1-64"></a>label_mapping_all <span class="ot">&lt;-</span> <span class="fu">here_read</span>(<span class="st">"label_mapping_all"</span>)</span>
<span id="cb1-65"><a href="#cb1-65"></a></span>
<span id="cb1-66"><a href="#cb1-66"></a><span class="co"># set boilerplate path (set to your own machine)</span></span>
<span id="cb1-67"><a href="#cb1-67"></a><span class="co"># master_path &lt;- "/Users/joseph/GIT/templates/boilerplate_data"</span></span>
<span id="cb1-68"><a href="#cb1-68"></a></span>
<span id="cb1-69"><a href="#cb1-69"></a><span class="co"># set directory database path</span></span>
<span id="cb1-70"><a href="#cb1-70"></a>here_data_path <span class="ot">=</span> here<span class="sc">::</span><span class="fu">here</span>(<span class="st">"data"</span>)</span>
<span id="cb1-71"><a href="#cb1-71"></a></span>
<span id="cb1-72"><a href="#cb1-72"></a><span class="co"># data</span></span>
<span id="cb1-73"><a href="#cb1-73"></a>original_df <span class="ot">&lt;-</span> margot<span class="sc">::</span><span class="fu">here_read</span>(<span class="st">"df_wide"</span>, push_mods)</span>
<span id="cb1-74"><a href="#cb1-74"></a></span>
<span id="cb1-75"><a href="#cb1-75"></a><span class="co"># # import</span></span>
<span id="cb1-76"><a href="#cb1-76"></a><span class="co"># master_unified_db &lt;- boilerplate_import(data_path = master_path)</span></span>
<span id="cb1-77"><a href="#cb1-77"></a></span>
<span id="cb1-78"><a href="#cb1-78"></a><span class="co"># boilerplate_save(master_unified_db, output_file = "unified_db", data_path  = here_data_path, create_backup = FALSE)</span></span>
<span id="cb1-79"><a href="#cb1-79"></a></span>
<span id="cb1-80"><a href="#cb1-80"></a><span class="co"># unified_db &lt;- boilerplate_import(data_path = here_data_path)</span></span>
<span id="cb1-81"><a href="#cb1-81"></a></span>
<span id="cb1-82"><a href="#cb1-82"></a><span class="co"># cat(unified_db$appendix$explain$grf)</span></span>
<span id="cb1-83"><a href="#cb1-83"></a><span class="co"># set model defaults -----------------------------------------------------</span></span>
<span id="cb1-84"><a href="#cb1-84"></a>grf_defaults <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="at">seed =</span> <span class="dv">123</span>,</span>
<span id="cb1-85"><a href="#cb1-85"></a>                     <span class="co"># reproduce results</span></span>
<span id="cb1-86"><a href="#cb1-86"></a>                     <span class="at">stabilize.splits =</span> <span class="cn">TRUE</span>,</span>
<span id="cb1-87"><a href="#cb1-87"></a>                     <span class="at">num.trees =</span> <span class="dv">2000</span> )</span>
<span id="cb1-88"><a href="#cb1-88"></a>                     </span>
<span id="cb1-89"><a href="#cb1-89"></a></span>
<span id="cb1-90"><a href="#cb1-90"></a><span class="co"># set defaults for graphs (see bottom of script for options)</span></span>
<span id="cb1-91"><a href="#cb1-91"></a>decision_tree_defaults <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="at">span_ratio =</span> .<span class="dv">3</span>,</span>
<span id="cb1-92"><a href="#cb1-92"></a>                               <span class="at">text_size =</span> <span class="fl">3.8</span>,</span>
<span id="cb1-93"><a href="#cb1-93"></a>                               <span class="at">y_padding =</span> <span class="fl">0.25</span>)  </span>
<span id="cb1-94"><a href="#cb1-94"></a></span>
<span id="cb1-95"><a href="#cb1-95"></a><span class="co"># set defaults for graphs (see bottom of script for options)</span></span>
<span id="cb1-96"><a href="#cb1-96"></a><span class="co"># set policy tree defaults</span></span>
<span id="cb1-97"><a href="#cb1-97"></a>policy_tree_defaults <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb1-98"><a href="#cb1-98"></a>  <span class="at">point_alpha =</span> .<span class="dv">5</span>,</span>
<span id="cb1-99"><a href="#cb1-99"></a>  <span class="at">title_size =</span> <span class="dv">12</span>,</span>
<span id="cb1-100"><a href="#cb1-100"></a>  <span class="at">subtitle_size =</span> <span class="dv">14</span>,</span>
<span id="cb1-101"><a href="#cb1-101"></a>  <span class="at">axis_title_size =</span> <span class="dv">14</span>,</span>
<span id="cb1-102"><a href="#cb1-102"></a>  <span class="at">legend_title_size =</span> <span class="dv">14</span>,</span>
<span id="cb1-103"><a href="#cb1-103"></a>  <span class="at">split_line_color =</span> <span class="st">"red"</span>,</span>
<span id="cb1-104"><a href="#cb1-104"></a>  <span class="at">split_line_alpha =</span> <span class="fl">0.8</span>,</span>
<span id="cb1-105"><a href="#cb1-105"></a>  <span class="at">split_label_color =</span> <span class="st">"red"</span></span>
<span id="cb1-106"><a href="#cb1-106"></a>)</span>
<span id="cb1-107"><a href="#cb1-107"></a></span>
<span id="cb1-108"><a href="#cb1-108"></a><span class="co"># rate table</span></span>
<span id="cb1-109"><a href="#cb1-109"></a>rate_table_all <span class="ot">&lt;-</span> <span class="fu">margot_rate</span>(</span>
<span id="cb1-110"><a href="#cb1-110"></a>  models_binary_flipped_all, </span>
<span id="cb1-111"><a href="#cb1-111"></a>  <span class="at">label_mapping =</span> label_mapping_all, </span>
<span id="cb1-112"><a href="#cb1-112"></a>  <span class="at">highlight_significant =</span> <span class="cn">TRUE</span></span>
<span id="cb1-113"><a href="#cb1-113"></a>)</span>
<span id="cb1-114"><a href="#cb1-114"></a></span>
<span id="cb1-115"><a href="#cb1-115"></a><span class="co"># view</span></span>
<span id="cb1-116"><a href="#cb1-116"></a><span class="co"># rate_table_all$rate_autoc |&gt; kbl("markdown")</span></span>
<span id="cb1-117"><a href="#cb1-117"></a><span class="co"># rate_table_all$rate_qini |&gt; kbl("markdown")</span></span>
<span id="cb1-118"><a href="#cb1-118"></a></span>
<span id="cb1-119"><a href="#cb1-119"></a><span class="co"># generate interpretation</span></span>
<span id="cb1-120"><a href="#cb1-120"></a>rate_interpretation_all <span class="ot">&lt;-</span> <span class="fu">margot_interpret_rate</span>(</span>
<span id="cb1-121"><a href="#cb1-121"></a>  rate_table_all, </span>
<span id="cb1-122"><a href="#cb1-122"></a>  <span class="at">flipped_outcomes =</span> flipped_names</span>
<span id="cb1-123"><a href="#cb1-123"></a>)</span>
<span id="cb1-124"><a href="#cb1-124"></a></span>
<span id="cb1-125"><a href="#cb1-125"></a><span class="co"># view interpretations</span></span>
<span id="cb1-126"><a href="#cb1-126"></a><span class="fu">cat</span>(rate_interpretation_all<span class="sc">$</span>autoc_results)</span>
<span id="cb1-127"><a href="#cb1-127"></a><span class="fu">cat</span>(rate_interpretation_all<span class="sc">$</span>qini_results)</span>
<span id="cb1-128"><a href="#cb1-128"></a><span class="fu">cat</span>(rate_interpretation_all<span class="sc">$</span>comparison)</span>
<span id="cb1-129"><a href="#cb1-129"></a></span>
<span id="cb1-130"><a href="#cb1-130"></a><span class="co"># # check out model names</span></span>
<span id="cb1-131"><a href="#cb1-131"></a><span class="co"># rate_interpretation_all$either_model_names</span></span>
<span id="cb1-132"><a href="#cb1-132"></a><span class="co"># rate_interpretation_all$qini_model_names</span></span>
<span id="cb1-133"><a href="#cb1-133"></a><span class="co"># rate_interpretation_all$both_model_names</span></span>
<span id="cb1-134"><a href="#cb1-134"></a><span class="co"># rate_interpretation_all$autoc_model_names</span></span>
<span id="cb1-135"><a href="#cb1-135"></a></span>
<span id="cb1-136"><a href="#cb1-136"></a><span class="co"># define autoc model names for batch processing</span></span>
<span id="cb1-137"><a href="#cb1-137"></a><span class="co"># autoc plots ------------------------------------------------------------</span></span>
<span id="cb1-138"><a href="#cb1-138"></a><span class="co"># generate batch rate plots</span></span>
<span id="cb1-139"><a href="#cb1-139"></a>batch_rate_autoc_plots <span class="ot">&lt;-</span> <span class="fu">margot_plot_rate_batch</span>(</span>
<span id="cb1-140"><a href="#cb1-140"></a>  models_binary_flipped_all, </span>
<span id="cb1-141"><a href="#cb1-141"></a>  <span class="co"># just use rate autoc</span></span>
<span id="cb1-142"><a href="#cb1-142"></a>  <span class="at">model_names =</span> rate_interpretation_all<span class="sc">$</span>autoc_model_names  </span>
<span id="cb1-143"><a href="#cb1-143"></a>)</span>
<span id="cb1-144"><a href="#cb1-144"></a></span>
<span id="cb1-145"><a href="#cb1-145"></a><span class="co"># batch_rate_autoc_plots$model_t2_hlth_fatigue_z</span></span>
<span id="cb1-146"><a href="#cb1-146"></a><span class="co"># view selected autoc plots</span></span>
<span id="cb1-147"><a href="#cb1-147"></a><span class="co"># batch_rate_autoc_plots$model_t2_log_hours_exercise_z</span></span>
<span id="cb1-148"><a href="#cb1-148"></a><span class="co"># batch_rate_autoc_plots$model_t2_hlth_fatigue_z</span></span>
<span id="cb1-149"><a href="#cb1-149"></a><span class="co"># batch_rate_autoc_plots$model_t2_self_control_z</span></span>
<span id="cb1-150"><a href="#cb1-150"></a></span>
<span id="cb1-151"><a href="#cb1-151"></a><span class="co"># QINI --------------------------------------------------------------------</span></span>
<span id="cb1-152"><a href="#cb1-152"></a><span class="co"># batch process heterogeneity results for qini</span></span>
<span id="cb1-153"><a href="#cb1-153"></a>models_binary_batch_qini <span class="ot">&lt;-</span> margot<span class="sc">::</span><span class="fu">margot_policy</span>(</span>
<span id="cb1-154"><a href="#cb1-154"></a>  models_binary_flipped_all,</span>
<span id="cb1-155"><a href="#cb1-155"></a>  <span class="at">decision_tree_args =</span> decision_tree_defaults,</span>
<span id="cb1-156"><a href="#cb1-156"></a>  <span class="at">policy_tree_args =</span> policy_tree_defaults,</span>
<span id="cb1-157"><a href="#cb1-157"></a>  <span class="at">model_names =</span> rate_interpretation_all<span class="sc">$</span>qini_model_names,</span>
<span id="cb1-158"><a href="#cb1-158"></a>  <span class="at">original_df =</span> original_df,</span>
<span id="cb1-159"><a href="#cb1-159"></a>  <span class="at">label_mapping =</span> label_mapping_all</span>
<span id="cb1-160"><a href="#cb1-160"></a>)</span>
<span id="cb1-161"><a href="#cb1-161"></a></span>
<span id="cb1-162"><a href="#cb1-162"></a><span class="co"># view models</span></span>
<span id="cb1-163"><a href="#cb1-163"></a><span class="co"># first make graphs</span></span>
<span id="cb1-164"><a href="#cb1-164"></a>plot_qini_exercise <span class="ot">&lt;-</span>models_binary_batch_qini<span class="sc">$</span>model_t2_log_hours_exercise_z<span class="sc">$</span>qini_plot</span>
<span id="cb1-165"><a href="#cb1-165"></a>plot_qini_fatigue <span class="ot">&lt;-</span> models_binary_batch_qini<span class="sc">$</span>model_t2_hlth_fatigue_z<span class="sc">$</span>qini_plot</span>
<span id="cb1-166"><a href="#cb1-166"></a>plot_qini_bodysat <span class="ot">&lt;-</span> models_binary_batch_qini<span class="sc">$</span>model_t2_bodysat_z<span class="sc">$</span>qini_plot</span>
<span id="cb1-167"><a href="#cb1-167"></a>plot_qini_self_control <span class="ot">&lt;-</span> models_binary_batch_qini<span class="sc">$</span>model_t2_self_control_z<span class="sc">$</span>qini_plot</span>
<span id="cb1-168"><a href="#cb1-168"></a>plot_qini_self_esteem <span class="ot">&lt;-</span> models_binary_batch_qini<span class="sc">$</span>model_t2_self_esteem_z<span class="sc">$</span>qini_plot</span>
<span id="cb1-169"><a href="#cb1-169"></a>plot_qini_belong <span class="ot">&lt;-</span> models_binary_batch_qini<span class="sc">$</span>model_t2_belong_z<span class="sc">$</span>qini_plot</span>
<span id="cb1-170"><a href="#cb1-170"></a></span>
<span id="cb1-171"><a href="#cb1-171"></a><span class="co"># recall the ate</span></span>
<span id="cb1-172"><a href="#cb1-172"></a><span class="co"># plot_all_models$plot</span></span>
<span id="cb1-173"><a href="#cb1-173"></a></span>
<span id="cb1-174"><a href="#cb1-174"></a><span class="co"># patchwork allows us to group graphs together</span></span>
<span id="cb1-175"><a href="#cb1-175"></a></span>
<span id="cb1-176"><a href="#cb1-176"></a><span class="co"># view plots</span></span>
<span id="cb1-177"><a href="#cb1-177"></a><span class="co"># (plot_qini_exercise / plot_qini_fatigue / plot_qini_bodysat) </span></span>
<span id="cb1-178"><a href="#cb1-178"></a><span class="co"># </span></span>
<span id="cb1-179"><a href="#cb1-179"></a><span class="co"># (plot_qini_self_control /plot_qini_self_esteem / plot_qini_t2_belong)</span></span>
<span id="cb1-180"><a href="#cb1-180"></a><span class="co"># (plot_qini_exercise / plot_qini_fatigue / plot_qini_bodysat) </span></span>
<span id="cb1-181"><a href="#cb1-181"></a></span>
<span id="cb1-182"><a href="#cb1-182"></a><span class="co"># (plot_qini_self_control /plot_qini_self_esteem / plot_qini_t2_belong)</span></span>
<span id="cb1-183"><a href="#cb1-183"></a></span>
<span id="cb1-184"><a href="#cb1-184"></a><span class="co"># extract plots for models without reliable heterogeneity</span></span>
<span id="cb1-185"><a href="#cb1-185"></a></span>
<span id="cb1-186"><a href="#cb1-186"></a><span class="co"># interpret qini curves</span></span>
<span id="cb1-187"><a href="#cb1-187"></a>interpretation_qini_curves <span class="ot">&lt;-</span> margot<span class="sc">::</span><span class="fu">margot_interpret_qini</span>(</span>
<span id="cb1-188"><a href="#cb1-188"></a>  models_binary_batch_qini,</span>
<span id="cb1-189"><a href="#cb1-189"></a>  <span class="at">model_names =</span> rate_interpretation_all<span class="sc">$</span>qini_model_names,</span>
<span id="cb1-190"><a href="#cb1-190"></a>  <span class="at">label_mapping =</span> label_mapping_all</span>
<span id="cb1-191"><a href="#cb1-191"></a>)</span>
<span id="cb1-192"><a href="#cb1-192"></a></span>
<span id="cb1-193"><a href="#cb1-193"></a><span class="co"># view qini interpretation</span></span>
<span id="cb1-194"><a href="#cb1-194"></a><span class="fu">cat</span>(interpretation_qini_curves<span class="sc">$</span>qini_explanation)</span>
<span id="cb1-195"><a href="#cb1-195"></a></span>
<span id="cb1-196"><a href="#cb1-196"></a><span class="co"># view summary table</span></span>
<span id="cb1-197"><a href="#cb1-197"></a>interpretation_qini_curves<span class="sc">$</span>summary_table <span class="sc">|&gt;</span> <span class="fu">kbl</span>(<span class="st">"markdown"</span>)</span>
<span id="cb1-198"><a href="#cb1-198"></a></span>
<span id="cb1-199"><a href="#cb1-199"></a><span class="co"># others</span></span>
<span id="cb1-200"><a href="#cb1-200"></a><span class="co"># combine qini plots</span></span>
<span id="cb1-201"><a href="#cb1-201"></a><span class="co"># qini_plots_combined &lt;- </span></span>
<span id="cb1-202"><a href="#cb1-202"></a><span class="co">#   (plot_qini_exercise + plot_qini_fatigue +  plot_qini_bodysat) / (plot_qini_self_control + plot_qini_self_esteem + plot_qini_t2_belong) + </span></span>
<span id="cb1-203"><a href="#cb1-203"></a><span class="co">#   plot_annotation(</span></span>
<span id="cb1-204"><a href="#cb1-204"></a><span class="co">#     title = "Qini Plots: Reliable Priority 'Spending' at Fractional Budgets",</span></span>
<span id="cb1-205"><a href="#cb1-205"></a><span class="co">#     tag_levels = "A",</span></span>
<span id="cb1-206"><a href="#cb1-206"></a><span class="co">#     theme = theme(legend.position = "top")</span></span>
<span id="cb1-207"><a href="#cb1-207"></a><span class="co">#   ) +</span></span>
<span id="cb1-208"><a href="#cb1-208"></a><span class="co">#   plot_layout(guides = "collect")</span></span>
<span id="cb1-209"><a href="#cb1-209"></a><span class="co"># </span></span>
<span id="cb1-210"><a href="#cb1-210"></a><span class="co"># # view combined qini plots</span></span>
<span id="cb1-211"><a href="#cb1-211"></a><span class="co"># qini_plots_combined</span></span>
<span id="cb1-212"><a href="#cb1-212"></a></span>
<span id="cb1-213"><a href="#cb1-213"></a><span class="co"># again compare with ate</span></span>
<span id="cb1-214"><a href="#cb1-214"></a><span class="co"># plot_all_models$plot </span></span>
<span id="cb1-215"><a href="#cb1-215"></a></span>
<span id="cb1-216"><a href="#cb1-216"></a></span>
<span id="cb1-217"><a href="#cb1-217"></a><span class="co"># policy tree analysis ---------------------------------------------------</span></span>
<span id="cb1-218"><a href="#cb1-218"></a><span class="co"># model_names_subset &lt;- c(</span></span>
<span id="cb1-219"><a href="#cb1-219"></a><span class="co">#   "model_t2_log_hours_exercise_z",</span></span>
<span id="cb1-220"><a href="#cb1-220"></a><span class="co">#   "model_t2_self_control_z", </span></span>
<span id="cb1-221"><a href="#cb1-221"></a><span class="co">#   "model_t2_sexual_satisfaction_z",</span></span>
<span id="cb1-222"><a href="#cb1-222"></a><span class="co">#   "model_t2_belong_z",</span></span>
<span id="cb1-223"><a href="#cb1-223"></a><span class="co">#   "model_t2_support_z"</span></span>
<span id="cb1-224"><a href="#cb1-224"></a><span class="co"># )</span></span>
<span id="cb1-225"><a href="#cb1-225"></a></span>
<span id="cb1-226"><a href="#cb1-226"></a></span>
<span id="cb1-227"><a href="#cb1-227"></a>plots_policy_trees <span class="ot">&lt;-</span> margot<span class="sc">::</span><span class="fu">margot_policy</span>(</span>
<span id="cb1-228"><a href="#cb1-228"></a>  models_binary_flipped_all,</span>
<span id="cb1-229"><a href="#cb1-229"></a>  <span class="at">decision_tree_args =</span> decision_tree_defaults,</span>
<span id="cb1-230"><a href="#cb1-230"></a>  <span class="at">policy_tree_args =</span> policy_tree_defaults,</span>
<span id="cb1-231"><a href="#cb1-231"></a>  <span class="at">model_names =</span> rate_interpretation_all<span class="sc">$</span>either_model_names, <span class="co"># defined above</span></span>
<span id="cb1-232"><a href="#cb1-232"></a>  <span class="at">original_df =</span> original_df,</span>
<span id="cb1-233"><a href="#cb1-233"></a>  <span class="at">label_mapping =</span> label_mapping_all</span>
<span id="cb1-234"><a href="#cb1-234"></a>)</span>
<span id="cb1-235"><a href="#cb1-235"></a></span>
<span id="cb1-236"><a href="#cb1-236"></a><span class="co"># generate policy tree interpretations</span></span>
<span id="cb1-237"><a href="#cb1-237"></a>interpretation_policy_trees <span class="ot">&lt;-</span> margot<span class="sc">::</span><span class="fu">margot_interpret_policy_batch</span>(</span>
<span id="cb1-238"><a href="#cb1-238"></a>  models_binary_flipped_all,</span>
<span id="cb1-239"><a href="#cb1-239"></a>  <span class="co"># use eithre model</span></span>
<span id="cb1-240"><a href="#cb1-240"></a>  <span class="at">model_names =</span> rate_interpretation_all<span class="sc">$</span>either_model_names, <span class="co"># defined above</span></span>
<span id="cb1-241"><a href="#cb1-241"></a>  <span class="at">train_proportion =</span> <span class="fl">0.8</span>,</span>
<span id="cb1-242"><a href="#cb1-242"></a>  <span class="at">original_df =</span> original_df,</span>
<span id="cb1-243"><a href="#cb1-243"></a>  <span class="at">label_mapping =</span> label_mapping_all</span>
<span id="cb1-244"><a href="#cb1-244"></a>)</span>
<span id="cb1-245"><a href="#cb1-245"></a></span>
<span id="cb1-246"><a href="#cb1-246"></a><span class="co"># this will give you results</span></span>
<span id="cb1-247"><a href="#cb1-247"></a><span class="co"># cat(interpretation_policy_trees)</span></span>
<span id="cb1-248"><a href="#cb1-248"></a></span>
<span id="cb1-249"><a href="#cb1-249"></a><span class="co"># # plots</span></span>
<span id="cb1-250"><a href="#cb1-250"></a><span class="co"># plots_policy_trees$model_t2_log_hours_exercise_z$decision_tree</span></span>
<span id="cb1-251"><a href="#cb1-251"></a><span class="co"># plots_policy_trees$model_t2_log_hours_exercise_z$policy_tree</span></span>
<span id="cb1-252"><a href="#cb1-252"></a><span class="co"># plots_policy_trees$model_t2_log_hours_exercise_z$combined_plot</span></span>
<span id="cb1-253"><a href="#cb1-253"></a><span class="co"># # </span></span>
<span id="cb1-254"><a href="#cb1-254"></a><span class="co"># plots_policy_trees$model_t2_hlth_fatigue_z$decision_tree</span></span>
<span id="cb1-255"><a href="#cb1-255"></a><span class="co"># plots_policy_trees$model_t2_hlth_fatigue_z$policy_tree</span></span>
<span id="cb1-256"><a href="#cb1-256"></a><span class="co"># plots_policy_trees$model_t2_hlth_fatigue_z$combined_plot</span></span>
<span id="cb1-257"><a href="#cb1-257"></a><span class="co"># # </span></span>
<span id="cb1-258"><a href="#cb1-258"></a><span class="co"># plots_policy_trees$model_t2_self_control_z$decision_tree</span></span>
<span id="cb1-259"><a href="#cb1-259"></a><span class="co"># plots_policy_trees$model_t2_self_control_z$policy_tree</span></span>
<span id="cb1-260"><a href="#cb1-260"></a><span class="co"># plots_policy_trees$model_t2_self_control_z$combined_plot</span></span>
<span id="cb1-261"><a href="#cb1-261"></a></span>
<span id="cb1-262"><a href="#cb1-262"></a><span class="co"># plots_policy_trees$model_t2_meaning_sense_z$decision_tree</span></span>
<span id="cb1-263"><a href="#cb1-263"></a><span class="co"># plots_policy_trees$model_t2_meaning_sense_z$policy_tree</span></span>
<span id="cb1-264"><a href="#cb1-264"></a><span class="co"># plots_policy_trees$model_t2_meaning_sense_z$combined_plot</span></span>
<span id="cb1-265"><a href="#cb1-265"></a><span class="co"># </span></span>
<span id="cb1-266"><a href="#cb1-266"></a><span class="co"># plots_policy_trees$model_t2_bodysat_z$decision_tree</span></span>
<span id="cb1-267"><a href="#cb1-267"></a><span class="co"># plots_policy_trees$model_t2_bodysat_z$policy_tree</span></span>
<span id="cb1-268"><a href="#cb1-268"></a><span class="co"># plots_policy_trees$model_t2_bodysat_z$combined_plot</span></span>
<span id="cb1-269"><a href="#cb1-269"></a><span class="co"># # </span></span>
<span id="cb1-270"><a href="#cb1-270"></a><span class="co"># </span></span>
<span id="cb1-271"><a href="#cb1-271"></a><span class="co"># plots_policy_trees$model_t2_self_esteem_z$decision_tree</span></span>
<span id="cb1-272"><a href="#cb1-272"></a><span class="co"># plots_policy_trees$model_t2_self_esteem_z$policy_tree</span></span>
<span id="cb1-273"><a href="#cb1-273"></a><span class="co"># plots_policy_trees$model_t2_self_esteem_z$combined_plot</span></span>
<span id="cb1-274"><a href="#cb1-274"></a></span>
<span id="cb1-275"><a href="#cb1-275"></a><span class="co"># plots_policy_trees$model_t2_belong_z$decision_tree</span></span>
<span id="cb1-276"><a href="#cb1-276"></a><span class="co"># plots_policy_trees$model_t2_belong_z$policy_tree</span></span>
<span id="cb1-277"><a href="#cb1-277"></a><span class="co"># plots_policy_trees$model_t2_belong_z$combined_plot</span></span>
<span id="cb1-278"><a href="#cb1-278"></a></span>
<span id="cb1-279"><a href="#cb1-279"></a><span class="co"># batch_rate_autoc_plots$model_t2_meaning_sense_z</span></span>
<span id="cb1-280"><a href="#cb1-280"></a><span class="co"># models_binary_batch_qini$model_t2_belong_z$qini_plot</span></span>
<span id="cb1-281"><a href="#cb1-281"></a></span>
<span id="cb1-282"><a href="#cb1-282"></a><span class="in">```</span></span>
<span id="cb1-283"><a href="#cb1-283"></a></span>
<span id="cb1-284"><a href="#cb1-284"></a></span>
<span id="cb1-285"><a href="#cb1-285"></a>::: {.callout-note}</span>
<span id="cb1-286"><a href="#cb1-286"></a>**Key Readings**</span>
<span id="cb1-287"><a href="#cb1-287"></a><span class="ss">- </span><span class="co">[</span><span class="ot">https://grf-labs.github.io/grf/</span><span class="co">](https://grf-labs.github.io/grf/)</span></span>
<span id="cb1-288"><a href="#cb1-288"></a></span>
<span id="cb1-289"><a href="#cb1-289"></a></span>
<span id="cb1-290"><a href="#cb1-290"></a></span>
<span id="cb1-291"><a href="#cb1-291"></a>**Optional**</span>
<span id="cb1-292"><a href="#cb1-292"></a><span class="ss">- </span><span class="co">[</span><span class="ot">@vanderweele2020</span><span class="co">] [link]</span>(https://www.dropbox.com/scl/fi/srpynr0dvjcndveplcydn/OutcomeWide_StatisticalScience.pdf?rlkey=h4fv32oyjegdfl3jq9u1fifc3&amp;dl=0)</span>
<span id="cb1-293"><a href="#cb1-293"></a><span class="ss">- </span><span class="co">[</span><span class="ot">@suzuki2020</span><span class="co">] [link]</span>(https://www.dropbox.com/scl/fi/4midxwr9ltg9oce02e0ss/suzuki-causal-diagrams.pdf?rlkey=uktzf3nurtgpbj8m4h0xz82dn&amp;dl=0)</span>
<span id="cb1-294"><a href="#cb1-294"></a><span class="ss">- </span><span class="co">[</span><span class="ot">@Bulbulia2024PracticalGuide</span><span class="co">] [link]</span>(https://osf.io/preprints/psyarxiv/uyg3d)</span>
<span id="cb1-295"><a href="#cb1-295"></a><span class="ss">- </span><span class="co">[</span><span class="ot">@hoffman2023</span><span class="co">] [link]</span>(https://arxiv.org/pdf/2304.09460.pdf)</span>
<span id="cb1-296"><a href="#cb1-296"></a>:::</span>
<span id="cb1-297"><a href="#cb1-297"></a></span>
<span id="cb1-298"><a href="#cb1-298"></a></span>
<span id="cb1-299"><a href="#cb1-299"></a>::: {.callout-important}</span>
<span id="cb1-300"><a href="#cb1-300"></a><span class="fu">### Key concepts  </span></span>
<span id="cb1-301"><a href="#cb1-301"></a></span>
<span id="cb1-302"><a href="#cb1-302"></a>The workflow below introduces **heterogeneous-treatment-effect (HTE) analysis** with *causal forests*. By the end of the seminar you should understand six technical ideas:</span>
<span id="cb1-303"><a href="#cb1-303"></a>(1) ATE </span>
<span id="cb1-304"><a href="#cb1-304"></a>(2) CATE</span>
<span id="cb1-305"><a href="#cb1-305"></a>(3) The estimator $\widehat{\tau}(x)$, (lecture 6)</span>
<span id="cb1-306"><a href="#cb1-306"></a>(4) the RATE statistics drawn from a **Targeting-Operator Characteristic** (TOC) curve (new)</span>
<span id="cb1-307"><a href="#cb1-307"></a>(5) Qini Curves (new)</span>
<span id="cb1-308"><a href="#cb1-308"></a>(6) **policy trees**‚Äîand know how each fits into an applied research pipelin (new)</span>
<span id="cb1-309"><a href="#cb1-309"></a>:::</span>
<span id="cb1-310"><a href="#cb1-310"></a></span>
<span id="cb1-311"><a href="#cb1-311"></a></span>
<span id="cb1-312"><a href="#cb1-312"></a><span class="fu"># PART 1 Heterogeneous-Treatment-Effect Analysis with **causal forests**</span></span>
<span id="cb1-313"><a href="#cb1-313"></a></span>
<span id="cb1-314"><a href="#cb1-314"></a><span class="fu">### Why worry about heterogeneity?  </span></span>
<span id="cb1-315"><a href="#cb1-315"></a></span>
<span id="cb1-316"><a href="#cb1-316"></a>Relying on the average treatment effect (ATE) is a bit like handing out size-nine shoes to an entire student body: on *average* they might fit, but watch the tall students hobble and the small ones trip.  </span>
<span id="cb1-317"><a href="#cb1-317"></a></span>
<span id="cb1-318"><a href="#cb1-318"></a>Today we will focus on the causal question: "What would be the effects on multi-dimensional well-being if everyone spent at least one hour a week socialising with their community?"</span>
<span id="cb1-319"><a href="#cb1-319"></a></span>
<span id="cb1-320"><a href="#cb1-320"></a>Note that a one-hour boost in weekly community socialising could send some students' sense of belonging soaring while leaving others desolated.  Spotting that spread, measuring how big it really is, and deciding whether it is worth tailoring an exposure to individual 'shoe sizes' are the three practical goals of Heterogeneous Treatment Effects analysis.</span>
<span id="cb1-321"><a href="#cb1-321"></a></span>
<span id="cb1-322"><a href="#cb1-322"></a></span>
<span id="cb1-323"><a href="#cb1-323"></a>---</span>
<span id="cb1-324"><a href="#cb1-324"></a></span>
<span id="cb1-325"><a href="#cb1-325"></a><span class="fu">### 1 Start with estimating the average treatment effect (ATE)  </span></span>
<span id="cb1-326"><a href="#cb1-326"></a></span>
<span id="cb1-327"><a href="#cb1-327"></a>Assume the <span class="co">[</span><span class="ot">Three Fundamental Assumptions of Causal Inference here</span><span class="co">](https://go-bayes.github.io/psych-434-2025/content/05-content.html#how-can-we-make-contrasts-between-counterfactual-potential-outcomes)</span> are met. Suppose we wish to estimate the average treatment effect for socialising with one's community. </span>
<span id="cb1-328"><a href="#cb1-328"></a></span>
<span id="cb1-329"><a href="#cb1-329"></a>We begin with the most straightforward (and secretly impossible) counterfactual: *run two parallel universes‚Äîone where **everyone** gets the treatment, another where **no-one** does‚Äîand compare the final scores.  The resulting difference is the **average treatment effect**:  </span>
<span id="cb1-330"><a href="#cb1-330"></a></span>
<span id="cb1-331"><a href="#cb1-331"></a></span>
<span id="cb1-332"><a href="#cb1-332"></a>$$</span>
<span id="cb1-333"><a href="#cb1-333"></a>\text{ATE}=E<span class="sc">\!</span>\bigl<span class="co">[</span><span class="ot">Y(1)-Y(0)\bigr</span><span class="co">]</span>.</span>
<span id="cb1-334"><a href="#cb1-334"></a>$$</span>
<span id="cb1-335"><a href="#cb1-335"></a></span>
<span id="cb1-336"><a href="#cb1-336"></a>This gives us the average response -- the shoe size... You've seen this before.</span>
<span id="cb1-337"><a href="#cb1-337"></a></span>
<span id="cb1-338"><a href="#cb1-338"></a></span>
<span id="cb1-339"><a href="#cb1-339"></a>---</span>
<span id="cb1-340"><a href="#cb1-340"></a></span>
<span id="cb1-341"><a href="#cb1-341"></a><span class="fu">### 2 Do effects differ across people?  </span></span>
<span id="cb1-342"><a href="#cb1-342"></a></span>
<span id="cb1-343"><a href="#cb1-343"></a>Variation is captured by the **conditional average treatment effect (CATE)**,  </span>
<span id="cb1-344"><a href="#cb1-344"></a></span>
<span id="cb1-345"><a href="#cb1-345"></a>$$</span>
<span id="cb1-346"><a href="#cb1-346"></a>\tau(x)=E<span class="sc">\!</span>\bigl<span class="co">[</span><span class="ot">Y(1)-Y(0)\mid X=x\bigr</span><span class="co">]</span>,</span>
<span id="cb1-347"><a href="#cb1-347"></a>$$</span>
<span id="cb1-348"><a href="#cb1-348"></a></span>
<span id="cb1-349"><a href="#cb1-349"></a>where $X$ gathers pre-treatment covariates -- age, baseline wellbeing, personality, whatever we have measured and included in our model. Normally these will be our *baseline confounders.* </span>
<span id="cb1-350"><a href="#cb1-350"></a></span>
<span id="cb1-351"><a href="#cb1-351"></a>If $\tau(x)$ turns out to be flat, we say there is no evidence for heterogeneity worth targeting. </span>
<span id="cb1-352"><a href="#cb1-352"></a></span>
<span id="cb1-353"><a href="#cb1-353"></a>People differ in countless, overlapping ways. Think of age, baseline wellbeing, personality traits, study habits, and more. </span>
<span id="cb1-354"><a href="#cb1-354"></a></span>
<span id="cb1-355"><a href="#cb1-355"></a>A linear interaction model tests whether the treatment works differently along one straight dimension, such as gender, by fitting a straight line. </span>
<span id="cb1-356"><a href="#cb1-356"></a></span>
<span id="cb1-357"><a href="#cb1-357"></a>But real‚Äêworld data often twist and turn. If the true relationship bends like a garden hose, a straight line will miss the curve. </span>
<span id="cb1-358"><a href="#cb1-358"></a></span>
<span id="cb1-359"><a href="#cb1-359"></a>Regression forests fix this by letting the data place splits wherever the shape changes, so they can follow any bends that appear <span class="co">[</span><span class="ot">@wager2018</span><span class="co">]</span>.  </span>
<span id="cb1-360"><a href="#cb1-360"></a></span>
<span id="cb1-361"><a href="#cb1-361"></a>Straight-line models are fine for simple patterns, but regression forests can trace the curves that simple lines overlook.</span>
<span id="cb1-362"><a href="#cb1-362"></a></span>
<span id="cb1-363"><a href="#cb1-363"></a>Causal forests are based on regression forests, where the splitting attempts to maximise differences in causal effect estimates. What this means will soon be clear. </span>
<span id="cb1-364"><a href="#cb1-364"></a></span>
<span id="cb1-365"><a href="#cb1-365"></a></span>
<span id="cb1-366"><a href="#cb1-366"></a><span class="fu">### 3. From straight lines to trees  </span></span>
<span id="cb1-367"><a href="#cb1-367"></a></span>
<span id="cb1-368"><a href="#cb1-368"></a>Traditional 'parametric' models (like simple regression) guess a single functional shape -- often a straight line -- before seeing the data.  A **non-parametric** model, by contrast, lets the data decide the shape.  A *regression tree* is the simplest non-parametric learner we will use.  </span>
<span id="cb1-369"><a href="#cb1-369"></a></span>
<span id="cb1-370"><a href="#cb1-370"></a><span class="ss">1. </span>**Regression tree**  </span>
<span id="cb1-371"><a href="#cb1-371"></a></span>
<span id="cb1-372"><a href="#cb1-372"></a>*Idea*: split the covariate space by asking yes/no questions‚Äî 'Age ‚â§ 20?', 'Baseline wellbeing &gt; 0.3?' ‚Äî until each terminal **leaf** is fairly homogeneous.  Inside a leaf the predicted outcome is just the sample mean, so the tree builds a *piece-wise constant* surface instead of a global line.    </span>
<span id="cb1-373"><a href="#cb1-373"></a>*Analogy*: think of tiling a garden with stepping-stones: each stone is flat, but taken together they follow the ground‚Äôs contours.</span>
<span id="cb1-374"><a href="#cb1-374"></a></span>
<span id="cb1-375"><a href="#cb1-375"></a><span class="ss">2. </span>**Regression forest**  </span>
<span id="cb1-376"><a href="#cb1-376"></a>   A single tree is quick and interpretable but unstable: small changes in the data can move the splits and shift predictions.  A **random forest** grows many trees on bootstrap samples and averages their outputs.  Averaging cancels much of the noise <span class="co">[</span><span class="ot">@breiman2001random</span><span class="co">]</span>.  </span>
<span id="cb1-377"><a href="#cb1-377"></a></span>
<span id="cb1-378"><a href="#cb1-378"></a><span class="ss">3. </span>**Causal Forests**  </span>
<span id="cb1-379"><a href="#cb1-379"></a>   To estimate treatment effects rather than outcomes, each tree plays a two-step 'honest' game <span class="co">[</span><span class="ot">@wager2018</span><span class="co">]</span>:  </span>
<span id="cb1-380"><a href="#cb1-380"></a><span class="ss">   - </span>use one half of its sample to choose splits that separate treated from control units;  </span>
<span id="cb1-381"><a href="#cb1-381"></a><span class="ss">   - </span>use the other half to compute treatment-control differences within every leaf.  </span>
<span id="cb1-382"><a href="#cb1-382"></a></span>
<span id="cb1-383"><a href="#cb1-383"></a>   For a new individual with covariates $x_i$ each tree supplies a noisy leaf-level effect; the forest reports the **average**, written  </span>
<span id="cb1-384"><a href="#cb1-384"></a></span>
<span id="cb1-385"><a href="#cb1-385"></a>$$</span>
<span id="cb1-386"><a href="#cb1-386"></a>  \widehat{\tau}(x)=E<span class="co">[</span><span class="ot">Y(1)-Y(0)\mid X=x</span><span class="co">]</span>.</span>
<span id="cb1-387"><a href="#cb1-387"></a>$$</span>
<span id="cb1-388"><a href="#cb1-388"></a></span>
<span id="cb1-389"><a href="#cb1-389"></a>Because the noisy estimates point in many directions, their average is markedly less variable -- *the wisdom of trees is a wisdom of crowds*.</span>
<span id="cb1-390"><a href="#cb1-390"></a></span>
<span id="cb1-391"><a href="#cb1-391"></a>Straight‚Äëline models suit simple patterns; regression forests flex to any bends; causal forests add a third dimension -- variation in treatment responses. We'll see this in action/</span>
<span id="cb1-392"><a href="#cb1-392"></a></span>
<span id="cb1-393"><a href="#cb1-393"></a></span>
<span id="cb1-394"><a href="#cb1-394"></a>For more about causal forests see (~18mins in...)</span>
<span id="cb1-395"><a href="#cb1-395"></a></span>
<span id="cb1-396"><a href="#cb1-396"></a>{{&lt; video https://www.youtube.com/watch?v=YBbnCDRCcAI &gt;}}</span>
<span id="cb1-397"><a href="#cb1-397"></a></span>
<span id="cb1-398"><a href="#cb1-398"></a></span>
<span id="cb1-399"><a href="#cb1-399"></a><span class="co">&lt;!-- So, a regression tree chops the data into locally flat chunks; a regression forest averages many such trees to smooth away chance idiosyncrasies; a causal forest adds honesty so that its averaged differences, though never directly observable for any one person, give our best data-driven forecast of individual treatment effects. --&gt;</span></span>
<span id="cb1-400"><a href="#cb1-400"></a></span>
<span id="cb1-401"><a href="#cb1-401"></a>---</span>
<span id="cb1-402"><a href="#cb1-402"></a></span>
<span id="cb1-403"><a href="#cb1-403"></a><span class="fu">### 4 Building Honest Trees: Avoiding Over-Fitting  </span></span>
<span id="cb1-404"><a href="#cb1-404"></a></span>
<span id="cb1-405"><a href="#cb1-405"></a>Sample splitting meanings partitioning your data into training and testing sets. This avoids overfittign the model to observations (remember we seek to estimate parameters for an entire population under two different exposures, at most, only one of which is observed on any individual.) Sample splitting is a feature of estimation in cauasal forests -- we separate model selection from estimation. Moreover, the forest adds a second safeguard: **out-of-bag (OOB) prediction**. Each $\widehat{\tau}(x_i)$ is averaged only over trees that never used $i$ in their split phase.  Together, honesty and OOB prediction deliver reliable uncertainty estimates even in high-dimensional settings (i.e. settings with *many* covariates.)</span>
<span id="cb1-406"><a href="#cb1-406"></a></span>
<span id="cb1-407"><a href="#cb1-407"></a>---</span>
<span id="cb1-408"><a href="#cb1-408"></a></span>
<span id="cb1-409"><a href="#cb1-409"></a><span class="fu">### 5 Handling missing data  </span></span>
<span id="cb1-410"><a href="#cb1-410"></a></span>
<span id="cb1-411"><a href="#cb1-411"></a>The <span class="in">`grf`</span> package adopts **Missing Incorporated in Attributes (MIA)** splitting.  'Missing' can itself become a branch, so cases are neither discarded nor randomly imputed.  This pragmatic approach keeps all observations in play while preserving the forest‚Äôs interpretability. </span>
<span id="cb1-412"><a href="#cb1-412"></a></span>
<span id="cb1-413"><a href="#cb1-413"></a>---</span>
<span id="cb1-414"><a href="#cb1-414"></a></span>
<span id="cb1-415"><a href="#cb1-415"></a><span class="fu">### 6 Is the heterogeneity *actionable*? ‚Äî RATE statistics  </span></span>
<span id="cb1-416"><a href="#cb1-416"></a></span>
<span id="cb1-417"><a href="#cb1-417"></a>Once we have a personalised score $\widehat{\tau}(x)$ for every unit, the practical question is whether *targeting* high scorers delivers a benefit large enough to justify the extra effort.  The tool of choice is the **Targeting-Operator Characteristic (TOC)** curve:</span>
<span id="cb1-418"><a href="#cb1-418"></a></span>
<span id="cb1-419"><a href="#cb1-419"></a>$$</span>
<span id="cb1-420"><a href="#cb1-420"></a>G(q)=\frac{1}{n}\sum_{i=1}^{\lfloor qn\rfloor}\widehat{\tau}_{(i)}, \qquad 0\le q\le1,</span>
<span id="cb1-421"><a href="#cb1-421"></a>$$</span>
<span id="cb1-422"><a href="#cb1-422"></a></span>
<span id="cb1-423"><a href="#cb1-423"></a>where $\widehat{\tau}_{(1)}\ge\widehat{\tau}_{(2)}\ge\cdots$ are the estimated effects sorted from largest to smallest.  The horizontal axis $q$ is the fraction of the population we would treat; the vertical axis $G(q)$ is the cumulative gain we expect from treating that top slice.</span>
<span id="cb1-424"><a href="#cb1-424"></a></span>
<span id="cb1-425"><a href="#cb1-425"></a>Two integrals of the TOC curve summarise how lucrative targeting could be:</span>
<span id="cb1-426"><a href="#cb1-426"></a></span>
<span id="cb1-427"><a href="#cb1-427"></a><span class="ss">* </span>**RATE AUTOC** (Area *Under* the TOC) puts equal weight on every $q$.  This answers: *If benefits are concentrated among the very best prospects, how much can we harvest by cherry-picking them?*  </span>
<span id="cb1-428"><a href="#cb1-428"></a></span>
<span id="cb1-429"><a href="#cb1-429"></a><span class="ss">* </span>**RATE Qini** applies heavier weight to the mid-range of $q$.  This is the go-to metric when investigators face a fixed, moderate-sized budget‚Äîsay, "we can afford to treat 40 % of individuals; will targeting help?"  <span class="co">[</span><span class="ot">@yadlowsky2021evaluating</span><span class="co">]</span>. We will evaluate the curve at treatment of 20% and 50% of the population.</span>
<span id="cb1-430"><a href="#cb1-430"></a></span>
<span id="cb1-431"><a href="#cb1-431"></a></span>
<span id="cb1-432"><a href="#cb1-432"></a>To quantify the economic or policy value of heterogeneity, rank units by $\widehat{\tau}(x)$ and draw a **Targeting-Operator Characteristic (TOC)** curve that plots cumulative gain against the fraction $q$ of the population treated.  </span>
<span id="cb1-433"><a href="#cb1-433"></a></span>
<span id="cb1-434"><a href="#cb1-434"></a>---</span>
<span id="cb1-435"><a href="#cb1-435"></a></span>
<span id="cb1-436"><a href="#cb1-436"></a><span class="fu">### 7 RATE AUTOC EXAMPLE</span></span>
<span id="cb1-437"><a href="#cb1-437"></a></span>
<span id="cb1-438"><a href="#cb1-438"></a>Although OOB predictions are 'out-of-sample' for individual trees, the full forest still reuses information.  A simple remedy when estimating the RATE AUTOC and Qini is to split the data, **training** the forest on one fold and **testing** RATE/Qini on the other.  Again, this explicit splitting blocks optimistic bias and yields honest test statistics (such as confidence intervals) <span class="co">[</span><span class="ot">@grf2024</span><span class="co">]</span>.</span>
<span id="cb1-439"><a href="#cb1-439"></a></span>
<span id="cb1-440"><a href="#cb1-440"></a><span class="in">```{r, results='asis'}</span></span>
<span id="cb1-441"><a href="#cb1-441"></a><span class="co">#| label: fig-rate-example</span></span>
<span id="cb1-442"><a href="#cb1-442"></a><span class="co">#| fig-cap: "RATE AUTOC: Hours Socialising ‚Üí Sense of Meaning"</span></span>
<span id="cb1-443"><a href="#cb1-443"></a><span class="co">#| echo: false</span></span>
<span id="cb1-444"><a href="#cb1-444"></a><span class="co">#| column: screen</span></span>
<span id="cb1-445"><a href="#cb1-445"></a>batch_rate_autoc_plots<span class="sc">$</span>model_t2_meaning_sense_z</span>
<span id="cb1-446"><a href="#cb1-446"></a><span class="in">```</span></span>
<span id="cb1-447"><a href="#cb1-447"></a></span>
<span id="cb1-448"><a href="#cb1-448"></a>@fig-rate-example depicts a typical RATE AUTOC curve with sample splitting.  A steep initial rise indicates that a small, correctly targeted programme could deliver large gains. Note that the curve begins dipping below zero past about 30% of the sample. At that point we might be doing worse than the ATE by targeting the CATE -- at least for some.</span>
<span id="cb1-449"><a href="#cb1-449"></a></span>
<span id="cb1-450"><a href="#cb1-450"></a>**Remember -- figuring out who will benefit from a treatment is a difficult statistical problem [@grf2024].**</span>
<span id="cb1-451"><a href="#cb1-451"></a></span>
<span id="cb1-452"><a href="#cb1-452"></a>---</span>
<span id="cb1-453"><a href="#cb1-453"></a></span>
<span id="cb1-454"><a href="#cb1-454"></a><span class="fu">### 8 Visualising policy value: the Qini curve  </span></span>
<span id="cb1-455"><a href="#cb1-455"></a></span>
<span id="cb1-456"><a href="#cb1-456"></a>A **Qini curve** displays cumulative benefit on the vertical axis and treatment coverage (% of the population treated) on the horizontal.  As with the AUTOC curve we are using a held-out test fold to validate the response curve.</span>
<span id="cb1-457"><a href="#cb1-457"></a></span>
<span id="cb1-458"><a href="#cb1-458"></a><span class="in">```{r, results='asis'}</span></span>
<span id="cb1-459"><a href="#cb1-459"></a><span class="co">#| label: fig-qini-example</span></span>
<span id="cb1-460"><a href="#cb1-460"></a><span class="co">#| fig-cap: "Qini Curve: Hours Socialising ‚Üí Social Belonging"</span></span>
<span id="cb1-461"><a href="#cb1-461"></a><span class="co">#| echo: false</span></span>
<span id="cb1-462"><a href="#cb1-462"></a><span class="co">#| column: screen</span></span>
<span id="cb1-463"><a href="#cb1-463"></a>plot_qini_belong</span>
<span id="cb1-464"><a href="#cb1-464"></a><span class="in">```</span></span>
<span id="cb1-465"><a href="#cb1-465"></a></span>
<span id="cb1-466"><a href="#cb1-466"></a></span>
<span id="cb1-467"><a href="#cb1-467"></a></span>
<span id="cb1-468"><a href="#cb1-468"></a>@fig-qini-example: we find that focussing on the top 20 % of individuals nets a gain of 0.08 units (95 % CI 0.04‚Äì0.12).  Widening the net to 50 % bumps the haul to 0.13 units (95 % CI 0.07‚Äì0.19).  After that the curve flattens -- once we‚Äôve treated everyone who offers a decent return, there are no more 'big fish' left to catch.</span>
<span id="cb1-469"><a href="#cb1-469"></a></span>
<span id="cb1-470"><a href="#cb1-470"></a>---</span>
<span id="cb1-471"><a href="#cb1-471"></a></span>
<span id="cb1-472"><a href="#cb1-472"></a></span>
<span id="cb1-473"><a href="#cb1-473"></a><span class="fu">### 9 From 'a black box' to simple rules: policy trees  </span></span>
<span id="cb1-474"><a href="#cb1-474"></a></span>
<span id="cb1-475"><a href="#cb1-475"></a>The causal forest hands us a personalised CATE for every individual, mapping a **high-dimensional** covariate vector $X$ to a number $\widehat{\tau}(X)$.  Helpful as that forecast may be, it stops short of telling us *what to do*: the function itself is too tangled --- thousands of overlapping splits -- to translate directly into a policy.  </span>
<span id="cb1-476"><a href="#cb1-476"></a></span>
<span id="cb1-477"><a href="#cb1-477"></a>The **policytree** algorithm bridges that gap by collapsing the forest's many $\widehat{\tau}(X)$ values into a single, shallow decision tree whose depth you choose; each split is chosen to maximise expected benefit [@policytree_package_2024].  In this course we cap the depth at **two** for a practical balance, specifially:</span>
<span id="cb1-478"><a href="#cb1-478"></a></span>
<span id="cb1-479"><a href="#cb1-479"></a><span class="ss">- </span>At most three yes/no questions per rule, so the logic fits on a slide you can present to policy-makers</span>
<span id="cb1-480"><a href="#cb1-480"></a><span class="ss">- </span>Each leaf still contains enough observations to yield a stable effect estimate;  </span>
<span id="cb1-481"><a href="#cb1-481"></a><span class="ss">- </span>Deeper trees increase computational complexity faster than they improve payoffs.</span>
<span id="cb1-482"><a href="#cb1-482"></a></span>
<span id="cb1-483"><a href="#cb1-483"></a><span class="in">```{r, results='asis'}</span></span>
<span id="cb1-484"><a href="#cb1-484"></a><span class="co">#| label: fig-decision-tree</span></span>
<span id="cb1-485"><a href="#cb1-485"></a><span class="co">#| fig-cap: "Decision tree for Social Belonging"</span></span>
<span id="cb1-486"><a href="#cb1-486"></a><span class="co">#| echo: false</span></span>
<span id="cb1-487"><a href="#cb1-487"></a><span class="co">#| column: screen</span></span>
<span id="cb1-488"><a href="#cb1-488"></a>plots_policy_trees<span class="sc">$</span>model_t2_belong_z<span class="sc">$</span>decision_tree</span>
<span id="cb1-489"><a href="#cb1-489"></a><span class="in">```</span></span>
<span id="cb1-490"><a href="#cb1-490"></a></span>
<span id="cb1-491"><a href="#cb1-491"></a> </span>
<span id="cb1-492"><a href="#cb1-492"></a>**Policy Tree Findings for Effect of Hour Socialising on Social Belonging:**</span>
<span id="cb1-493"><a href="#cb1-493"></a></span>
<span id="cb1-494"><a href="#cb1-494"></a>Participants are first split by Self Esteem at -0.925 (original scale: 3.958). For those with Self Esteem $&lt;=$ this threshold, the next split is by Neuroticism at 0.642 (original scale: 4.228). Within that subgroup, individuals with Neuroticism $&lt;=$ the threshold are recommended **control**, while those with Neuroticism $&gt;$ the threshold are recommended **treated**.</span>
<span id="cb1-495"><a href="#cb1-495"></a></span>
<span id="cb1-496"><a href="#cb1-496"></a>For participants with Self Esteem $&gt;$ -0.925 (original scale: 3.958), the second split is by Social Belonging at 0.776 (original scale: 5.972). In this subgroup, individuals with Social Belonging $&lt;=$ the threshold are recommended **treated**, while those with Social Belonging $&gt;$ the threshold are recommended **control**.</span>
<span id="cb1-497"><a href="#cb1-497"></a></span>
<span id="cb1-498"><a href="#cb1-498"></a></span>
<span id="cb1-499"><a href="#cb1-499"></a><span class="in">```{r, results='asis'}</span></span>
<span id="cb1-500"><a href="#cb1-500"></a><span class="co">#| label: fig-policy-map</span></span>
<span id="cb1-501"><a href="#cb1-501"></a><span class="co">#| fig-cap: "Predicted treatment assignment (predictions out of training sample)"</span></span>
<span id="cb1-502"><a href="#cb1-502"></a><span class="co">#| fig-height: 14   # adjust</span></span>
<span id="cb1-503"><a href="#cb1-503"></a><span class="co">#| fig-width: 16  # adjust</span></span>
<span id="cb1-504"><a href="#cb1-504"></a><span class="co">#| echo: false</span></span>
<span id="cb1-505"><a href="#cb1-505"></a>plots_policy_trees<span class="sc">$</span>model_t2_belong_z<span class="sc">$</span>policy_tree</span>
<span id="cb1-506"><a href="#cb1-506"></a><span class="in">```</span></span>
<span id="cb1-507"><a href="#cb1-507"></a></span>
<span id="cb1-508"><a href="#cb1-508"></a></span>
<span id="cb1-509"><a href="#cb1-509"></a></span>
<span id="cb1-510"><a href="#cb1-510"></a>---</span>
<span id="cb1-511"><a href="#cb1-511"></a></span>
<span id="cb1-512"><a href="#cb1-512"></a><span class="fu">### 10 Ethical and practical considerations  </span></span>
<span id="cb1-513"><a href="#cb1-513"></a></span>
<span id="cb1-514"><a href="#cb1-514"></a>There is no guarantee that statistical optimality will line up with social optimality. A rule that maximises expected health gains might still be **unaffordable** for a public agency, **unfair** to a protected group, or **opaque** to those asked to trust it.  We all have our notions of fairness, and we can't be expected to ignore them. Moreover, the estimation of CATE is always senstive to which variables we include in our model (see the caveats in <span class="co">[</span><span class="ot">Lecture 6</span><span class="co">](https://go-bayes.github.io/psych-434-2025/content/06-content.html#appendix-b-evidence-for-effect-modification-is-relative-to-inclusion-of-other-variables-in-the-model)</span>).  </span>
<span id="cb1-515"><a href="#cb1-515"></a></span>
<span id="cb1-516"><a href="#cb1-516"></a>So, we should not consider CATE an absolute guide to practice. We should be cautious. </span>
<span id="cb1-517"><a href="#cb1-517"></a></span>
<span id="cb1-518"><a href="#cb1-518"></a>Yet the very same CATE machinery that powers targeting also helps science move past a *one-size-fits-all* mindset.  By mapping treatment effects across a high-dimensional covariate space, we can test whether our favourite categories -- gender, age group, clinical severity -- actually capture the differences that matter.  Sometimes they do; often they don't, revealing that nature is not carved at the joints of our folk classifications.  Discovering *where* the forest finds meaningful splits can generate fresh psychological hypotheses about who responds, why, and under what circumstances, even when no policy decision is on the table. Over the next several weeks, we shall return to this point with examples.</span>
<span id="cb1-519"><a href="#cb1-519"></a></span>
<span id="cb1-520"><a href="#cb1-520"></a></span>
<span id="cb1-521"><a href="#cb1-521"></a><span class="co">&lt;!-- Before deployment we therefore need three extra layers of scrutiny: --&gt;</span></span>
<span id="cb1-522"><a href="#cb1-522"></a></span>
<span id="cb1-523"><a href="#cb1-523"></a><span class="co">&lt;!-- 1. **Cost realism**   Will the programme's administrative and opportunity costs erase the forecast benefit?  A cost‚Äìeffectiveness analysis can reveal when a simpler, less 'optimal' rule actually delivers better value.   --&gt;</span></span>
<span id="cb1-524"><a href="#cb1-524"></a><span class="co">&lt;!-- 2. **Fairness auditing**  check whether error rates or treatment probabilities differ by gender, ethnicity, or socioeconomic status.  If gaps appear, consider adjusting the loss function or adding fairness constraints [@mitchell2021algorithmic].   --&gt;</span></span>
<span id="cb1-525"><a href="#cb1-525"></a><span class="co">&lt;!-- 3. **Transparency and consent**   Publish the rule, document data sources, and secure stakeholder buy-in.  Transparent governance limits the risk of political backlash and encourages external replication. --&gt;</span></span>
<span id="cb1-526"><a href="#cb1-526"></a></span>
<span id="cb1-527"><a href="#cb1-527"></a>---</span>
<span id="cb1-528"><a href="#cb1-528"></a></span>
<span id="cb1-529"><a href="#cb1-529"></a><span class="fu">### Summary/next steps  </span></span>
<span id="cb1-530"><a href="#cb1-530"></a></span>
<span id="cb1-531"><a href="#cb1-531"></a>Our workflow answers three questions in sequence:</span>
<span id="cb1-532"><a href="#cb1-532"></a></span>
<span id="cb1-533"><a href="#cb1-533"></a><span class="ss">1. </span>**Is there substantial heterogeneity?**  Reject $H_0{:}\tau(x)$ constant if RATE AUTOC or RATE Qini is positive and statistically reliable  </span>
<span id="cb1-534"><a href="#cb1-534"></a><span class="ss">2. </span>**Does targeting pay at realistic budgets?**  Inspect the slope of the Qini curve around plausible coverage levels.</span>
<span id="cb1-535"><a href="#cb1-535"></a><span class="ss">3. </span>**Can we express the targeting rule in a few defensible steps?**  fit and validate a shallow policy tree.</span>
<span id="cb1-536"><a href="#cb1-536"></a></span>
<span id="cb1-537"><a href="#cb1-537"></a>In the lab section you will reproduce each stage on a simulated dataset.</span>
<span id="cb1-538"><a href="#cb1-538"></a></span>
<span id="cb1-539"><a href="#cb1-539"></a></span>
<span id="cb1-540"><a href="#cb1-540"></a><span class="fu">## Appendix </span></span>
<span id="cb1-541"><a href="#cb1-541"></a></span>
<span id="cb1-542"><a href="#cb1-542"></a><span class="co">&lt;!-- ## Subgroup analysis --&gt;</span></span>
<span id="cb1-543"><a href="#cb1-543"></a></span>
<span id="cb1-544"><a href="#cb1-544"></a><span class="co">&lt;!-- Redcall, **Effect Modification** (also known as "heterogeneity of treatment effects", and "Effect-measure modification") occurs when the causal effect of intervention $A$ varies across different levels of another variable $R$: --&gt;</span></span>
<span id="cb1-545"><a href="#cb1-545"></a></span>
<span id="cb1-546"><a href="#cb1-546"></a><span class="co">&lt;!-- $$E(Y^{a=1}|G=g_1, L=l) - E(Y^{a=0}|G=g_1, L=l) \neq E(Y^{a=1}|G=g_2, L=l) - E(Y^{a=0}|G=g_2, L=l)$$ --&gt;</span></span>
<span id="cb1-547"><a href="#cb1-547"></a></span>
<span id="cb1-548"><a href="#cb1-548"></a><span class="co">&lt;!-- Effect modification indicates that the magnitude of the causal effect of intervention $A$ is related to the modifier variable $G$ level. As discussed last week, effect modification can be observed even when there is no direct causal interaction between the treatment and the modifier variable. We noted that **interaction in causal inference refers to a situation where the combined effect of two interventions is not equal to the sum of their individual effects**. **Effect modification, on the other hand, occurs when the causal effect of one intervention varies across different levels of another variable.** --&gt;</span></span>
<span id="cb1-549"><a href="#cb1-549"></a></span>
<span id="cb1-550"><a href="#cb1-550"></a></span>
<span id="cb1-551"><a href="#cb1-551"></a><span class="co">&lt;!-- We also noted that  --&gt;</span></span>
<span id="cb1-552"><a href="#cb1-552"></a></span>
<span id="cb1-553"><a href="#cb1-553"></a><span class="co">&lt;!-- &gt; **For comparative research, we are typically interested in effect-modification, which requires subgroup analysis.** --&gt;</span></span>
<span id="cb1-554"><a href="#cb1-554"></a></span>
<span id="cb1-555"><a href="#cb1-555"></a></span>
<span id="cb1-556"><a href="#cb1-556"></a><span class="fu">### Causal Estimand, Statistical Estimand, Statistical Estimator</span></span>
<span id="cb1-557"><a href="#cb1-557"></a></span>
<span id="cb1-558"><a href="#cb1-558"></a>Let's set subgroup analysis to the side for a moment and begin focussing on statistical estimation.  </span>
<span id="cb1-559"><a href="#cb1-559"></a></span>
<span id="cb1-560"><a href="#cb1-560"></a>Suppose a researcher wants to understand the causal effect of marriage on individual happiness. Participants in the study are surveyed for their marital status ("married" or "not married") and their self-reported happiness on a scale from 1 to 10.</span>
<span id="cb1-561"><a href="#cb1-561"></a></span>
<span id="cb1-562"><a href="#cb1-562"></a><span class="fu">#### Causal Estimand</span></span>
<span id="cb1-563"><a href="#cb1-563"></a></span>
<span id="cb1-564"><a href="#cb1-564"></a><span class="ss">- </span>**Definition**: The causal estimand is the specific quantity or parameter that we aim to estimate to understand the causal effect of an intervention or treatment on an outcome.</span>
<span id="cb1-565"><a href="#cb1-565"></a></span>
<span id="cb1-566"><a href="#cb1-566"></a><span class="ss">- </span>**Example**: Here, the **Causal Estimand** would be the Average Treatment Effect (ATE) of being married on happiness. Specifically, we define the ATE as the difference in the potential outcomes of happiness if all individuals were married versus if no individuals were married:</span>
<span id="cb1-567"><a href="#cb1-567"></a></span>
<span id="cb1-568"><a href="#cb1-568"></a>  $$</span>
<span id="cb1-569"><a href="#cb1-569"></a>  \text{ATE} = E<span class="co">[</span><span class="ot">Y^{a=1} - Y^{a=0}</span><span class="co">]</span></span>
<span id="cb1-570"><a href="#cb1-570"></a>  $$</span>
<span id="cb1-571"><a href="#cb1-571"></a></span>
<span id="cb1-572"><a href="#cb1-572"></a></span>
<span id="cb1-573"><a href="#cb1-573"></a>  Here, $Y^{a=1}$ represents the potential happiness score if an individual is married, and $Y^{a=0}$ if they are not married.</span>
<span id="cb1-574"><a href="#cb1-574"></a></span>
<span id="cb1-575"><a href="#cb1-575"></a></span>
<span id="cb1-576"><a href="#cb1-576"></a><span class="fu">#### Next step: Are Causal Assumptions Met? </span></span>
<span id="cb1-577"><a href="#cb1-577"></a></span>
<span id="cb1-578"><a href="#cb1-578"></a><span class="ss">- </span>Identification (Exchangeability): balance in the confounders across the treatments to be compared</span>
<span id="cb1-579"><a href="#cb1-579"></a></span>
<span id="cb1-580"><a href="#cb1-580"></a><span class="ss">- </span>Consistency: well-defined interventions</span>
<span id="cb1-581"><a href="#cb1-581"></a></span>
<span id="cb1-582"><a href="#cb1-582"></a><span class="ss">- </span>Positivity: treatments occur within levels of covariates $L$</span>
<span id="cb1-583"><a href="#cb1-583"></a></span>
<span id="cb1-584"><a href="#cb1-584"></a></span>
<span id="cb1-585"><a href="#cb1-585"></a><span class="fu">#### Statistical Estimand (next step)</span></span>
<span id="cb1-586"><a href="#cb1-586"></a></span>
<span id="cb1-587"><a href="#cb1-587"></a><span class="ss">- </span>**The problem**: how do we bridge the gap between potential outcomes and data? </span>
<span id="cb1-588"><a href="#cb1-588"></a></span>
<span id="cb1-589"><a href="#cb1-589"></a><span class="ss">- </span>**Definition**: the statistical estimand is the parameter or function that summarises the relationship between variables as described by a statistical model applied to data. </span>
<span id="cb1-590"><a href="#cb1-590"></a></span>
<span id="cb1-591"><a href="#cb1-591"></a><span class="ss">- </span>**Example**: for our study, the **Statistical Estimand** might be the mean difference in happiness scores between individuals who are married and those who are not, as derived from a linear regression model:</span>
<span id="cb1-592"><a href="#cb1-592"></a></span>
<span id="cb1-593"><a href="#cb1-593"></a>  $$</span>
<span id="cb1-594"><a href="#cb1-594"></a>  \text{Happiness} = \beta_0 + \beta_1 \times \text{Married} + \epsilon</span>
<span id="cb1-595"><a href="#cb1-595"></a>  $$</span>
<span id="cb1-596"><a href="#cb1-596"></a></span>
<span id="cb1-597"><a href="#cb1-597"></a>  In this equation, $\beta_1$ represents the estimated difference in happiness scores between the married and non-married groups.</span>
<span id="cb1-598"><a href="#cb1-598"></a></span>
<span id="cb1-599"><a href="#cb1-599"></a><span class="fu">#### Statistical Estimator</span></span>
<span id="cb1-600"><a href="#cb1-600"></a></span>
<span id="cb1-601"><a href="#cb1-601"></a><span class="ss">- </span>**Definition**: a statistical estimator is a rule or method by which a numerical estimate of a statistical estimand is calculated from the data.</span>
<span id="cb1-602"><a href="#cb1-602"></a></span>
<span id="cb1-603"><a href="#cb1-603"></a><span class="ss">- </span>**Example**: in our marriage study, the **Statistical Estimator** for $\beta_1$ is the ordinary least squares (OLS) estimator. This estimator is used to calculate $\beta_1$ from the sample data provided by the survey. It provides an estimate of the impact of being married on happiness, calculated using:</span>
<span id="cb1-604"><a href="#cb1-604"></a>  $$</span>
<span id="cb1-605"><a href="#cb1-605"></a>  \hat{\beta}_1 = \frac{\sum_{i=1}^n (X_i - \bar{X})(Y_i - \bar{Y})}{\sum_{i=1}^n (X_i - \bar{X})^2}</span>
<span id="cb1-606"><a href="#cb1-606"></a>  $$</span>
<span id="cb1-607"><a href="#cb1-607"></a>where $X_i$ is a binary indicator for being married (1 for married, 0 for not married), $Y_i$ is the observed happiness score, and $\bar{X}$, $\bar{Y}$ are the sample means of $X$ and $Y$, respectively.</span>
<span id="cb1-608"><a href="#cb1-608"></a></span>
<span id="cb1-609"><a href="#cb1-609"></a>The upshot, we anchor our causal inquiries within a multi-step framework of data analysis. This involves: </span>
<span id="cb1-610"><a href="#cb1-610"></a></span>
<span id="cb1-611"><a href="#cb1-611"></a><span class="ss">1. </span>clearly defining our causal estimand within a specified *target population,*</span>
<span id="cb1-612"><a href="#cb1-612"></a><span class="ss">2. </span>clarifying assumptions, &amp; especially identification assumptions, </span>
<span id="cb1-613"><a href="#cb1-613"></a><span class="ss">3. </span>describing a statistical strategy for extracting this estimand from the data, and then </span>
<span id="cb1-614"><a href="#cb1-614"></a><span class="ss">4. </span>applying an algorithm that embodies this statistical method.</span>
</code></pre></div><button title="Copy to Clipboard" class="code-copy-button" data-in-quarto-modal=""><i class="bi"></i></button></div>
</div></div></div></div></div>
</div> <!-- /content -->




<script src="../site_libs/quarto-html/zenscroll-min.js"></script>
</body></html>